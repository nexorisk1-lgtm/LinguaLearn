<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LinguaLearnna</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #F5F5F5; min-height: 100vh; }
    :root { --blue: #002844; --gold: #D9B438; --accent: #FF6B35; --gray: #555555; --light: #F5F5F5; --green: #22C55E; --orange: #F59E0B; --red: #EF4444; }
    .card { background: white; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,40,68,0.08); padding: 16px; margin-bottom: 12px; }
    .card-clickable { cursor: pointer; transition: all 0.2s; }
    .card-clickable:hover { box-shadow: 0 4px 20px rgba(0,40,68,0.12); transform: translateY(-2px); }
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 10px 16px; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; border: none; transition: all 0.2s; }
    .btn:hover { transform: translateY(-1px); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-primary { background: linear-gradient(135deg, var(--blue), #003d66); color: white; }
    .btn-gold { background: linear-gradient(135deg, var(--gold), #f0c84a); color: var(--blue); }
    .btn-accent { background: linear-gradient(135deg, var(--accent), #ff8555); color: white; }
    .btn-green { background: linear-gradient(135deg, var(--green), #34d399); color: white; }
    .btn-orange { background: linear-gradient(135deg, var(--orange), #fbbf24); color: white; }
    .btn-red { background: linear-gradient(135deg, var(--red), #f87171); color: white; }
    .btn-outline { background: transparent; border: 2px solid var(--blue); color: var(--blue); }
    .btn-outline:hover { background: var(--blue); color: white; }
    .btn-secondary { background: #e5e5e5; color: var(--gray); }
    .btn-ghost { background: transparent; color: var(--blue); }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-xs { padding: 4px 8px; font-size: 10px; }
    .badge { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .badge-blue { background: #dbeafe; color: #2563eb; }
    .badge-green { background: #dcfce7; color: #16a34a; }
    .badge-gold { background: #fef3c7; color: #b8860b; }
    .badge-gray { background: #e5e5e5; color: #555; }
    .badge-red { background: #fee2e2; color: #dc2626; }
    .badge-orange { background: #ffedd5; color: #ea580c; }
    .progress-bar { height: 8px; background: #e5e5e5; border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 10px; transition: width 0.5s; }
    .chip { display: inline-flex; align-items: center; gap: 4px; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 500; background: var(--light); color: var(--gray); cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
    .chip:hover { background: #e0e0e0; }
    .chip.active { background: var(--blue); color: white; border-color: var(--blue); }
    input, select, textarea { padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 13px; width: 100%; }
    input:focus, select:focus { outline: none; border-color: var(--blue); }
    input[type="checkbox"] { width: auto; margin-right: 8px; }
    .header { position: sticky; top: 0; z-index: 50; background: var(--blue); padding: 0 16px; height: 56px; display: flex; align-items: center; justify-content: space-between; }
    .header.hidden { display: none; }
    .nav-container { display: flex; align-items: center; gap: 4px; }
    .nav-btn { background: transparent; color: rgba(255,255,255,0.7); border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500; display: flex; align-items: center; gap: 4px; }
    .nav-btn:hover, .nav-btn.active { background: rgba(255,255,255,0.2); color: white; }
    .nav-dropdown { position: relative; }
    .nav-dropdown-menu { display: none; position: absolute; top: 100%; left: 0; background: white; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); min-width: 180px; z-index: 60; }
    .nav-dropdown-menu.open { display: block; }
    .nav-dropdown-item { padding: 12px 16px; cursor: pointer; font-size: 13px; color: var(--gray); display: flex; align-items: center; gap: 8px; }
    .nav-dropdown-item:hover { background: var(--light); color: var(--blue); }
    .main { max-width: 1000px; margin: 0 auto; padding: 16px; }
    .main.hidden { display: none; }
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .flex-col { display: flex; flex-direction: column; gap: 12px; }
    .flex-row { display: flex; gap: 8px; align-items: center; }
    .flex-wrap { display: flex; flex-wrap: wrap; gap: 6px; }
    .flex-between { display: flex; justify-content: space-between; align-items: center; }
    .onboarding-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--blue), #003d66); padding: 20px; }
    .onboarding-card { background: white; border-radius: 20px; padding: 40px; max-width: 500px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    .onboarding-step { display: none; }
    .onboarding-step.active { display: block; animation: fadeIn 0.4s; }
    .step-indicator { display: flex; justify-content: center; gap: 8px; margin-bottom: 30px; }
    .step-dot { width: 10px; height: 10px; border-radius: 50%; background: #e5e5e5; transition: all 0.3s; }
    .step-dot.active { background: var(--gold); transform: scale(1.2); }
    .step-dot.completed { background: var(--green); }
    .lang-option, .objective-option { padding: 12px 16px; border: 2px solid #e5e5e5; border-radius: 10px; cursor: pointer; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
    .lang-option:hover, .objective-option:hover { border-color: var(--blue); background: rgba(0,40,68,0.03); }
    .lang-option.selected, .objective-option.selected { border-color: var(--gold); background: rgba(217,180,56,0.1); }
    .day-selector { display: flex; gap: 8px; justify-content: center; margin: 20px 0; }
    .day-btn { width: 40px; height: 40px; border-radius: 50%; border: 2px solid #e5e5e5; background: white; cursor: pointer; font-weight: bold; font-size: 12px; }
    .day-btn:hover { border-color: var(--blue); }
    .day-btn.active { background: var(--gold); border-color: var(--gold); color: var(--blue); }
    .day-dots { display: flex; gap: 6px; align-items: center; }
    .day-dot { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 9px; font-weight: bold; }
    .day-dot.active { background: var(--gold); color: var(--blue); }
    .day-dot.inactive { background: #e5e5e5; color: #aaa; }
    .day-dot.done { background: var(--green); color: white; }
    .modal { display: none; position: fixed; inset: 0; z-index: 100; background: rgba(0,40,68,0.5); align-items: center; justify-content: center; padding: 16px; }
    .modal.open { display: flex; }
    .modal-content { background: white; border-radius: 16px; padding: 20px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; }
    .quiz-option { width: 100%; padding: 14px; text-align: left; background: white; border: 2px solid #e5e5e5; border-radius: 10px; cursor: pointer; font-size: 14px; margin-bottom: 8px; }
    .quiz-option:hover:not(.answered) { border-color: var(--blue); background: rgba(0,40,68,0.03); }
    .quiz-option.correct { border-color: var(--green); background: rgba(34,197,94,0.15); }
    .quiz-option.wrong { border-color: var(--red); background: rgba(239,68,68,0.15); }
    .flashcard { background: linear-gradient(135deg, var(--blue), #003d66); border-radius: 16px; padding: 40px 30px; min-height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
    .flashcard:hover { transform: scale(1.02); }
    .audio-btn { width: 28px; height: 28px; border-radius: 50%; background: var(--gold); border: none; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; }
    .audio-btn:hover { transform: scale(1.1); }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e5e5; }
    th { background: var(--light); font-weight: 600; color: var(--blue); }
    .word-list { max-height: 400px; overflow-y: auto; }
    .word-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
    .word-item:hover { background: var(--light); }
    .accordion { border: 1px solid #e5e5e5; border-radius: 10px; overflow: hidden; margin-bottom: 12px; }
    .accordion-header { padding: 14px 16px; background: var(--light); cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; color: var(--blue); }
    .accordion-content { display: none; padding: 16px; background: white; }
    .accordion-content.open { display: block; }
    .clickable-word { text-decoration: underline; text-decoration-color: var(--gold); text-decoration-thickness: 2px; cursor: pointer; }
    .clickable-word:hover { background: rgba(217,180,56,0.2); }
    .chat-container { background: white; border-radius: 12px; height: 350px; display: flex; flex-direction: column; }
    .chat-messages { flex: 1; padding: 16px; overflow-y: auto; }
    .chat-bubble { max-width: 80%; padding: 12px; border-radius: 12px; font-size: 13px; margin-bottom: 8px; }
    .chat-user { background: var(--blue); color: white; margin-left: auto; }
    .chat-coach { background: var(--light); color: var(--gray); }
    /* Calendrier mensuel */
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
    .calendar-header { text-align: center; font-size: 10px; font-weight: bold; color: var(--gray); padding: 4px; }
    .calendar-day { text-align: center; padding: 8px 4px; border-radius: 6px; font-size: 11px; cursor: pointer; position: relative; }
    .calendar-day:hover { background: var(--light); }
    .calendar-day.today { background: var(--blue); color: white; font-weight: bold; }
    .calendar-day.done { background: rgba(34,197,94,0.2); }
    .calendar-day.done::after { content: "âœ“"; position: absolute; top: 2px; right: 2px; font-size: 8px; color: var(--green); }
    .calendar-day.missed { background: rgba(239,68,68,0.1); }
    .calendar-day.missed::after { content: "âœ—"; position: absolute; top: 2px; right: 2px; font-size: 8px; color: var(--red); }
    .calendar-day.inactive { color: #ccc; cursor: default; }
    .calendar-day.scheduled { border: 2px solid var(--gold); }
    /* Lang switch */
    .lang-switch { position: relative; cursor: pointer; }
    .lang-switch-menu { display: none; position: absolute; top: 100%; right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 150px; z-index: 60; }
    .lang-switch-menu.open { display: block; }
    .lang-switch-item { padding: 10px 14px; cursor: pointer; font-size: 13px; color: var(--gray); }
    .lang-switch-item:hover { background: var(--light); color: var(--blue); }
    .lang-switch-item.active { background: rgba(217,180,56,0.2); color: var(--blue); font-weight: bold; }
    /* Theme checkbox */
    .theme-checkbox { display: flex; align-items: center; padding: 8px 12px; border: 1px solid #e5e5e5; border-radius: 8px; margin-bottom: 6px; cursor: pointer; }
    .theme-checkbox:hover { background: var(--light); }
    .theme-checkbox.checked { background: rgba(217,180,56,0.1); border-color: var(--gold); }
    /* Correction 0.1: Lang switch */
    .lang-switch { position: relative; cursor: pointer; }
    .lang-switch-btn { background: rgba(255,255,255,0.15); border: none; padding: 6px 12px; border-radius: 6px; color: white; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 13px; }
    .lang-switch-menu { display: none; position: absolute; top: 100%; right: 0; background: white; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); min-width: 160px; z-index: 60; margin-top: 4px; }
    .lang-switch-menu.open { display: block; }
    .lang-switch-item { padding: 10px 14px; cursor: pointer; font-size: 13px; color: var(--gray); display: flex; align-items: center; gap: 8px; }
    .lang-switch-item:hover { background: var(--light); }
    .lang-switch-item.active { background: rgba(217,180,56,0.15); color: var(--blue); font-weight: 600; }
    /* Correction 5: Word detail accordion */
    .word-item-container { border: 1px solid #e5e5e5; border-radius: 10px; margin-bottom: 8px; overflow: hidden; }
    .word-item-header { padding: 12px 14px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background: white; }
    .word-item-header:hover { background: var(--light); }
    .word-detail { display: none; padding: 12px 14px; background: var(--light); border-top: 1px solid #e5e5e5; }
    .word-detail.open { display: block; }
    /* Correction 6: Text selection */
    #selection-toolbar { display: none; position: absolute; background: var(--blue); border-radius: 8px; padding: 6px 10px; z-index: 80; }
    #selection-toolbar button { background: transparent; border: none; color: white; cursor: pointer; font-size: 12px; padding: 4px 8px; }
    #selection-toolbar button:hover { background: rgba(255,255,255,0.2); border-radius: 4px; }
    #text-selection-popup { display: none; position: absolute; background: white; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.2); padding: 16px; min-width: 250px; z-index: 90; }
    #text-selection-popup.visible { display: block; }
    .clickable-word { cursor: pointer; border-bottom: 1px dashed var(--blue); }
    .clickable-word:hover { background: rgba(0,40,68,0.1); }
    /* Correction 4.6: History row clickable */
    .history-row { cursor: pointer; transition: background 0.2s; }
    .history-row:hover { background: var(--light); }
    @media (max-width: 768px) {
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
      .nav-btn span { display: none; }
      .onboarding-card { padding: 24px; }
    }
  </style>
</head>
<body>

  <!-- ONBOARDING 6 Ã‰TAPES (VERROUILLÃ‰) -->
  <div id="onboarding-container" class="onboarding-container">
    <div class="onboarding-card">
      <div class="step-indicator" id="step-indicator">
        <div class="step-dot active"></div><div class="step-dot"></div><div class="step-dot"></div><div class="step-dot"></div><div class="step-dot"></div><div class="step-dot"></div>
      </div>
      <!-- Ã‰tape 1 -->
      <div class="onboarding-step active" id="step-1">
        <div style="text-align: center; margin-bottom: 30px;">
          <span style="font-size: 60px;">ğŸŒ</span>
          <h1 style="color: var(--blue); font-size: 28px; margin: 16px 0;">Bienvenue sur LinguaLearnna</h1>
        </div>
        <div style="margin-bottom: 16px;"><label style="font-size: 12px; color: var(--gray);">PrÃ©nom *</label><input type="text" id="onb-firstname" placeholder="Votre prÃ©nom"></div>
        <div style="margin-bottom: 16px;"><label style="font-size: 12px; color: var(--gray);">Mot de passe *</label><input type="password" id="onb-password" placeholder="Min 6 caractÃ¨res"></div>
        <div style="margin-bottom: 24px;"><label style="font-size: 12px; color: var(--gray);">RÃ´le *</label><select id="onb-role"><option value="user">Utilisateur</option><option value="admin">Administrateur</option></select></div>
        <button class="btn btn-gold" style="width: 100%; padding: 14px;" onclick="nextStep(1)">Continuer â†’</button>
      </div>
      <!-- Ã‰tape 2 -->
      <div class="onboarding-step" id="step-2">
        <div style="text-align: center; margin-bottom: 24px;"><h2 style="color: var(--blue); font-size: 22px;">Que voulez-vous apprendre ?</h2></div>
        <div id="lang-options">
          <div class="lang-option selected" data-lang="en" onclick="toggleLang(this)"><span style="font-size: 24px;">ğŸ‡¬ğŸ‡§</span><span style="font-weight: 600;">Anglais</span></div>
          <div class="lang-option" data-lang="es" onclick="toggleLang(this)"><span style="font-size: 24px;">ğŸ‡ªğŸ‡¸</span><span style="font-weight: 600;">Espagnol</span></div>
          <div class="lang-option" data-lang="ko" onclick="toggleLang(this)"><span style="font-size: 24px;">ğŸ‡°ğŸ‡·</span><span style="font-weight: 600;">CorÃ©en</span></div>
          <div class="lang-option" data-lang="ja" onclick="toggleLang(this)"><span style="font-size: 24px;">ğŸ‡¯ğŸ‡µ</span><span style="font-weight: 600;">Japonais</span></div>
          <div class="lang-option" data-lang="zh" onclick="toggleLang(this)"><span style="font-size: 24px;">ğŸ‡¨ğŸ‡³</span><span style="font-weight: 600;">Chinois</span></div>
          <div class="lang-option" data-lang="ar" onclick="toggleLang(this)"><span style="font-size: 24px;">ğŸ‡¸ğŸ‡¦</span><span style="font-weight: 600;">Arabe</span></div>
          <div class="lang-option" data-lang="fr" onclick="toggleLang(this)"><span style="font-size: 24px;">ğŸ‡«ğŸ‡·</span><span style="font-weight: 600;">FranÃ§ais</span></div>
        </div>
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button class="btn btn-secondary" style="flex: 1;" onclick="prevStep(2)">â† Retour</button>
          <button class="btn btn-gold" style="flex: 1;" onclick="nextStep(2)">Continuer â†’</button>
        </div>
      </div>
      <!-- Ã‰tape 3 -->
      <div class="onboarding-step" id="step-3">
        <div style="text-align: center; margin-bottom: 24px;"><h2 style="color: var(--blue); font-size: 22px;">Que voulez-vous amÃ©liorer ?</h2></div>
        <div id="objective-options">
          <div class="objective-option selected" onclick="toggleOption(this)"><span style="font-size: 20px;">ğŸ“–</span><span style="font-weight: 600;">Vocabulaire</span></div>
          <div class="objective-option selected" onclick="toggleOption(this)"><span style="font-size: 20px;">âœï¸</span><span style="font-weight: 600;">Grammaire</span></div>
          <div class="objective-option" onclick="toggleOption(this)"><span style="font-size: 20px;">ğŸ¤</span><span style="font-weight: 600;">Oral</span></div>
          <div class="objective-option" onclick="toggleOption(this)"><span style="font-size: 20px;">âœï¸</span><span style="font-weight: 600;">Ã‰crit</span></div>
          <div class="objective-option" onclick="toggleOption(this)"><span style="font-size: 20px;">ğŸ‘‚</span><span style="font-weight: 600;">Ã‰coute</span></div>
        </div>
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button class="btn btn-secondary" style="flex: 1;" onclick="prevStep(3)">â† Retour</button>
          <button class="btn btn-gold" style="flex: 1;" onclick="nextStep(3)">Continuer â†’</button>
        </div>
      </div>
      <!-- Ã‰tape 4 -->
      <div class="onboarding-step" id="step-4">
        <div style="text-align: center; margin-bottom: 24px;"><h2 style="color: var(--blue); font-size: 22px;">Quels sujets vous intÃ©ressent ?</h2></div>
        <div class="accordion"><div class="accordion-header" onclick="toggleAccordion('themes-pro')"><span>ğŸ’¼ ThÃ¨mes Professionnels (GRC)</span><span id="themes-pro-icon">â–¼</span></div>
          <div class="accordion-content open" id="themes-pro"><div class="flex-wrap">
            <span class="chip active" onclick="this.classList.toggle('active')">RÃ©unions</span>
            <span class="chip" onclick="this.classList.toggle('active')">Risque</span>
            <span class="chip" onclick="this.classList.toggle('active')">Audit</span>
            <span class="chip active" onclick="this.classList.toggle('active')">ConformitÃ©</span>
            <span class="chip" onclick="this.classList.toggle('active')">ContrÃ´le interne</span>
            <span class="chip" onclick="this.classList.toggle('active')">Consulting</span>
            <span class="chip" onclick="this.classList.toggle('active')">Gouvernance</span>
          </div></div>
        </div>
        <div class="accordion"><div class="accordion-header" onclick="toggleAccordion('themes-perso')"><span>ğŸŒˆ ThÃ¨mes Personnels</span><span id="themes-perso-icon">â–¼</span></div>
          <div class="accordion-content open" id="themes-perso"><div class="flex-wrap">
            <span class="chip active" onclick="this.classList.toggle('active')">Voyage</span>
            <span class="chip" onclick="this.classList.toggle('active')">Restaurant</span>
            <span class="chip" onclick="this.classList.toggle('active')">HÃ´tel</span>
            <span class="chip" onclick="this.classList.toggle('active')">Small talk</span>
            <span class="chip" onclick="this.classList.toggle('active')">Couleurs</span>
            <span class="chip" onclick="this.classList.toggle('active')">Nombres</span>
            <span class="chip" onclick="this.classList.toggle('active')">Animaux</span>
            <span class="chip active" onclick="this.classList.toggle('active')">Famille</span>
            <span class="chip" onclick="this.classList.toggle('active')">Maison</span>
            <span class="chip" onclick="this.classList.toggle('active')">MÃ©tÃ©o</span>
            <span class="chip" onclick="this.classList.toggle('active')">Sport</span>
          </div></div>
        </div>
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button class="btn btn-secondary" style="flex: 1;" onclick="prevStep(4)">â† Retour</button>
          <button class="btn btn-gold" style="flex: 1;" onclick="nextStep(4)">Continuer â†’</button>
        </div>
      </div>
      <!-- Ã‰tape 5 -->
      <div class="onboarding-step" id="step-5">
        <div style="text-align: center; margin-bottom: 24px;"><h2 style="color: var(--blue); font-size: 22px;">Quand voulez-vous rÃ©viser ?</h2></div>
        <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 20px;">
          <button class="btn btn-outline btn-sm" onclick="selectDaysPreset('weekdays')">Semaine</button>
          <button class="btn btn-outline btn-sm" onclick="selectDaysPreset('all')">Tous les jours</button>
          <button class="btn btn-outline btn-sm" onclick="selectDaysPreset('manual')">Manuel</button>
        </div>
        <div class="day-selector" id="day-selector">
          <button class="day-btn active" data-day="L" onclick="toggleDay(this)">L</button>
          <button class="day-btn active" data-day="M" onclick="toggleDay(this)">M</button>
          <button class="day-btn active" data-day="Me" onclick="toggleDay(this)">M</button>
          <button class="day-btn active" data-day="J" onclick="toggleDay(this)">J</button>
          <button class="day-btn active" data-day="V" onclick="toggleDay(this)">V</button>
          <button class="day-btn" data-day="S" onclick="toggleDay(this)">S</button>
          <button class="day-btn" data-day="D" onclick="toggleDay(this)">D</button>
        </div>
        <div style="text-align: center;"><span style="color: var(--gray); font-size: 13px;" id="days-selected">5 jours sÃ©lectionnÃ©s</span></div>
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button class="btn btn-secondary" style="flex: 1;" onclick="prevStep(5)">â† Retour</button>
          <button class="btn btn-gold" style="flex: 1;" onclick="nextStep(5)">Continuer â†’</button>
        </div>
      </div>
      <!-- Ã‰tape 6 -->
      <div class="onboarding-step" id="step-6">
        <div style="text-align: center; margin-bottom: 24px;"><h2 style="color: var(--blue); font-size: 22px;">Combien de temps par jour ?</h2></div>
        <div class="grid-4" style="gap: 10px;">
          <div class="chip" style="justify-content: center; padding: 14px;" onclick="selectTime(this)" data-time="5">5 min</div>
          <div class="chip" style="justify-content: center; padding: 14px;" onclick="selectTime(this)" data-time="10">10 min</div>
          <div class="chip" style="justify-content: center; padding: 14px;" onclick="selectTime(this)" data-time="15">15 min</div>
          <div class="chip" style="justify-content: center; padding: 14px;" onclick="selectTime(this)" data-time="20">20 min</div>
          <div class="chip active" style="justify-content: center; padding: 14px;" onclick="selectTime(this)" data-time="30">30 min</div>
          <div class="chip" style="justify-content: center; padding: 14px;" onclick="selectTime(this)" data-time="60">1h</div>
          <div class="chip" style="justify-content: center; padding: 14px;" onclick="selectTime(this)" data-time="120">2h</div>
          <div class="chip" style="justify-content: center; padding: 14px;" onclick="selectTime(this)" data-time="180">3h</div>
        </div>
        <div style="display: flex; gap: 12px; margin-top: 30px;">
          <button class="btn btn-secondary" style="flex: 1;" onclick="prevStep(6)">â† Retour</button>
          <button class="btn btn-accent" style="flex: 1; padding: 14px;" onclick="finishOnboarding()">ğŸš€ Commencer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ã‰CRAN CONNEXION RETOUR -->
  <div id="login-container" class="onboarding-container" style="display: none;">
    <div class="onboarding-card" style="max-width: 400px;">
      <div style="text-align: center; margin-bottom: 30px;">
        <span style="font-size: 50px;">ğŸŒ</span>
        <h1 style="color: var(--blue); font-size: 24px; margin: 16px 0;">Bienvenue !</h1>
      </div>
      <div style="margin-bottom: 16px;"><label style="font-size: 12px; color: var(--gray);">PrÃ©nom</label><input type="text" id="login-firstname" placeholder="Votre prÃ©nom"></div>
      <div style="margin-bottom: 24px;"><label style="font-size: 12px; color: var(--gray);">Mot de passe</label><input type="password" id="login-password" placeholder="Votre mot de passe"></div>
      <button class="btn btn-gold" style="width: 100%; padding: 14px;" onclick="login()">Commencer â†’</button>
      <p style="text-align: center; margin-top: 16px; font-size: 12px; color: var(--gray);">PremiÃ¨re visite ? <a href="#" style="color: var(--blue);" onclick="showOnboarding()">CrÃ©er un compte</a></p>
    </div>
  </div>

  <!-- HEADER avec switch langue (A) -->
  <header class="header hidden" id="main-header">
    <div style="display: flex; align-items: center; gap: 10px; cursor: pointer;" onclick="showPage('home')">
      <span style="font-size: 22px;">ğŸŒ</span>
      <span style="color: white; font-weight: bold; font-size: 16px;">LinguaLearnna</span>
      <span class="badge badge-gold">v8</span>
    </div>
    <nav class="nav-container">
      <button class="nav-btn active" data-page="home" onclick="showPage('home')">ğŸ  <span>Accueil</span></button>
      <div class="nav-dropdown">
        <button class="nav-btn" onclick="toggleDropdown('learn-dropdown')">ğŸ“š <span>Apprendre</span> â–¾</button>
        <div id="learn-dropdown" class="nav-dropdown-menu">
          <div class="nav-dropdown-item" onclick="showPage('vocab'); closeDropdowns()">ğŸ“– Vocabulaire</div>
          <div class="nav-dropdown-item" onclick="showPage('grammar'); closeDropdowns()">âœï¸ Grammaire</div>
          <div class="nav-dropdown-item" onclick="showPage('reading'); closeDropdowns()">ğŸ“„ Lecture</div>
          <div class="nav-dropdown-item" onclick="showPage('dictionary'); closeDropdowns()">ğŸ“• Dictionnaire</div>
        </div>
      </div>
      <button class="nav-btn" data-page="training" onclick="showPage('training')">âš¡ <span>EntraÃ®nement</span></button>
      <button class="nav-btn" data-page="coach" onclick="showPage('coach')">ğŸ’¬ <span>Coach IA</span></button>
    </nav>
    <div style="display: flex; align-items: center; gap: 10px;">
      <!-- Switch langue (A) -->
      <div class="lang-switch" onclick="toggleLangSwitch()">
        <span style="font-size: 18px;" id="header-lang-flag">ğŸ‡¬ğŸ‡§</span>
        <span style="color: white; font-size: 12px; margin-left: 4px;">â–¼</span>
        <div class="lang-switch-menu" id="lang-switch-menu">
          <div class="lang-switch-item active" data-lang="en" onclick="switchLang('en', 'ğŸ‡¬ğŸ‡§')">ğŸ‡¬ğŸ‡§ Anglais</div>
          <div class="lang-switch-item" data-lang="es" onclick="switchLang('es', 'ğŸ‡ªğŸ‡¸')">ğŸ‡ªğŸ‡¸ Espagnol</div>
          <div class="lang-switch-item" data-lang="ko" onclick="switchLang('ko', 'ğŸ‡°ğŸ‡·')">ğŸ‡°ğŸ‡· CorÃ©en</div>
        </div>
      </div>
      <span class="badge badge-gold" id="header-level">B1</span>
      <span style="color: white; font-size: 13px; cursor: pointer; text-decoration: underline;" onclick="showPage('profile')" id="header-username">Marie</span>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="main hidden" id="main-content">

    <!-- PAGE: ACCUEIL avec calendrier mensuel (B) -->
    <div id="page-home" class="page active">
      <div class="card" style="background: linear-gradient(135deg, var(--blue), #003d66); color: white; margin-bottom: 16px;">
        <div class="flex-between">
          <div>
            <h1 style="font-size: 22px; margin-bottom: 4px;">Salut <span id="home-username">Marie</span> ! ğŸ”¥</h1>
            <p style="opacity: 0.8; font-size: 13px;">7 jours consÃ©cutifs â€” Continue comme Ã§a ! ğŸ’ª</p>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 11px; opacity: 0.7;">Langue active</div>
            <div style="font-size: 14px; font-weight: bold;" id="home-active-lang">ğŸ‡¬ğŸ‡§ Anglais</div>
          </div>
        </div>
      </div>
      
      <div class="grid-2">
        <div class="flex-col">
          <!-- Mon programme avec aperÃ§u semaine simple (Correction 1) -->
          <div class="card">
            <div class="flex-between" style="margin-bottom: 12px;">
              <h3 style="color: var(--blue); font-size: 14px;">ğŸ“… Mon programme</h3>
              <button class="btn btn-outline btn-sm" onclick="showPage('planning')">Modifier</button>
            </div>
            <div class="flex-between" style="margin-bottom: 12px;">
              <span style="font-size: 12px; color: var(--gray);" id="program-summary">5 jours / semaine Â· 30 min</span>
            </div>
            <!-- AperÃ§u semaine simple -->
            <div id="week-preview" style="display: flex; justify-content: space-between; gap: 4px;">
              <div style="text-align: center; flex: 1;"><div class="day-dot done" title="Fait">L</div></div>
              <div style="text-align: center; flex: 1;"><div class="day-dot done" title="Fait">M</div></div>
              <div style="text-align: center; flex: 1;"><div class="day-dot done" title="Fait">Me</div></div>
              <div style="text-align: center; flex: 1;"><div class="day-dot done" title="Fait">J</div></div>
              <div style="text-align: center; flex: 1;"><div class="day-dot active" title="Aujourd'hui">V</div></div>
              <div style="text-align: center; flex: 1;"><div class="day-dot inactive">S</div></div>
              <div style="text-align: center; flex: 1;"><div class="day-dot inactive">D</div></div>
            </div>
            <p style="font-size: 10px; color: var(--gray); text-align: center; margin-top: 8px;">âœ“ 4/5 jours complÃ©tÃ©s cette semaine</p>
          </div>
          
          <!-- Ã€ faire aujourd'hui -->
          <div class="card">
            <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ğŸ¯ Ã€ faire aujourd'hui</h3>
            <div style="background: rgba(217,180,56,0.1); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
              <h4 style="color: var(--gold); font-size: 12px; margin-bottom: 8px;">ğŸ“ RÃ©visions Ã  rÃ©aliser</h4>
              <div style="display: flex; flex-direction: column; gap: 6px;">
                <div class="flex-between card-clickable" style="padding: 8px; background: white; border-radius: 6px;" onclick="showPage('revision-written')">
                  <span style="font-size: 12px; color: var(--gray);">Vocabulaire Ã©crit</span>
                  <span class="badge badge-gold" id="todo-vocab-written">10 mots</span>
                </div>
                <div class="flex-between card-clickable" style="padding: 8px; background: white; border-radius: 6px;" onclick="showPage('revision-oral')">
                  <span style="font-size: 12px; color: var(--gray);">Vocabulaire oral</span>
                  <span class="badge badge-gold" id="todo-vocab-oral">5 mots</span>
                </div>
                <div class="flex-between card-clickable" style="padding: 8px; background: white; border-radius: 6px;" onclick="showPage('revision-grammar')">
                  <span style="font-size: 12px; color: var(--gray);">RÃ¨gles grammaire</span>
                  <span class="badge badge-gold" id="todo-grammar">1 rÃ¨gle</span>
                </div>
              </div>
            </div>
            <div style="background: rgba(0,40,68,0.05); border-radius: 8px; padding: 12px;">
              <h4 style="color: var(--blue); font-size: 12px; margin-bottom: 8px;">ğŸ“š Apprendre</h4>
              <div style="display: flex; flex-direction: column; gap: 6px;">
                <div class="flex-between card-clickable" style="padding: 8px; background: white; border-radius: 6px;" onclick="showPage('learn-words')">
                  <span style="font-size: 12px; color: var(--gray);">Apprendre de nouveaux mots</span>
                  <span class="badge badge-blue">â†’</span>
                </div>
                <div class="flex-between card-clickable" style="padding: 8px; background: white; border-radius: 6px;" onclick="showPage('grammar')">
                  <span style="font-size: 12px; color: var(--gray);">Apprendre de nouvelles rÃ¨gles</span>
                  <span class="badge badge-blue">â†’</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Mon niveau cliquable avec graphiques Ã©volution (V11: CTA Ã©valuation ici) -->
          <div class="card card-clickable" id="home-level-block" onclick="showPage('evaluations')">
            <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ğŸ“Š Mon niveau <span style="font-size: 10px; color: var(--gray);">â†’ cliquez pour dÃ©tails</span></h3>
            <div class="grid-2" style="gap: 16px; margin-bottom: 12px;">
              <div>
                <div style="font-size: 11px; color: var(--gray);">CECRL</div>
                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
                  <span class="badge badge-blue" style="font-size: 14px; padding: 6px 14px;" id="home-cecrl-level">B1</span>
                  <span style="font-size: 12px; color: var(--gray);">IntermÃ©diaire</span>
                </div>
              </div>
              <div>
                <div style="font-size: 11px; color: var(--gray);">GRC (MÃ©tier)</div>
                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
                  <span class="badge badge-gold" style="font-size: 14px; padding: 6px 14px;" id="home-grc-level">IntermÃ©diaire</span>
                </div>
              </div>
            </div>
            <!-- V11: CTA Ã©valuation (affichÃ© si pas de donnÃ©es) -->
            <div id="home-level-cta" style="display: none; text-align: center; padding: 12px; background: rgba(217,180,56,0.1); border-radius: 8px; margin-bottom: 12px;">
              <p style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">Passe ta premiÃ¨re Ã©valuation pour connaÃ®tre ton niveau</p>
              <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); showExamWelcome('cecrl')">ğŸ“ Faire ma premiÃ¨re Ã©valuation</button>
            </div>
            <!-- Graphique Ã©volution CECRL -->
            <div style="margin-bottom: 8px;">
              <p style="font-size: 10px; color: var(--blue); font-weight: 600; margin-bottom: 4px;">ğŸ“ˆ Ã‰volution CECRL</p>
              <div id="home-cecrl-graph" style="display: flex; align-items: flex-end; gap: 2px; height: 50px; padding: 0 10px;">
                <!-- Rendu dynamique par renderEvolutionGraphs() -->
              </div>
            </div>
            <!-- Graphique Ã©volution GRC -->
            <div>
              <p style="font-size: 10px; color: var(--gold); font-weight: 600; margin-bottom: 4px;">ğŸ“ˆ Ã‰volution GRC MÃ©tier</p>
              <div id="home-grc-graph" style="display: flex; align-items: flex-end; gap: 2px; height: 50px; padding: 0 10px;">
                <!-- Rendu dynamique par renderEvolutionGraphs() -->
              </div>
            </div>
          </div>
        </div>
        
        <div class="flex-col">
          <!-- Ma progression (VERROUILLÃ‰) -->
          <div class="card">
            <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ğŸ“ˆ Ma progression</h3>
            <div id="home-progress-bars">
              <!-- Rendu dynamique par renderProgressBars() -->
            </div>
          </div>
          
          <!-- Classement famille (VERROUILLÃ‰) -->
          <div class="card">
            <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Classement famille</h3>
            <div class="flex-col" style="gap: 8px;">
              <div class="flex-between" style="padding: 8px; background: linear-gradient(135deg, rgba(217,180,56,0.2), rgba(217,180,56,0.1)); border-radius: 8px;">
                <div class="flex-row"><span style="font-size: 18px;">ğŸ¥‡</span><span style="font-weight: bold; color: var(--blue);">Pierre</span></div>
                <div class="flex-row"><span class="badge badge-gold">Or</span><span style="font-size: 12px; color: var(--gray);">5240 pts</span></div>
              </div>
              <div class="flex-between" style="padding: 8px; background: var(--light); border-radius: 8px;">
                <div class="flex-row"><span style="font-size: 18px;">ğŸ¥ˆ</span><span style="font-weight: bold; color: var(--blue);">Marie (vous)</span></div>
                <div class="flex-row"><span class="badge badge-gray">Argent</span><span style="font-size: 12px; color: var(--gray);">2350 pts</span></div>
              </div>
              <div class="flex-between" style="padding: 8px; background: var(--light); border-radius: 8px;">
                <div class="flex-row"><span style="font-size: 18px;">ğŸ¥‰</span><span style="font-weight: bold; color: var(--blue);">Jean</span></div>
                <div class="flex-row"><span class="badge badge-gray">Bronze</span><span style="font-size: 12px; color: var(--gray);">890 pts</span></div>
              </div>
            </div>
          </div>
          
          <!-- MÃ©daille du mois (VERROUILLÃ‰) -->
          <div class="card">
            <div class="flex-between">
              <div><h3 style="color: var(--blue); font-size: 14px;">ğŸ† MÃ©daille du mois</h3><p style="font-size: 11px; color: var(--gray);">Janvier 2026</p></div>
              <div style="text-align: center;"><span style="font-size: 32px;">ğŸ¥ˆ</span><div style="font-size: 18px; font-weight: bold; color: var(--gold);">2350 pts</div></div>
            </div>
            <div class="progress-bar" style="margin-top: 10px;"><div class="progress-fill" style="width: 47%; background: var(--gold);"></div></div>
            <div style="font-size: 10px; color: var(--gray); text-align: center; margin-top: 6px;">2350 / 5000 pts pour ğŸ¥‡ Or</div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE: RÃ‰VISION Ã‰CRITE - Ã‰valuation automatique (C) -->
    <div id="page-revision-written" class="page">
      <button class="btn btn-ghost" onclick="showPage('home')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“ RÃ©vision vocabulaire Ã©crit</h1>
      
      <!-- V11: Message si aucune donnÃ©e pour cette langue -->
      <div id="revision-written-empty" class="card" style="max-width: 600px; margin: 0 auto; text-align: center; display: none;">
        <span style="font-size: 48px;">ğŸ“­</span>
        <h3 style="color: var(--blue); margin: 16px 0;">Aucune donnÃ©e pour cette langue</h3>
        <p style="color: var(--gray); font-size: 13px; margin-bottom: 16px;">Le vocabulaire pour cette langue n'a pas encore Ã©tÃ© importÃ©.</p>
        <button class="btn btn-primary" onclick="showPage('home')">â† Retour Ã  l'accueil</button>
      </div>
      
      <!-- V11: Contenu normal si donnÃ©es disponibles -->
      <div id="revision-written-content" class="card" style="max-width: 600px; margin: 0 auto;">
        <div class="flex-between" style="margin-bottom: 16px;">
          <span class="badge badge-gold" id="revision-written-counter">Mot 1/10</span>
          <span style="font-size: 13px; color: var(--gray);">ThÃ¨me : <strong id="revision-written-theme">RÃ©unions</strong></span>
        </div>
        <div style="text-align: center; padding: 30px 0;">
          <p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;">Comment dit-on en anglais :</p>
          <h2 style="color: var(--blue); font-size: 28px; margin-bottom: 20px;" id="revision-written-word">RÃ©union</h2>
          <input type="text" id="revision-written-answer" placeholder="Tape ta rÃ©ponse ici..." style="max-width: 300px; text-align: center; font-size: 16px;" onkeypress="if(event.key==='Enter') checkRevisionWritten()">
        </div>
        <div id="revision-written-feedback" style="display: none; padding: 16px; border-radius: 10px; margin-bottom: 16px; text-align: center;"></div>
        <div class="flex-row" style="justify-content: center; gap: 12px;">
          <button class="btn btn-primary" onclick="checkRevisionWritten()">VÃ©rifier âœ“</button>
          <button class="btn btn-secondary" onclick="skipRevisionWord()">Passer â†’</button>
        </div>
        <p style="font-size: 10px; color: var(--gray); text-align: center; margin-top: 16px;">ğŸ’¡ L'Ã©valuation est automatique â€” pas besoin de te noter toi-mÃªme !</p>
      </div>
    </div>

    <!-- PAGE: RÃ‰VISION ORALE - Ã‰valuation automatique (D) -->
    <div id="page-revision-oral" class="page">
      <button class="btn btn-ghost" onclick="showPage('home')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ¤ RÃ©vision vocabulaire oral</h1>
      
      <!-- V11: Message si aucune donnÃ©e pour cette langue -->
      <div id="revision-oral-empty" class="card" style="max-width: 600px; margin: 0 auto; text-align: center; display: none;">
        <span style="font-size: 48px;">ğŸ“­</span>
        <h3 style="color: var(--blue); margin: 16px 0;">Aucune donnÃ©e pour cette langue</h3>
        <p style="color: var(--gray); font-size: 13px; margin-bottom: 16px;">Le vocabulaire oral pour cette langue n'a pas encore Ã©tÃ© importÃ©.</p>
        <button class="btn btn-primary" onclick="showPage('home')">â† Retour Ã  l'accueil</button>
      </div>
      
      <!-- V11: Contenu normal si donnÃ©es disponibles -->
      <div id="revision-oral-content" class="card" style="max-width: 600px; margin: 0 auto;">
        <div class="flex-between" style="margin-bottom: 16px;">
          <span class="badge badge-gold" id="revision-oral-counter">Mot 1/5</span>
          <span style="font-size: 13px; color: var(--gray);">ThÃ¨me : <strong id="revision-oral-theme">Voyage</strong></span>
        </div>
        <div style="text-align: center; padding: 30px 0;">
          <p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;">Prononce ce mot :</p>
          <h2 style="color: var(--blue); font-size: 28px; margin-bottom: 8px;" id="revision-oral-word">Airport</h2>
          <p style="color: var(--gray); font-size: 14px;" id="revision-oral-phonetic">/ËˆeÉ™pÉ”Ët/</p>
          <div style="margin: 20px 0;">
            <button class="btn btn-gold" onclick="playAudio(document.getElementById('revision-oral-word').textContent)" style="margin-right: 8px;">ğŸ”Š Ã‰couter le modÃ¨le</button>
            <button class="btn btn-accent" id="oral-record-btn" onclick="startOralRecording()">ğŸ¤ S'enregistrer</button>
          </div>
          <div id="oral-recording-status" style="font-size: 12px; color: var(--gray); min-height: 20px;"></div>
        </div>
        <div id="revision-oral-feedback" style="display: none; padding: 16px; border-radius: 10px; margin-bottom: 16px; text-align: center;"></div>
        <div class="flex-row" style="justify-content: center; gap: 12px;">
          <button class="btn btn-secondary" onclick="skipOralWord()">Mot suivant â†’</button>
        </div>
        <p style="font-size: 10px; color: var(--gray); text-align: center; margin-top: 16px;">ğŸ’¡ AprÃ¨s enregistrement, on Ã©value automatiquement ta prononciation !</p>
      </div>
    </div>

    <!-- PAGE: RÃ‰VISION GRAMMAIRE - Structure complÃ¨te (E) -->
    <div id="page-revision-grammar" class="page">
      <button class="btn btn-ghost" onclick="showPage('home')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">âœï¸ RÃ©vision grammaire</h1>
      <div class="card" style="max-width: 700px; margin: 0 auto;">
        <div class="flex-between" style="margin-bottom: 12px;">
          <span class="badge badge-gold" id="revision-grammar-counter">RÃ¨gle 1/2</span>
          <span class="badge badge-green">A1</span>
        </div>
        
        <!-- Structure rÃ¨gle complÃ¨te -->
        <h2 style="color: var(--blue); font-size: 18px; margin-bottom: 12px;" id="revision-rule-title">Present Simple</h2>
        
        <div style="margin-bottom: 16px;">
          <h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">ğŸ‡«ğŸ‡· DÃ©finition</h4>
          <p style="color: var(--gray); font-size: 13px; line-height: 1.6; background: var(--light); padding: 12px; border-radius: 8px;" id="revision-rule-def-fr">Le Present Simple exprime des habitudes, des vÃ©ritÃ©s gÃ©nÃ©rales et des faits permanents.</p>
        </div>
        
        <div style="margin-bottom: 16px;">
          <h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">ğŸ‡¬ğŸ‡§ Definition</h4>
          <p style="color: var(--gray); font-size: 13px; line-height: 1.6; background: var(--light); padding: 12px; border-radius: 8px;" id="revision-rule-def-en">The Present Simple expresses habits, general truths, and permanent situations.</p>
        </div>
        
        <div style="margin-bottom: 16px;">
          <h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">âš ï¸ Points d'attention</h4>
          <ul style="color: var(--gray); font-size: 13px; line-height: 1.8; padding-left: 20px;">
            <li>Ajouter -s/-es Ã  la 3Ã¨me personne du singulier</li>
            <li>Utiliser do/does pour les questions et nÃ©gations</li>
          </ul>
        </div>
        
        <div style="margin-bottom: 16px;">
          <h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">ğŸ’¡ Exemples</h4>
          <div style="background: var(--light); padding: 12px; border-radius: 8px;">
            <p style="color: var(--gray); font-size: 13px; margin-bottom: 6px;">âœ“ She <strong>works</strong> in London.</p>
            <p style="color: var(--gray); font-size: 13px;">âœ— She <strong style="color: var(--red);">work</strong> in London. (incorrect)</p>
          </div>
        </div>
        
        <!-- Zone exercices -->
        <div style="border-top: 2px solid var(--gold); padding-top: 16px; margin-top: 16px;">
          <h4 style="color: var(--gold); font-size: 14px; margin-bottom: 12px;">ğŸ“ Exercices (fais-en au moins 3 pour valider âœ…)</h4>
          <p style="color: var(--gray); font-size: 13px; margin-bottom: 8px;" id="revision-exercise-count">Exercice 1/5</p>
          
          <div style="background: var(--light); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
            <p style="color: var(--blue); font-size: 14px; margin-bottom: 12px;" id="revision-exercise-question">ComplÃ¨te : She ___ (work) every day.</p>
            <input type="text" id="revision-grammar-answer" placeholder="Ta rÃ©ponse..." style="max-width: 200px;" onkeypress="if(event.key==='Enter') checkGrammarExercise()">
          </div>
          
          <div id="revision-grammar-feedback" style="display: none; padding: 12px; border-radius: 8px; margin-bottom: 12px;"></div>
          
          <div class="flex-row" style="gap: 8px;">
            <button class="btn btn-primary" onclick="checkGrammarExercise()">VÃ©rifier</button>
            <button class="btn btn-secondary" onclick="nextGrammarExercise()">Exercice suivant</button>
            <button class="btn btn-gold" id="next-rule-btn" onclick="nextGrammarRule()" style="display: none;">RÃ¨gle suivante â†’</button>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE: APPRENDRE NOUVEAUX MOTS - Multi-thÃ¨mes (F) -->
    <div id="page-learn-words" class="page">
      <button class="btn btn-ghost" onclick="showPage('home')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“š Apprendre de nouveaux mots</h1>
      <div class="card" style="margin-bottom: 16px;">
        <h4 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">SÃ©lectionne tes thÃ¨mes (plusieurs possibles)</h4>
        <div class="grid-2" style="gap: 8px; margin-bottom: 16px;">
          <div class="theme-checkbox checked" onclick="toggleThemeCheckbox(this)" data-theme="meetings">
            <input type="checkbox" checked> <span>ğŸ’¼ RÃ©unions</span>
          </div>
          <div class="theme-checkbox" onclick="toggleThemeCheckbox(this)" data-theme="travel">
            <input type="checkbox"> <span>âœˆï¸ Voyage</span>
          </div>
          <div class="theme-checkbox checked" onclick="toggleThemeCheckbox(this)" data-theme="compliance">
            <input type="checkbox" checked> <span>ğŸ“‹ ConformitÃ©</span>
          </div>
          <div class="theme-checkbox" onclick="toggleThemeCheckbox(this)" data-theme="family">
            <input type="checkbox"> <span>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Famille</span>
          </div>
        </div>
        <div style="margin-bottom: 16px;">
          <label style="font-size: 12px; color: var(--gray);">Nombre de mots Ã  apprendre</label>
          <select id="learn-count" onchange="validateLearnCount()">
            <option value="5">5 mots</option>
            <option value="10" selected>10 mots</option>
            <option value="15">15 mots</option>
            <option value="20">20 mots</option>
          </select>
          <!-- Avertissement permanent (Correction 3) -->
          <p style="font-size: 11px; color: var(--orange); margin-top: 8px;">âš ï¸ Si tu sÃ©lectionnes plusieurs thÃ¨mes, il y aura au minimum 1 mot par thÃ¨me.</p>
          <p id="learn-count-warning" style="font-size: 11px; color: var(--red); margin-top: 4px; display: none;"></p>
        </div>
        <button class="btn btn-accent" id="btn-start-learning" onclick="startLearning()">ğŸš€ Commencer</button>
      </div>
      
      <!-- Zone apprentissage -->
      <div id="learn-area" style="display: none;">
        <div class="card" style="max-width: 600px; margin: 0 auto;">
          <div class="flex-between" style="margin-bottom: 16px;">
            <span class="badge badge-blue" id="learn-progress">Mot 1/10</span>
            <span class="badge badge-gray" id="learn-current-theme">RÃ©unions</span>
          </div>
          <div style="text-align: center; padding: 20px 0;">
            <div style="width: 100px; height: 100px; background: var(--light); border-radius: 12px; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 40px;" id="learn-emoji">ğŸ“…</div>
            <h2 style="color: var(--blue); font-size: 26px; margin-bottom: 6px;" id="learn-word-en">Meeting</h2>
            <p style="color: var(--gray); font-size: 16px;" id="learn-word-fr">RÃ©union</p>
            <p style="color: var(--gray); font-size: 12px; margin-top: 6px;" id="learn-phonetic">/ËˆmiËtÉªÅ‹/</p>
          </div>
          <div class="flex-row" style="justify-content: center; gap: 12px; margin-bottom: 16px;">
            <button class="btn btn-gold" onclick="playAudio(document.getElementById('learn-word-en').innerText)">ğŸ”Š Ã‰couter</button>
            <button class="btn btn-accent" onclick="toggleRecording()">ğŸ¤ Prononcer</button>
          </div>
          <div style="background: var(--light); padding: 14px; border-radius: 8px; margin-bottom: 16px;">
            <p style="font-size: 12px; color: var(--gray); margin-bottom: 6px;">ğŸ’¬ Exemple :</p>
            <p style="color: var(--blue); font-size: 14px;" id="learn-example"><em>"We have a <strong>meeting</strong> at 10am."</em></p>
          </div>
          <div class="flex-row" style="justify-content: center; gap: 12px;">
            <button class="btn btn-secondary" onclick="prevLearnWord()">â† PrÃ©cÃ©dent</button>
            <button class="btn btn-primary" onclick="nextLearnWord()">Suivant â†’</button>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE: Ã‰VALUATIONS - 2 boutons CECRL/GRC (G) -->
    <div id="page-evaluations" class="page">
      <button class="btn btn-ghost" onclick="showPage('home')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“Š Mes Ã©valuations</h1>
      
      <!-- V12 PROD: Zones reprise Ã©valuations - DEUX BLOCS DISTINCTS -->
      <!-- Bloc CECRL -->
      <div id="exam-resume-zone-cecrl" class="card" style="display: none; margin-bottom: 12px; border: 2px solid var(--blue); background: rgba(0,40,68,0.05);">
        <div class="flex-between" style="margin-bottom: 8px;">
          <div>
            <span style="font-size: 18px;">â¸ï¸</span>
            <strong style="color: var(--blue); margin-left: 6px;">Ã‰valuation CECRL en pause</strong>
          </div>
          <span class="badge badge-blue">ğŸ“ CECRL</span>
        </div>
        <p id="exam-resume-info-cecrl" style="font-size: 12px; color: var(--gray); margin-bottom: 10px;"></p>
        <div class="flex-row" style="gap: 8px;">
          <button class="btn btn-primary btn-sm" onclick="resumeSavedExam('cecrl')">â–¶ï¸ Poursuivre</button>
          <button class="btn btn-outline btn-sm" onclick="restartExam('cecrl')">ğŸ”„ Recommencer</button>
          <button class="btn btn-ghost btn-sm" onclick="abandonExam('cecrl')">ğŸ—‘ï¸</button>
        </div>
      </div>
      <!-- Bloc GRC -->
      <div id="exam-resume-zone-grc" class="card" style="display: none; margin-bottom: 12px; border: 2px solid var(--gold); background: rgba(217,180,56,0.05);">
        <div class="flex-between" style="margin-bottom: 8px;">
          <div>
            <span style="font-size: 18px;">â¸ï¸</span>
            <strong style="color: var(--gold); margin-left: 6px;">Ã‰valuation GRC en pause</strong>
          </div>
          <span class="badge badge-gold">ğŸ’¼ GRC</span>
        </div>
        <p id="exam-resume-info-grc" style="font-size: 12px; color: var(--gray); margin-bottom: 10px;"></p>
        <div class="flex-row" style="gap: 8px;">
          <button class="btn btn-gold btn-sm" onclick="resumeSavedExam('grc')">â–¶ï¸ Poursuivre</button>
          <button class="btn btn-outline btn-sm" onclick="restartExam('grc')">ğŸ”„ Recommencer</button>
          <button class="btn btn-ghost btn-sm" onclick="abandonExam('grc')">ğŸ—‘ï¸</button>
        </div>
      </div>
      
      <div class="grid-2">
        <!-- Carte CECRL -->
        <div class="card" style="border-left: 4px solid var(--blue);">
          <div class="flex-between" style="margin-bottom: 12px;">
            <h3 style="color: var(--blue); font-size: 14px;">ğŸ“ Niveau CECRL</h3>
            <span class="badge badge-blue" style="font-size: 16px;" id="eval-cecrl-level">B1</span>
          </div>
          <div style="background: var(--light); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
            <p style="font-size: 11px; color: var(--gray); margin-bottom: 8px;">Progression par compÃ©tence :</p>
            <div id="eval-cecrl-progress">
              <!-- Rendu dynamique par renderProgressBars() -->
            </div>
          </div>
          <button class="btn btn-primary btn-sm" style="width: 100%;" onclick="showExamWelcome('cecrl')">ğŸ“ Passer l'Ã©valuation CECRL</button>
        </div>

        <!-- Carte GRC -->
        <div class="card" style="border-left: 4px solid var(--gold);">
          <div class="flex-between" style="margin-bottom: 12px;">
            <h3 style="color: var(--gold); font-size: 14px;">ğŸ’¼ Niveau GRC MÃ©tier</h3>
            <span class="badge badge-gold" style="font-size: 16px;" id="eval-grc-level">IntermÃ©diaire</span>
          </div>
          <div style="background: var(--light); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
            <p style="font-size: 11px; color: var(--gray); margin-bottom: 8px;">Progression par section :</p>
            <div id="eval-grc-progress">
              <!-- Rendu dynamique par renderProgressBars() -->
            </div>
          </div>
          <button class="btn btn-gold btn-sm" style="width: 100%;" onclick="showExamWelcome('grc')">ğŸ’¼ Passer l'Ã©valuation GRC</button>
        </div>
      </div>

      <!-- Correction 3: Graphiques sÃ©parÃ©s CECRL / GRC -->
      <div class="grid-2" style="margin-top: 16px;">
        <div class="card">
          <h4 style="color: var(--blue); font-size: 13px; margin-bottom: 12px;">ğŸ“ˆ Ã‰volution CECRL</h4>
          <div id="eval-cecrl-graph" style="height: 100px; background: var(--light); border-radius: 8px; display: flex; align-items: flex-end; padding: 10px 15px; gap: 12px;">
            <!-- Rendu dynamique par renderEvolutionGraphs() -->
          </div>
        </div>
        <div class="card">
          <h4 style="color: var(--gold); font-size: 13px; margin-bottom: 12px;">ğŸ“ˆ Ã‰volution GRC MÃ©tier</h4>
          <div id="eval-grc-graph" style="height: 100px; background: var(--light); border-radius: 8px; display: flex; align-items: flex-end; padding: 10px 15px; gap: 12px;">
            <!-- Rendu dynamique par renderEvolutionGraphs() -->
          </div>
        </div>
      </div>

      <!-- Historique - Correction 4.6: lignes cliquables -->
      <div class="card" style="margin-top: 16px;">
        <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ğŸ“œ Historique des Ã©valuations</h3>
        <table>
          <thead><tr><th>Date</th><th>Type</th><th>Score</th><th>Niveau</th></tr></thead>
          <tbody id="eval-history-tbody">
            <!-- Rendu dynamique par renderHistory() -->
          </tbody>
        </table>
        <p style="font-size: 10px; color: var(--gray); margin-top: 8px;">ğŸ’¡ Cliquez sur une ligne pour voir le dÃ©tail</p>
      </div>
    </div>

    <!-- PAGE: EXAM WELCOME - Correction 4.1 -->
    <div id="page-exam-welcome" class="page">
      <div class="card" style="max-width: 600px; margin: 0 auto; text-align: center; padding: 30px;">
        <span id="exam-welcome-icon" style="font-size: 60px;">ğŸ“</span>
        <h2 id="exam-welcome-title" style="color: var(--blue); margin: 16px 0;">Bienvenue dans l'Ã©valuation</h2>
        <div id="exam-welcome-info" style="text-align: left; background: var(--light); border-radius: 8px; padding: 16px; margin-bottom: 20px;"></div>
        <!-- Correction 4.4: Choix thÃ¨mes GRC -->
        <div id="exam-grc-themes" style="display: none; text-align: left; margin-bottom: 20px;">
          <p style="font-size: 13px; color: var(--blue); font-weight: bold; margin-bottom: 12px;">SÃ©lectionne tes domaines GRC :</p>
          <div class="flex-wrap" style="gap: 8px;">
            <span class="chip active" onclick="this.classList.toggle('active')">ğŸ’¼ RÃ©unions</span>
            <span class="chip active" onclick="this.classList.toggle('active')">âš ï¸ Risque</span>
            <span class="chip" onclick="this.classList.toggle('active')">ğŸ” Audit</span>
            <span class="chip active" onclick="this.classList.toggle('active')">ğŸ“‹ ConformitÃ©</span>
            <span class="chip" onclick="this.classList.toggle('active')">ğŸ”’ ContrÃ´le interne</span>
            <span class="chip" onclick="this.classList.toggle('active')">ğŸ’¡ Consulting</span>
            <span class="chip" onclick="this.classList.toggle('active')">ğŸ›ï¸ Gouvernance</span>
          </div>
        </div>
        <div style="background: rgba(245,158,11,0.1); border-radius: 8px; padding: 12px; margin-bottom: 20px;">
          <p style="font-size: 12px; color: var(--orange);">âš ï¸ <strong>RÃ¨gles importantes :</strong></p>
          <ul style="font-size: 11px; color: var(--gray); text-align: left; padding-left: 20px; margin-top: 8px;">
            <li>Pas de retour en arriÃ¨re sur les questions</li>
            <li>Vous pouvez mettre en pause et reprendre plus tard</li>
            <li>Score final = pourcentage de bonnes rÃ©ponses</li>
          </ul>
        </div>
        <div class="flex-row" style="justify-content: center; gap: 12px;">
          <button class="btn btn-secondary" onclick="showPage('evaluations')">â† Retour</button>
          <button class="btn btn-primary" onclick="startExam()">ğŸš€ Commencer</button>
        </div>
      </div>
    </div>

    <!-- PAGE: EXAM SECTION INTRO - Correction V11: Ã‰cran intro AVANT chaque section -->
    <div id="page-exam-section-intro" class="page">
      <div class="card" style="max-width: 600px; margin: 0 auto; text-align: center; padding: 30px;">
        <span id="section-intro-icon" style="font-size: 50px;">ğŸ“–</span>
        <h2 id="section-intro-title" style="color: var(--blue); margin: 16px 0;">Section 1/6 â€” Vocabulaire</h2>
        <div style="background: var(--light); border-radius: 8px; padding: 16px; margin-bottom: 20px; text-align: left;">
          <p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;"><strong>ğŸ“ Nombre de questions :</strong> 20</p>
          <p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;"><strong>â±ï¸ Type :</strong> Choix unique</p>
          <p style="font-size: 13px; color: var(--gray);"><strong>ğŸ“Š Objectif :</strong> Score affichÃ© Ã  la fin de la section</p>
        </div>
        <div style="background: rgba(217,180,56,0.1); border-radius: 8px; padding: 12px; margin-bottom: 20px;">
          <p style="font-size: 12px; color: var(--gold);">ğŸ’¡ <strong>Conseil :</strong> Prenez votre temps, vous pouvez mettre en pause Ã  tout moment.</p>
        </div>
        <div class="flex-row" style="justify-content: center; gap: 12px;">
          <button class="btn btn-secondary" onclick="pauseExamFromIntro()">â¸ï¸ Plus tard</button>
          <button class="btn btn-primary" onclick="startSection()">ğŸš€ Commencer la section</button>
        </div>
      </div>
    </div>

    <!-- PAGE: EXAMEN EN COURS - Correction 4.2: boutons Pause/Quitter -->
    <div id="page-exam" class="page">
      <div class="flex-between" style="margin-bottom: 16px;">
        <span class="badge badge-blue" id="exam-progress">Section 1/6 â€¢ Q1/20</span>
        <div class="flex-row" style="gap: 6px;">
          <button class="btn btn-secondary btn-xs" onclick="pauseExam()">â¸ï¸ Pause</button>
          <button class="btn btn-red btn-xs" onclick="confirmQuitExam()">âœ• Quitter</button>
        </div>
      </div>
      <div class="progress-bar" style="margin-bottom: 16px;"><div class="progress-fill" id="exam-progress-bar" style="width: 1%; background: var(--blue);"></div></div>
      <div class="card" style="max-width: 600px; margin: 0 auto;">
        <h3 id="exam-section-title" style="color: var(--blue); font-size: 14px; margin-bottom: 16px;">ğŸ“– Section : Vocabulaire</h3>
        <div style="padding: 20px; background: var(--light); border-radius: 8px; margin-bottom: 16px;">
          <p style="font-size: 15px; color: var(--blue);" id="exam-question">Quelle est la traduction de "Meeting" ?</p>
        </div>
        <div id="exam-options">
          <button class="quiz-option" onclick="answerExam(this, true)">RÃ©union</button>
          <button class="quiz-option" onclick="answerExam(this, false)">Rapport</button>
          <button class="quiz-option" onclick="answerExam(this, false)">ConfÃ©rence</button>
          <button class="quiz-option" onclick="answerExam(this, false)">Bureau</button>
        </div>
      </div>
    </div>

    <!-- PAGE: EXAM SECTION END - Correction 4.3 -->
    <div id="page-exam-section-end" class="page">
      <div class="card" style="max-width: 500px; margin: 0 auto; text-align: center; padding: 30px;">
        <span style="font-size: 50px;">âœ…</span>
        <h2 id="section-end-title" style="color: var(--blue); margin: 16px 0;">Section terminÃ©e !</h2>
        <div style="background: var(--light); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
          <p style="font-size: 14px; color: var(--gray);">Score de cette section :</p>
          <p id="section-end-score" style="font-size: 32px; font-weight: bold; color: var(--green);">18/20</p>
        </div>
        <p id="section-end-next" style="font-size: 13px; color: var(--gray); margin-bottom: 20px;">Section suivante : Grammaire (20 questions)</p>
        <div class="flex-row" style="justify-content: center; gap: 12px;">
          <button class="btn btn-secondary" onclick="showPage('evaluations')">ğŸ“… Plus tard</button>
          <button class="btn btn-primary" onclick="continueExam()">â–¶ï¸ Continuer maintenant</button>
        </div>
      </div>
    </div>

    <!-- PAGE: EXAM RESULT -->
    <div id="page-exam-result" class="page">
      <div class="card" style="max-width: 600px; margin: 0 auto; text-align: center; padding: 30px;">
        <span style="font-size: 60px;">ğŸ‰</span>
        <h2 style="color: var(--blue); margin: 16px 0;">Ã‰valuation terminÃ©e !</h2>
        <div style="background: linear-gradient(135deg, var(--blue), #003d66); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
          <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Ton niveau</p>
          <p id="exam-result-level" style="color: var(--gold); font-size: 42px; font-weight: bold;">B1</p>
          <p id="exam-result-score" style="color: white; font-size: 14px;">Score : 78/120 (65%)</p>
        </div>
        <div id="exam-result-sections" style="text-align: left; margin-bottom: 20px;"></div>
        <button class="btn btn-primary" onclick="showPage('evaluations')">â† Retour aux Ã©valuations</button>
      </div>
    </div>

    <!-- PAGE: HISTORY DETAIL - Correction 4.6 -->
    <div id="page-history-detail" class="page">
      <button class="btn btn-ghost" onclick="showPage('evaluations')" style="margin-bottom: 12px;">â† Retour</button>
      <div class="card" style="max-width: 600px; margin: 0 auto;">
        <div class="flex-between" style="margin-bottom: 16px;">
          <h2 style="color: var(--blue); font-size: 18px;">ğŸ“‹ DÃ©tail de l'Ã©valuation</h2>
          <span id="history-detail-level" class="badge badge-blue">B1</span>
        </div>
        <div class="grid-2" style="margin-bottom: 16px;">
          <div><p style="font-size: 11px; color: var(--gray);">Date</p><p style="font-size: 14px; color: var(--blue);" id="history-detail-date">15/01/2026</p></div>
          <div><p style="font-size: 11px; color: var(--gray);">Type</p><p style="font-size: 14px; color: var(--blue);" id="history-detail-type">Ã‰valuation CECRL</p></div>
        </div>
        <div style="background: var(--light); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
          <p style="font-size: 12px; color: var(--gray);">Score global</p>
          <p style="font-size: 28px; font-weight: bold; color: var(--green);" id="history-detail-score">78/120 (65%)</p>
        </div>
        <h4 style="color: var(--blue); font-size: 13px; margin-bottom: 12px;">DÃ©tail par section</h4>
        <div id="history-detail-sections">
          <div style="margin-bottom: 8px; padding: 10px; background: white; border-radius: 6px; border-left: 3px solid var(--green);"><div class="flex-between"><span style="font-size: 12px;">ğŸ“– Vocabulaire</span><span style="font-size: 12px; color: var(--green);">16/20 (80%)</span></div></div>
          <div style="margin-bottom: 8px; padding: 10px; background: white; border-radius: 6px; border-left: 3px solid var(--green);"><div class="flex-between"><span style="font-size: 12px;">âœï¸ Grammaire</span><span style="font-size: 12px; color: var(--green);">14/20 (70%)</span></div></div>
          <div style="margin-bottom: 8px; padding: 10px; background: white; border-radius: 6px; border-left: 3px solid var(--orange);"><div class="flex-between"><span style="font-size: 12px;">ğŸ“„ Lecture</span><span style="font-size: 12px; color: var(--orange);">12/20 (60%)</span></div></div>
        </div>
        <div style="margin-top: 16px; padding: 12px; background: rgba(239,68,68,0.1); border-radius: 8px;">
          <p style="font-size: 12px; color: var(--red); font-weight: bold;">âš ï¸ Points Ã  amÃ©liorer</p>
          <p style="font-size: 11px; color: var(--gray); margin-top: 4px;">Oral (55%) - Pratique la prononciation avec le Coach IA</p>
        </div>
      </div>
    </div>

    <!-- PAGE: VOCABULAIRE (VERROUILLÃ‰ liste) -->
    <div id="page-vocab" class="page">
      <div class="flex-between" style="margin-bottom: 16px;">
        <div><h1 style="color: var(--blue); font-size: 20px;">ğŸ“– Vocabulaire</h1><p style="color: var(--gray); font-size: 12px;">245 mots appris sur 500</p></div>
        <div class="flex-row">
          <button class="btn btn-outline btn-sm" onclick="openModal('add-word')">+ Proposer un mot</button>
          <button class="btn btn-gold" onclick="showPage('flashcards'); setFlashcardContext('vocab')">ğŸƒ Flashcards mÃ©langÃ©es</button>
        </div>
      </div>
      <div class="card" style="margin-bottom: 12px;">
        <div class="flex-row" style="flex-wrap: wrap; gap: 12px;">
          <div><label style="font-size: 11px; color: var(--gray);">Type</label><select id="vocab-type-filter" onchange="filterVocabByType()" style="width: auto; margin-left: 8px;"><option value="all">Tous</option><option value="pro">Professionnels</option><option value="perso">Personnels</option></select></div>
          <div><label style="font-size: 11px; color: var(--gray);">MaÃ®trise</label><select id="vocab-mastery-filter" onchange="filterVocabByMastery()" style="width: auto; margin-left: 8px;"><option value="all">Tous</option><option value="mastered">âœ“ MaÃ®trisÃ©s</option><option value="medium">~ Moyens</option><option value="weak">âœ— Non maÃ®trisÃ©s</option></select></div>
        </div>
      </div>
      <div class="grid-3" id="vocab-themes-grid">
        <!-- Rendu dynamique par renderVocabThemes() -->
      </div>
    </div>

    <!-- PAGE: THÃˆME VOCABULAIRE (VERROUILLÃ‰) -->
    <div id="page-vocab-theme" class="page">
      <button class="btn btn-ghost" onclick="showPage('vocab')" style="margin-bottom: 12px;">â† Retour</button>
      <div class="flex-between" style="margin-bottom: 16px;">
        <div><h1 style="color: var(--blue); font-size: 20px;">ğŸ’¼ RÃ©unions</h1><p style="color: var(--gray); font-size: 12px;">42 mots â€¢ 75% maÃ®trisÃ©</p></div>
        <button class="btn btn-gold" onclick="showPage('flashcards'); setFlashcardContext('theme')">ğŸƒ Flashcards du thÃ¨me</button>
      </div>
      <p style="font-size: 11px; color: var(--gray); margin-bottom: 12px;">ğŸ’¡ Clique sur un mot pour voir le dÃ©tail (dÃ©finition + exemple)</p>
      
      <!-- Correction 6: AccordÃ©on vocabulaire avec dÃ©tail -->
      <div class="word-item-container">
        <div class="word-item-header" onclick="toggleWordDetail('meeting')">
          <div class="flex-row" style="gap: 10px;">
            <span class="badge badge-green" style="font-size: 8px; padding: 2px 6px;">âœ“</span>
            <div><strong style="color: var(--blue);">Meeting</strong><span style="color: var(--gray); font-size: 12px; margin-left: 8px;">RÃ©union</span></div>
          </div>
          <div class="flex-row" style="gap: 8px;">
            <button class="audio-btn" onclick="event.stopPropagation(); playAudio('Meeting')">ğŸ”Š</button>
            <span style="color: var(--gray);">â–¼</span>
          </div>
        </div>
        <div class="word-detail" id="meeting-detail">
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">PhonÃ©tique</p>
          <p style="font-size: 13px; color: var(--blue); margin-bottom: 8px;">/ËˆmiËtÉªÅ‹/</p>
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">DÃ©finition EN</p>
          <p style="font-size: 13px; color: var(--blue); margin-bottom: 8px;">A gathering of people for a specific purpose, especially for formal discussion.</p>
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">Exemple EN</p>
          <p style="font-size: 13px; color: var(--blue); font-style: italic;">"We have a team meeting every Monday morning."</p>
        </div>
      </div>
      
      <div class="word-item-container">
        <div class="word-item-header" onclick="toggleWordDetail('agenda')">
          <div class="flex-row" style="gap: 10px;">
            <span class="badge badge-green" style="font-size: 8px; padding: 2px 6px;">âœ“</span>
            <div><strong style="color: var(--blue);">Agenda</strong><span style="color: var(--gray); font-size: 12px; margin-left: 8px;">Ordre du jour</span></div>
          </div>
          <div class="flex-row" style="gap: 8px;">
            <button class="audio-btn" onclick="event.stopPropagation(); playAudio('Agenda')">ğŸ”Š</button>
            <span style="color: var(--gray);">â–¼</span>
          </div>
        </div>
        <div class="word-detail" id="agenda-detail">
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">PhonÃ©tique</p>
          <p style="font-size: 13px; color: var(--blue); margin-bottom: 8px;">/É™ËˆdÊ’endÉ™/</p>
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">DÃ©finition EN</p>
          <p style="font-size: 13px; color: var(--blue); margin-bottom: 8px;">A list of items to be discussed or acted upon at a meeting.</p>
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">Exemple EN</p>
          <p style="font-size: 13px; color: var(--blue); font-style: italic;">"Please send me the agenda before the meeting."</p>
        </div>
      </div>
      
      <div class="word-item-container">
        <div class="word-item-header" onclick="toggleWordDetail('minutes')">
          <div class="flex-row" style="gap: 10px;">
            <span class="badge badge-orange" style="font-size: 8px; padding: 2px 6px;">~</span>
            <div><strong style="color: var(--blue);">Minutes</strong><span style="color: var(--gray); font-size: 12px; margin-left: 8px;">Compte-rendu</span></div>
          </div>
          <div class="flex-row" style="gap: 8px;">
            <button class="audio-btn" onclick="event.stopPropagation(); playAudio('Minutes')">ğŸ”Š</button>
            <span style="color: var(--gray);">â–¼</span>
          </div>
        </div>
        <div class="word-detail" id="minutes-detail">
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">PhonÃ©tique</p>
          <p style="font-size: 13px; color: var(--blue); margin-bottom: 8px;">/ËˆmÉªnÉªts/</p>
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">DÃ©finition EN</p>
          <p style="font-size: 13px; color: var(--blue); margin-bottom: 8px;">The official written record of what was said and decided during a meeting.</p>
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">Exemple EN</p>
          <p style="font-size: 13px; color: var(--blue); font-style: italic;">"Could you take the minutes during today's meeting?"</p>
        </div>
      </div>
      
      <div class="word-item-container">
        <div class="word-item-header" onclick="toggleWordDetail('attendee')">
          <div class="flex-row" style="gap: 10px;">
            <span class="badge badge-red" style="font-size: 8px; padding: 2px 6px;">âœ—</span>
            <div><strong style="color: var(--blue);">Attendee</strong><span style="color: var(--gray); font-size: 12px; margin-left: 8px;">Participant</span></div>
          </div>
          <div class="flex-row" style="gap: 8px;">
            <button class="audio-btn" onclick="event.stopPropagation(); playAudio('Attendee')">ğŸ”Š</button>
            <span style="color: var(--gray);">â–¼</span>
          </div>
        </div>
        <div class="word-detail" id="attendee-detail">
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">PhonÃ©tique</p>
          <p style="font-size: 13px; color: var(--blue); margin-bottom: 8px;">/ËŒÃ¦tenËˆdiË/</p>
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">DÃ©finition EN</p>
          <p style="font-size: 13px; color: var(--blue); margin-bottom: 8px;">A person who attends or is present at a meeting, event, or gathering.</p>
          <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">Exemple EN</p>
          <p style="font-size: 13px; color: var(--blue); font-style: italic;">"All attendees must register before entering the conference room."</p>
        </div>
      </div>
    </div>

    <!-- PAGE: GRAMMAIRE - Filtres dÃ©cochables (I) -->
    <div id="page-grammar" class="page">
      <div class="flex-between" style="margin-bottom: 16px;">
        <div><h1 style="color: var(--blue); font-size: 20px;">âœï¸ Grammaire</h1><p style="color: var(--gray); font-size: 12px;">12 rÃ¨gles maÃ®trisÃ©es sur 35</p></div>
        <button class="btn btn-gold" onclick="showPage('irregular-verbs')">ğŸ“ Verbes irrÃ©guliers</button>
      </div>
      <!-- Filtres dÃ©cochables -->
      <div class="card" style="margin-bottom: 12px;">
        <span style="font-size: 13px; font-weight: 600; color: var(--blue); margin-right: 12px;">Niveaux :</span>
        <span class="chip active" onclick="toggleGrammarFilter(this, 'A1')">A1</span>
        <span class="chip active" onclick="toggleGrammarFilter(this, 'A2')">A2</span>
        <span class="chip active" onclick="toggleGrammarFilter(this, 'B1')">B1</span>
        <span class="chip" onclick="toggleGrammarFilter(this, 'B2')" style="opacity: 0.5;">B2 ğŸ”’</span>
        <p style="font-size: 10px; color: var(--gray); margin-top: 8px;">ğŸ’¡ Clique pour cocher/dÃ©cocher un niveau</p>
      </div>
      <div class="flex-col" id="grammar-rules-list">
        <div class="card card-clickable" onclick="showPage('grammar-rule')" data-level="A1">
          <div class="flex-between">
            <div class="flex-row"><span class="badge badge-green">A1</span><div style="margin-left: 12px;"><h4 style="color: var(--blue); font-size: 14px;">Present Simple</h4><p style="font-size: 11px; color: var(--gray);">45 exercices</p></div></div>
            <div class="flex-row"><span class="badge badge-green">âœ“ MaÃ®trisÃ©</span><button class="audio-btn" onclick="event.stopPropagation(); playAudio('Present Simple')">ğŸ”Š</button></div>
          </div>
        </div>
        <div class="card card-clickable" onclick="showPage('grammar-rule')" data-level="A2">
          <div class="flex-between">
            <div class="flex-row"><span class="badge badge-blue">A2</span><div style="margin-left: 12px;"><h4 style="color: var(--blue); font-size: 14px;">Past Simple</h4><p style="font-size: 11px; color: var(--gray);">52 exercices</p></div></div>
            <div class="flex-row"><span class="badge badge-orange">~ En cours</span><button class="audio-btn" onclick="event.stopPropagation(); playAudio('Past Simple')">ğŸ”Š</button></div>
          </div>
        </div>
        <div class="card card-clickable" onclick="showPage('grammar-rule')" data-level="B1">
          <div class="flex-between">
            <div class="flex-row"><span class="badge badge-gold">B1</span><div style="margin-left: 12px;"><h4 style="color: var(--blue); font-size: 14px;">Present Perfect</h4><p style="font-size: 11px; color: var(--gray);">48 exercices</p></div></div>
            <div class="flex-row"><span class="badge badge-red">âœ— Non vu</span><button class="audio-btn" onclick="event.stopPropagation(); playAudio('Present Perfect')">ğŸ”Š</button></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE: RÃˆGLE GRAMMAIRE -->
    <div id="page-grammar-rule" class="page">
      <button class="btn btn-ghost" onclick="showPage('grammar')" style="margin-bottom: 12px;">â† Retour</button>
      <div class="card" style="margin-bottom: 16px;">
        <div class="flex-between" style="margin-bottom: 12px;">
          <div><h1 style="color: var(--blue); font-size: 20px;">Present Simple</h1><div class="flex-row" style="margin-top: 6px;"><span class="badge badge-green">A1</span><span class="badge badge-green">âœ“ MaÃ®trisÃ©</span></div></div>
          <div class="flex-row" style="gap: 6px;">
            <button class="btn btn-gold btn-sm" onclick="playFullGrammarAudio()">â–¶ Ã‰couter tout</button>
            <button class="btn btn-orange btn-sm" onclick="pauseAudio()">â¸ Pause</button>
            <button class="btn btn-red btn-sm" onclick="stopAudio()">â¹ Stop</button>
          </div>
        </div>
        <div style="margin-bottom: 16px;"><h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">ğŸ‡«ğŸ‡· DÃ©finition</h4><p style="color: var(--gray); font-size: 13px; line-height: 1.6; background: var(--light); padding: 12px; border-radius: 8px;">Le Present Simple exprime des habitudes, des vÃ©ritÃ©s gÃ©nÃ©rales et des faits permanents.</p></div>
        <div style="margin-bottom: 16px;"><h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">ğŸ‡¬ğŸ‡§ Definition</h4><p style="color: var(--gray); font-size: 13px; line-height: 1.6; background: var(--light); padding: 12px; border-radius: 8px;">The Present Simple expresses habits, general truths, and permanent situations.</p></div>
        <div style="margin-bottom: 16px;"><h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">âš ï¸ Points d'attention</h4><ul style="color: var(--gray); font-size: 13px; line-height: 1.8; padding-left: 20px;"><li>Ajouter -s/-es Ã  la 3Ã¨me personne du singulier</li><li>Utiliser do/does pour les questions et nÃ©gations</li></ul></div>
        <div><h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">ğŸ’¡ Exemples</h4><div style="background: var(--light); padding: 12px; border-radius: 8px;"><p style="color: var(--gray); font-size: 13px; margin-bottom: 6px;">âœ“ She <strong>works</strong> in London.</p><p style="color: var(--gray); font-size: 13px;">âœ— She <strong style="color: var(--red);">work</strong> in London.</p></div></div>
      </div>
      <button class="btn btn-primary" onclick="showPage('grammar-exercises')">ğŸ“ Faire les exercices (45)</button>
    </div>

    <!-- PAGE: EXERCICES GRAMMAIRE -->
    <div id="page-grammar-exercises" class="page">
      <button class="btn btn-ghost" onclick="showPage('grammar-rule')" style="margin-bottom: 12px;">â† Retour Ã  la rÃ¨gle</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“ Exercices : Present Simple</h1>
      <div class="card" style="max-width: 600px;">
        <div class="flex-between" style="margin-bottom: 16px;"><span class="badge badge-blue">Exercice 1/45</span><span style="font-size: 13px; color: var(--gray);">Score : <strong id="exercise-score">0</strong></span></div>
        <div style="margin-bottom: 20px;">
          <p style="color: var(--blue); font-size: 15px; font-weight: 600; margin-bottom: 16px;">ComplÃ¨te : She ___ (work) in a bank.</p>
          <input type="text" id="exercise-answer" placeholder="Ta rÃ©ponse..." style="font-size: 16px;" onkeypress="if(event.key==='Enter') checkExercise()">
        </div>
        <div class="flex-row" style="gap: 8px;">
          <button class="btn btn-primary" onclick="checkExercise()">VÃ©rifier</button>
          <button class="btn btn-secondary" onclick="skipExercise()">Passer</button>
          <button class="btn btn-ghost" onclick="showPage('grammar-rule')">â† Retour</button>
        </div>
        <div id="exercise-feedback" style="margin-top: 16px; display: none; padding: 12px; border-radius: 8px;"></div>
      </div>
    </div>

    <!-- PAGE: VERBES IRRÃ‰GULIERS - Retour V5 (J) -->
    <div id="page-irregular-verbs" class="page">
      <button class="btn btn-ghost" onclick="showPage('grammar')" style="margin-bottom: 12px;">â† Retour Ã  la grammaire</button>
      <div class="flex-between" style="margin-bottom: 16px;">
        <h1 style="color: var(--blue); font-size: 20px;">ğŸ“ Verbes irrÃ©guliers</h1>
        <button class="btn btn-outline btn-sm" id="admin-edit-verbs" onclick="openModal('edit-verbs')" style="display: none;">âœï¸ Modifier rÃ¨gles</button>
      </div>
      
      <!-- Introduction -->
      <div class="card" style="background: rgba(59,130,246,0.05); margin-bottom: 16px;">
        <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 8px;">Qu'est-ce qu'un verbe irrÃ©gulier ?</h3>
        <p style="color: var(--gray); font-size: 13px; line-height: 1.6; margin-bottom: 12px;">
          Les verbes irrÃ©guliers anglais ne suivent pas la rÃ¨gle standard en <strong>-ed</strong> au passÃ©. 
          Ils ont des formes spÃ©cifiques au <strong>Past Simple</strong> et au <strong>Past Participle</strong>.
        </p>
        <h4 style="color: var(--blue); font-size: 13px; margin-bottom: 6px;">Quand les utiliser ?</h4>
        <ul style="color: var(--gray); font-size: 12px; line-height: 1.8; padding-left: 20px;">
          <li>Au Past Simple : <em>"I went to the store yesterday."</em></li>
          <li>Au Present Perfect : <em>"I have seen this movie."</em></li>
          <li>Au Past Perfect : <em>"She had written the report."</em></li>
          <li>Dans les constructions passives : <em>"The cake was eaten."</em></li>
        </ul>
      </div>
      
      <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">Groupes mnÃ©motechniques</h3>
      <div class="grid-3">
        <div class="card card-clickable" onclick="showVerbGroup('AAA')">
          <span class="badge badge-gold" style="margin-bottom: 8px;">AAA</span>
          <h4 style="color: var(--blue); font-size: 13px;">Les 3 formes identiques</h4>
          <p style="font-size: 11px; color: var(--gray); margin-top: 6px;">cut â†’ cut â†’ cut</p>
          <p style="font-size: 10px; color: var(--accent); margin-top: 4px;">8 verbes</p>
        </div>
        <div class="card card-clickable" onclick="showVerbGroup('ABB')">
          <span class="badge badge-gold" style="margin-bottom: 8px;">ABB</span>
          <h4 style="color: var(--blue); font-size: 13px;">Past = Past Participle</h4>
          <p style="font-size: 11px; color: var(--gray); margin-top: 6px;">bring â†’ brought â†’ brought</p>
          <p style="font-size: 10px; color: var(--accent); margin-top: 4px;">25 verbes</p>
        </div>
        <div class="card card-clickable" onclick="showVerbGroup('ABC')">
          <span class="badge badge-gold" style="margin-bottom: 8px;">ABC</span>
          <h4 style="color: var(--blue); font-size: 13px;">Les 3 formes diffÃ©rentes</h4>
          <p style="font-size: 11px; color: var(--gray); margin-top: 6px;">go â†’ went â†’ gone</p>
          <p style="font-size: 10px; color: var(--accent); margin-top: 4px;">35 verbes</p>
        </div>
      </div>
    </div>

    <!-- PAGE: GROUPE VERBES -->
    <div id="page-verb-group" class="page">
      <button class="btn btn-ghost" onclick="showPage('irregular-verbs')" style="margin-bottom: 12px;">â† Retour aux groupes</button>
      <div class="card" style="margin-bottom: 16px;">
        <div class="flex-between" style="margin-bottom: 12px;">
          <div><h1 style="color: var(--blue); font-size: 18px;" id="verb-group-title">Groupe AAA</h1><p style="color: var(--gray); font-size: 12px;" id="verb-group-rule">Les trois formes sont identiques.</p></div>
          <button class="btn btn-ghost btn-sm" id="verb-group-edit-btn" style="display: none;" onclick="openModal('edit-verb-group')">âœï¸ Modifier</button>
        </div>
        <table>
          <thead><tr><th>Base</th><th>Past</th><th>Past Participle</th><th>FranÃ§ais</th><th>ğŸ”Š</th></tr></thead>
          <tbody id="verb-table-body">
            <tr><td><strong>cut</strong></td><td>cut</td><td>cut</td><td>couper</td><td><button class="audio-btn" onclick="playAudio('cut, cut, cut')">ğŸ”Š</button></td></tr>
            <tr><td><strong>put</strong></td><td>put</td><td>put</td><td>mettre</td><td><button class="audio-btn" onclick="playAudio('put, put, put')">ğŸ”Š</button></td></tr>
            <tr><td><strong>let</strong></td><td>let</td><td>let</td><td>laisser</td><td><button class="audio-btn" onclick="playAudio('let, let, let')">ğŸ”Š</button></td></tr>
            <tr><td><strong>set</strong></td><td>set</td><td>set</td><td>placer</td><td><button class="audio-btn" onclick="playAudio('set, set, set')">ğŸ”Š</button></td></tr>
          </tbody>
        </table>
      </div>
      <div class="flex-row">
        <button class="btn btn-primary" onclick="showPage('verb-exercises')">ğŸ“ Exercices</button>
        <button class="btn btn-gold" onclick="showPage('verb-flashcards')">ğŸƒ Flashcards verbes</button>
      </div>
    </div>

    <!-- PAGE: LECTURE - AccordÃ©on par niveau (K) -->
    <div id="page-reading" class="page">
      <div class="flex-between" style="margin-bottom: 16px;">
        <div><h1 style="color: var(--blue); font-size: 20px;">ğŸ“„ Lecture</h1><p style="color: var(--gray); font-size: 12px;">Textes adaptÃ©s Ã  votre niveau</p></div>
      </div>
      
      <!-- Liste dynamique des textes -->
      <div id="reading-texts-list">
        <!-- Rendu dynamique par renderReadingTexts() -->
      </div>
    </div>

    <!-- PAGE: LECTURE TEXTE -->
    <div id="page-reading-text" class="page">
      <button class="btn btn-ghost" onclick="showPage('reading')" style="margin-bottom: 12px;">â† Retour</button>
      <div class="card">
        <div class="flex-between" style="margin-bottom: 12px;">
          <div><h1 style="color: var(--blue); font-size: 18px;">Business Meeting Etiquette</h1><div class="flex-row" style="margin-top: 6px;"><span class="badge badge-blue">B1</span><span class="badge badge-gray">meetings</span></div></div>
          <div class="flex-row" style="gap: 6px;">
            <button class="btn btn-green btn-sm" onclick="startReadingAudio()">â–¶ Start</button>
            <button class="btn btn-orange btn-sm" onclick="pauseReadingAudio()">â¸ Pause</button>
            <button class="btn btn-red btn-sm" onclick="stopReadingAudio()">â¹ Stop</button>
          </div>
        </div>
        <p style="font-size: 11px; color: var(--gray); margin-bottom: 12px;">ğŸ’¡ SÃ©lectionne du texte pour l'Ã©couter ou double-clique sur un mot soulignÃ© pour l'ajouter</p>
        <!-- Correction 6: Texte avec sÃ©lection -->
        <div style="background: var(--light); border-radius: 10px; padding: 20px; line-height: 1.8; font-size: 14px; color: var(--gray);" id="reading-content" onmouseup="handleTextSelection(event)">
          <p style="margin-bottom: 16px;">In today's professional world, <span class="clickable-word" data-word="meetings" data-def="RÃ©unions" ondblclick="addWordFromReading(this)">meetings</span> are essential. Whether attending a team <span class="clickable-word" data-word="meeting" data-def="RÃ©union" ondblclick="addWordFromReading(this)">meeting</span> or presenting to clients, proper <span class="clickable-word" data-word="etiquette" data-def="Ã‰tiquette, bonnes maniÃ¨res" ondblclick="addWordFromReading(this)">etiquette</span> is crucial.</p>
          <p style="margin-bottom: 16px;">First, always arrive on time. <span class="clickable-word" data-word="punctuality" data-def="PonctualitÃ©" ondblclick="addWordFromReading(this)">Punctuality</span> shows respect for others' <span class="clickable-word" data-word="schedule" data-def="Planning, emploi du temps" ondblclick="addWordFromReading(this)">schedule</span>.</p>
          <p>Finally, practice active <span class="clickable-word" data-word="listening" data-def="Ã‰coute" ondblclick="addWordFromReading(this)">listening</span>. Pay attention when others speak.</p>
        </div>
      </div>
      
      <!-- Correction 6.1: Toolbar sÃ©lection -->
      <div id="selection-toolbar">
        <button onclick="playSelectedText()">ğŸ”Š Ã‰couter</button>
        <button onclick="showWordPopupFromSelection()">ğŸ“– Infos</button>
      </div>
      
      <!-- Correction 6.3: Popup infos mot -->
      <div id="text-selection-popup">
        <div class="flex-between" style="margin-bottom: 12px;">
          <h4 id="popup-word-title" style="color: var(--blue);">Meeting</h4>
          <button class="btn btn-ghost btn-xs" onclick="closeTextPopup()">âœ•</button>
        </div>
        <p id="popup-word-phonetic" style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">/ËˆmiËtÉªÅ‹/</p>
        <p style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">Traduction FR :</p>
        <p id="popup-word-def-fr" style="font-size: 14px; color: var(--blue); margin-bottom: 12px;">RÃ©union</p>
        <div class="flex-row" style="gap: 8px;">
          <button class="btn btn-gold btn-sm" onclick="playPopupAudio()">ğŸ”Š</button>
          <button class="btn btn-primary btn-sm" onclick="addPopupToVocab()">+ Vocabulaire</button>
        </div>
      </div>
    </div>

    <!-- PAGE: DICTIONNAIRE - Ajouter fonctionnel (L) -->
    <div id="page-dictionary" class="page">
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“• Dictionnaire</h1>
      <div class="card" style="margin-bottom: 16px;">
        <div class="flex-row" style="margin-bottom: 12px;"><select id="dict-direction" style="width: auto;"><option value="en-fr">Anglais â†’ FranÃ§ais</option><option value="fr-en">FranÃ§ais â†’ Anglais</option></select></div>
        <div class="flex-row"><input type="text" id="dict-search" placeholder="Tape un mot..." style="flex: 1;" onkeypress="if(event.key==='Enter') searchDictionary()"><button class="btn btn-primary" onclick="searchDictionary()">ğŸ”</button></div>
      </div>
      <div id="dict-result" style="display: none;" class="card">
        <div class="flex-between" style="margin-bottom: 12px;"><h2 style="color: var(--blue); font-size: 20px;" id="dict-word">Meeting</h2><button class="audio-btn" onclick="playAudio(document.getElementById('dict-word').innerText)">ğŸ”Š</button></div>
        <p style="color: var(--gray); font-size: 14px;" id="dict-phonetic">/ËˆmiËtÉªÅ‹/</p>
        <p style="color: var(--gray); font-size: 15px; margin-top: 12px;"><strong>Traduction :</strong> <span id="dict-translation">RÃ©union</span></p>
        <p style="color: var(--gray); font-size: 13px; margin-top: 8px;"><strong>DÃ©finition :</strong> <span id="dict-definition">A gathering of people for a purpose.</span></p>
        <p style="color: var(--gray); font-size: 13px; margin-top: 8px;"><strong>Exemple :</strong> <span id="dict-example">"We have a meeting at 10am."</span></p>
        <button class="btn btn-gold btn-sm" style="margin-top: 16px;" onclick="addToDictVocab()">+ Ajouter Ã  mon vocabulaire</button>
        <p id="dict-add-feedback" style="display: none; font-size: 11px; margin-top: 8px;"></p>
      </div>
    </div>

    <!-- PAGE: ENTRAÃNEMENT -->
    <div id="page-training" class="page">
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">âš¡ EntraÃ®nement</h1>
      <div class="grid-4" style="margin-bottom: 16px;">
        <div class="card" style="text-align: center;"><div style="font-size: 22px; font-weight: bold; color: var(--blue);">450</div><div style="font-size: 10px; color: var(--gray);">Points semaine</div></div>
        <div class="card" style="text-align: center;"><div style="font-size: 22px; font-weight: bold; color: var(--gold);">7 ğŸ”¥</div><div style="font-size: 10px; color: var(--gray);">Jours consÃ©cutifs</div></div>
        <div class="card" style="text-align: center;"><div style="font-size: 22px;">ğŸ¥ˆ</div><div style="font-size: 10px; color: var(--gray);">MÃ©daille</div></div>
        <div class="card" style="text-align: center;"><div style="font-size: 22px; font-weight: bold; color: var(--accent);">47%</div><div style="font-size: 10px; color: var(--gray);">Vers ğŸ¥‡</div></div>
      </div>
      <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ActivitÃ©s</h3>
      <div class="grid-2">
        <div class="card card-clickable" onclick="showPage('quiz-vocab')"><div class="flex-row"><span style="font-size: 32px;">ğŸ“</span><div style="margin-left: 12px;"><h4 style="color: var(--blue); font-size: 14px;">Quiz Vocabulaire</h4><p style="font-size: 11px; color: var(--gray);">20 questions â€¢ 60s</p></div></div></div>
        <div class="card card-clickable" onclick="showPage('quiz-grammar')"><div class="flex-row"><span style="font-size: 32px;">âœï¸</span><div style="margin-left: 12px;"><h4 style="color: var(--blue); font-size: 14px;">Quiz Grammaire</h4><p style="font-size: 11px; color: var(--gray);">20 questions â€¢ 5min</p></div></div></div>
        <div class="card card-clickable" onclick="showPage('flashcards'); setFlashcardContext('training')"><div class="flex-row"><span style="font-size: 32px;">ğŸƒ</span><div style="margin-left: 12px;"><h4 style="color: var(--blue); font-size: 14px;">Flashcards</h4><p style="font-size: 11px; color: var(--gray);">Vocabulaire mÃ©langÃ©</p></div></div></div>
        <div class="card card-clickable" onclick="showPage('games')"><div class="flex-row"><span style="font-size: 32px;">ğŸ®</span><div style="margin-left: 12px;"><h4 style="color: var(--blue); font-size: 14px;">Jeux</h4><p style="font-size: 11px; color: var(--gray);">Apprentissage ludique</p></div></div></div>
      </div>
    </div>

    <!-- PAGE: FLASHCARDS - Retour contextuel (H) -->
    <div id="page-flashcards" class="page">
      <div id="flashcard-start" style="text-align: center; padding: 40px 20px;">
        <button class="btn btn-ghost" onclick="goBackFromFlashcards()" style="margin-bottom: 20px;">â† Retour</button>
        <span style="font-size: 60px;">ğŸƒ</span><h2 style="color: var(--blue); font-size: 22px; margin: 16px 0;">Flashcards</h2>
        <div class="card" style="max-width: 280px; margin: 20px auto;"><div class="flex-between"><span style="color: var(--gray); font-size: 13px;">Cartes</span><select id="flashcard-count" style="width: auto;"><option value="5">5</option><option value="10" selected>10</option><option value="15">15</option><option value="20">20</option></select></div></div>
        <button class="btn btn-accent" style="font-size: 16px; padding: 14px 32px;" onclick="startFlashcards()">Commencer ğŸš€</button>
      </div>
      <div id="flashcard-playing" style="display: none; max-width: 500px; margin: 0 auto;">
        <div class="flex-between" style="margin-bottom: 16px;"><button class="btn btn-ghost btn-sm" onclick="goBackFromFlashcards()">â† Retour</button><span class="badge badge-gold" id="flashcard-counter">1/10</span></div>
        <div class="flashcard" id="flashcard-card" onclick="flipFlashcard()">
          <p style="color: rgba(255,255,255,0.6); font-size: 12px;">Clique pour retourner</p>
          <h2 style="color: white; font-size: 28px;" id="flashcard-front">Meeting</h2>
          <p style="color: var(--gold); font-size: 16px; margin-top: 12px; display: none;" id="flashcard-back">RÃ©union</p>
        </div>
        <div id="flashcard-eval" style="display: none; margin-top: 20px;">
          <div class="grid-3" style="gap: 10px;">
            <button class="btn btn-green" onclick="flashcardAnswer('knew')">âœ“ Je savais</button>
            <button class="btn btn-orange" onclick="flashcardAnswer('hesitated')">~ J'ai hÃ©sitÃ©</button>
            <button class="btn btn-red" onclick="flashcardAnswer('didnt')">âœ— Je ne savais pas</button>
          </div>
        </div>
      </div>
      <div id="flashcard-result" style="display: none; text-align: center; padding: 40px 20px;">
        <span style="font-size: 60px;">ğŸ‰</span><h2 style="color: var(--blue); font-size: 22px; margin: 16px 0;">Session terminÃ©e !</h2>
        <div class="grid-3" style="max-width: 400px; margin: 20px auto; gap: 12px;">
          <div class="card" style="text-align: center;"><div style="font-size: 20px; font-weight: bold;" id="flashcard-knew">0</div><div style="font-size: 10px; color: var(--green);">Je savais</div></div>
          <div class="card" style="text-align: center;"><div style="font-size: 20px; font-weight: bold;" id="flashcard-hesitated">0</div><div style="font-size: 10px; color: var(--orange);">J'ai hÃ©sitÃ©</div></div>
          <div class="card" style="text-align: center;"><div style="font-size: 20px; font-weight: bold;" id="flashcard-didnt">0</div><div style="font-size: 10px; color: var(--red);">Je ne savais pas</div></div>
        </div>
        <button class="btn btn-primary" onclick="restartFlashcards()">Nouvelle session</button>
        <button class="btn btn-outline" style="margin-left: 8px;" onclick="goBackFromFlashcards()">Retour</button>
      </div>
    </div>

    <!-- PAGE: QUIZ VOCAB -->
    <div id="page-quiz-vocab" class="page">
      <div id="quiz-vocab-start" style="text-align: center; padding: 40px 20px;">
        <button class="btn btn-ghost" onclick="showPage('training')" style="margin-bottom: 20px;">â† Retour</button>
        <span style="font-size: 60px;">ğŸ“</span><h2 style="color: var(--blue); font-size: 22px; margin: 16px 0;">Quiz Vocabulaire</h2>
        <button class="btn btn-accent" style="font-size: 16px; padding: 14px 32px;" onclick="startQuizVocab()">Commencer ğŸš€</button>
      </div>
      <div id="quiz-vocab-playing" style="display: none; max-width: 550px; margin: 0 auto;">
        <div class="flex-between" style="margin-bottom: 16px;"><button class="btn btn-ghost btn-sm" onclick="exitQuiz()">â† Quitter</button><span class="badge badge-blue">Q 1/20</span></div>
        <div class="card">
          <h3 style="color: var(--blue); font-size: 16px; text-align: center; margin-bottom: 20px;">Comment dit-on "RÃ©union" ?</h3>
          <div><button class="quiz-option" onclick="answerQuiz(this, true)">Meeting</button><button class="quiz-option" onclick="answerQuiz(this, false)">Greeting</button><button class="quiz-option" onclick="answerQuiz(this, false)">Seating</button><button class="quiz-option" onclick="answerQuiz(this, false)">Beating</button></div>
        </div>
      </div>
      <div id="quiz-vocab-result" style="display: none; text-align: center; padding: 40px 20px;">
        <span style="font-size: 60px;">ğŸ‰</span><h2 style="color: var(--blue); margin: 16px 0;">Quiz terminÃ© !</h2>
        <div class="card" style="max-width: 280px; margin: 20px auto;"><div style="font-size: 36px; font-weight: bold; color: var(--gold);">+80 pts</div><p style="color: var(--gray);">8/10 bonnes rÃ©ponses</p></div>
        <button class="btn btn-primary" onclick="startQuizVocab()">Autre quiz</button>
        <button class="btn btn-outline" style="margin-left: 8px;" onclick="showPage('training')">Retour</button>
      </div>
    </div>

    <!-- PAGE: QUIZ GRAMMAIRE -->
    <div id="page-quiz-grammar" class="page">
      <div id="quiz-grammar-start" style="text-align: center; padding: 40px 20px;">
        <button class="btn btn-ghost" onclick="showPage('training')" style="margin-bottom: 20px;">â† Retour</button>
        <span style="font-size: 60px;">âœï¸</span><h2 style="color: var(--blue); font-size: 22px; margin: 16px 0;">Quiz Grammaire</h2>
        <button class="btn btn-accent" style="font-size: 16px; padding: 14px 32px;" onclick="startQuizGrammar()">Commencer ğŸš€</button>
      </div>
      <div id="quiz-grammar-playing" style="display: none; max-width: 550px; margin: 0 auto;">
        <div class="flex-between" style="margin-bottom: 16px;"><button class="btn btn-ghost btn-sm" onclick="exitQuiz()">â† Quitter</button><span class="badge badge-blue">Q 1/20</span></div>
        <div class="card">
          <h3 style="color: var(--blue); font-size: 16px; margin-bottom: 20px;">She ___ to work every day.</h3>
          <div><button class="quiz-option" onclick="answerQuiz(this, false)">go</button><button class="quiz-option" onclick="answerQuiz(this, true)">goes</button><button class="quiz-option" onclick="answerQuiz(this, false)">going</button><button class="quiz-option" onclick="answerQuiz(this, false)">gone</button></div>
        </div>
      </div>
      <div id="quiz-grammar-result" style="display: none; text-align: center; padding: 40px 20px;">
        <span style="font-size: 60px;">ğŸ‰</span><h2 style="color: var(--blue); margin: 16px 0;">Quiz terminÃ© !</h2>
        <div class="card" style="max-width: 280px; margin: 20px auto;"><div style="font-size: 36px; font-weight: bold; color: var(--gold);">+120 pts</div></div>
        <button class="btn btn-primary" onclick="startQuizGrammar()">Autre quiz</button>
        <button class="btn btn-outline" style="margin-left: 8px;" onclick="showPage('training')">Retour</button>
      </div>
    </div>

    <!-- PAGE: JEUX -->
    <div id="page-games" class="page">
      <button class="btn btn-ghost" onclick="showPage('training')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ® Jeux</h1>
      <div class="grid-3">
        <div class="card card-clickable" onclick="showPage('game-match')"><div style="text-align: center;"><span style="font-size: 40px;">ğŸ”—</span><h4 style="color: var(--blue); margin-top: 12px;">Word Match</h4><p style="font-size: 10px; color: var(--gray);">Associe les mots</p></div></div>
        <div class="card card-clickable" onclick="showPage('game-speed')"><div style="text-align: center;"><span style="font-size: 40px;">âš¡</span><h4 style="color: var(--blue); margin-top: 12px;">Speed Challenge</h4><p style="font-size: 10px; color: var(--gray);">Traduis vite !</p></div></div>
        <div class="card card-clickable" onclick="showPage('game-puzzle')"><div style="text-align: center;"><span style="font-size: 40px;">ğŸ§©</span><h4 style="color: var(--blue); margin-top: 12px;">Word Puzzle</h4><p style="font-size: 10px; color: var(--gray);">Devine le mot</p></div></div>
        <div class="card card-clickable" onclick="showPage('game-sentence')"><div style="text-align: center;"><span style="font-size: 40px;">ğŸ“</span><h4 style="color: var(--blue); margin-top: 12px;">Sentence Builder</h4><p style="font-size: 10px; color: var(--gray);">Remets les mots dans l'ordre</p></div></div>
        <div class="card card-clickable" onclick="showPage('game-fillblank')"><div style="text-align: center;"><span style="font-size: 40px;">âœï¸</span><h4 style="color: var(--blue); margin-top: 12px;">Fill in the Blank</h4><p style="font-size: 10px; color: var(--gray);">ComplÃ¨te les phrases GRC</p></div></div>
      </div>
    </div>

    <!-- PAGE: GAME MATCH -->
    <div id="page-game-match" class="page">
      <button class="btn btn-ghost" onclick="showPage('games')" style="margin-bottom: 12px;">â† Retour</button>
      <div class="flex-between" style="margin-bottom: 16px;"><h1 style="color: var(--blue); font-size: 20px;">ğŸ”— Word Match</h1><span id="match-score" style="font-size: 18px; font-weight: bold; color: var(--gold);">Score: 0</span></div>
      <div class="grid-2" style="gap: 20px;">
        <div id="match-english"><h4 style="color: var(--blue); margin-bottom: 12px;">ğŸ‡¬ğŸ‡§ Anglais</h4>
          <button class="btn btn-outline" style="width: 100%; margin-bottom: 8px;" onclick="selectMatchWord(this,'en','meeting')">Meeting</button>
          <button class="btn btn-outline" style="width: 100%; margin-bottom: 8px;" onclick="selectMatchWord(this,'en','deadline')">Deadline</button>
          <button class="btn btn-outline" style="width: 100%; margin-bottom: 8px;" onclick="selectMatchWord(this,'en','report')">Report</button>
          <button class="btn btn-outline" style="width: 100%;" onclick="selectMatchWord(this,'en','schedule')">Schedule</button>
        </div>
        <div id="match-french"><h4 style="color: var(--blue); margin-bottom: 12px;">ğŸ‡«ğŸ‡· FranÃ§ais</h4>
          <button class="btn btn-outline" style="width: 100%; margin-bottom: 8px;" onclick="selectMatchWord(this,'fr','report')">Rapport</button>
          <button class="btn btn-outline" style="width: 100%; margin-bottom: 8px;" onclick="selectMatchWord(this,'fr','meeting')">RÃ©union</button>
          <button class="btn btn-outline" style="width: 100%; margin-bottom: 8px;" onclick="selectMatchWord(this,'fr','schedule')">Planning</button>
          <button class="btn btn-outline" style="width: 100%;" onclick="selectMatchWord(this,'fr','deadline')">Date limite</button>
        </div>
      </div>
      <div id="match-feedback" style="text-align: center; margin-top: 16px; font-size: 14px;"></div>
    </div>

    <!-- PAGE: GAME SPEED + PUZZLE -->
    <div id="page-game-speed" class="page">
      <button class="btn btn-ghost" onclick="showPage('games')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">âš¡ Speed Challenge</h1>
      <div class="card" style="text-align: center; padding: 30px;">
        <p style="color: var(--gray); margin-bottom: 12px;">Comment dit-on...</p>
        <h2 style="color: var(--blue); font-size: 28px; margin-bottom: 20px;">RÃ©union</h2>
        <input type="text" placeholder="Ta rÃ©ponse..." style="max-width: 300px; text-align: center; font-size: 16px;">
        <button class="btn btn-accent" style="margin-top: 16px;">Valider</button>
      </div>
    </div>
    <div id="page-game-puzzle" class="page">
      <button class="btn btn-ghost" onclick="showPage('games')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ§© Word Puzzle</h1>
      <div class="card" style="text-align: center; padding: 30px;">
        <p style="font-size: 13px; color: var(--gray); margin-bottom: 16px;">Indice : Document rÃ©sumant une rÃ©union</p>
        <div style="display: flex; justify-content: center; gap: 8px; margin-bottom: 20px;">
          <input type="text" maxlength="1" style="width: 40px; height: 50px; text-align: center; font-size: 20px;">
          <input type="text" maxlength="1" style="width: 40px; height: 50px; text-align: center; font-size: 20px;">
          <input type="text" maxlength="1" style="width: 40px; height: 50px; text-align: center; font-size: 20px;">
          <input type="text" maxlength="1" style="width: 40px; height: 50px; text-align: center; font-size: 20px;">
          <input type="text" maxlength="1" style="width: 40px; height: 50px; text-align: center; font-size: 20px;">
          <input type="text" maxlength="1" style="width: 40px; height: 50px; text-align: center; font-size: 20px;">
          <input type="text" maxlength="1" style="width: 40px; height: 50px; text-align: center; font-size: 20px;">
        </div>
        <button class="btn btn-primary">VÃ©rifier</button>
      </div>
    </div>

    <!-- PAGE: GAME SENTENCE BUILDER -->
    <div id="page-game-sentence" class="page">
      <button class="btn btn-ghost" onclick="showPage('games')" style="margin-bottom: 12px;">â† Retour</button>
      <div class="flex-between" style="margin-bottom: 16px;"><h1 style="color: var(--blue); font-size: 20px;">ğŸ“ Sentence Builder</h1><span id="sentence-score" style="font-size: 18px; font-weight: bold; color: var(--gold);">Score: 0</span></div>
      <div class="card">
        <p style="font-size: 13px; color: var(--gray); margin-bottom: 12px;">Remets les mots dans le bon ordre :</p>
        <div style="background: var(--light); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
          <p style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">ğŸ‡«ğŸ‡· Phrase Ã  traduire :</p>
          <p style="font-size: 16px; color: var(--blue); font-weight: bold;">"La rÃ©union commence Ã  10 heures."</p>
        </div>
        <p style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">Clique sur les mots dans l'ordre :</p>
        <div id="sentence-words" class="flex-wrap" style="gap: 8px; margin-bottom: 16px;">
          <button class="btn btn-outline btn-sm" onclick="addSentenceWord(this)">at</button>
          <button class="btn btn-outline btn-sm" onclick="addSentenceWord(this)">starts</button>
          <button class="btn btn-outline btn-sm" onclick="addSentenceWord(this)">meeting</button>
          <button class="btn btn-outline btn-sm" onclick="addSentenceWord(this)">10</button>
          <button class="btn btn-outline btn-sm" onclick="addSentenceWord(this)">The</button>
          <button class="btn btn-outline btn-sm" onclick="addSentenceWord(this)">o'clock</button>
        </div>
        <p style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">Ta phrase :</p>
        <div id="sentence-answer" style="min-height: 50px; border: 2px dashed #ddd; border-radius: 8px; padding: 12px; font-size: 16px; color: var(--blue);"></div>
        <div class="flex-row" style="gap: 8px; margin-top: 16px;">
          <button class="btn btn-secondary" onclick="resetSentence()">Effacer</button>
          <button class="btn btn-primary" onclick="checkSentence()">Valider</button>
        </div>
        <div id="sentence-feedback" style="display: none; margin-top: 12px; padding: 12px; border-radius: 8px;"></div>
      </div>
    </div>

    <!-- PAGE: GAME FILL IN THE BLANK - V12 avec donnÃ©es dynamiques -->
    <div id="page-game-fillblank" class="page">
      <button class="btn btn-ghost" onclick="showPage('games')" style="margin-bottom: 12px;">â† Retour</button>
      <div class="flex-between" style="margin-bottom: 16px;"><h1 style="color: var(--blue); font-size: 20px;">âœï¸ Fill in the Blank</h1><span id="fillblank-progress">1/3</span></div>
      <div class="card">
        <span class="badge badge-gold" style="margin-bottom: 12px;">ThÃ¨me : GRC / ConformitÃ©</span>
        <p style="font-size: 14px; color: var(--gray); margin-bottom: 16px;">ComplÃ¨te avec le mot GRC appropriÃ© :</p>
        <div style="background: var(--light); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
          <p style="font-size: 15px; color: var(--blue); line-height: 1.8;" id="fillblank-sentence">"The company must ensure full ___ with the new regulations."</p>
        </div>
        <div class="flex-wrap" style="gap: 8px; margin-bottom: 16px;" id="fillblank-options">
          <!-- Options gÃ©nÃ©rÃ©es dynamiquement -->
        </div>
        <div id="fillblank-feedback" style="display: none; margin-top: 12px; padding: 12px; border-radius: 8px;"></div>
      </div>
    </div>

    <!-- PAGE: COACH IA -->
    <div id="page-coach" class="page">
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ’¬ Coach IA</h1>
      <div class="card" style="margin-bottom: 12px;">
        <div class="flex-row" style="flex-wrap: wrap; gap: 8px;">
          <span style="font-size: 12px; color: var(--gray);">Mode :</span>
          <span class="chip active" onclick="setCoachMode('friend')">ğŸ¤ Best Friend</span>
          <span class="chip" onclick="setCoachMode('teacher')">ğŸ‘¨â€ğŸ« Teacher</span>
          <span class="chip" onclick="setCoachMode('business')">ğŸ’¼ Business</span>
        </div>
      </div>
      <div class="chat-container">
        <div class="chat-messages" id="chat-messages"><div class="chat-bubble chat-coach">Hi! I'm your English coach ğŸ˜Š How can I help?</div></div>
        <div style="padding: 12px; border-top: 1px solid #e5e5e5; display: flex; gap: 8px;">
          <input type="text" id="chat-input" placeholder="Type your message..." style="flex: 1;" onkeypress="if(event.key==='Enter')sendChat()">
          <button class="btn btn-accent" onclick="toggleRecording()">ğŸ¤</button>
          <button class="btn btn-primary" onclick="sendChat()">Send</button>
        </div>
      </div>
    </div>

    <!-- PAGE: PLANNING avec calendrier complet (Correction 1) -->
    <div id="page-planning" class="page">
      <button class="btn btn-ghost" onclick="showPage('home')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“… Mon planning de rÃ©vision</h1>
      <div class="grid-2">
        <div class="card">
          <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">Jours de rÃ©vision</h3>
          <div class="day-selector" id="planning-days">
            <button class="day-btn active" data-day="L" onclick="togglePlanningDay(this)">L</button>
            <button class="day-btn active" data-day="M" onclick="togglePlanningDay(this)">M</button>
            <button class="day-btn active" data-day="Me" onclick="togglePlanningDay(this)">M</button>
            <button class="day-btn active" data-day="J" onclick="togglePlanningDay(this)">J</button>
            <button class="day-btn active" data-day="V" onclick="togglePlanningDay(this)">V</button>
            <button class="day-btn" data-day="S" onclick="togglePlanningDay(this)">S</button>
            <button class="day-btn" data-day="D" onclick="togglePlanningDay(this)">D</button>
          </div>
          <div style="margin-top: 16px;"><label style="font-size: 12px; color: var(--gray);">DurÃ©e quotidienne</label><select id="planning-duration"><option value="5">5 min</option><option value="10">10 min</option><option value="15">15 min</option><option value="20">20 min</option><option value="30" selected>30 min</option><option value="60">1h</option><option value="120">2h</option><option value="180">3h</option></select></div>
          <button class="btn btn-primary" style="margin-top: 16px; width: 100%;" onclick="savePlanning()">ğŸ’¾ Enregistrer</button>
        </div>
        <div class="card">
          <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ğŸ“‹ RÃ©sumÃ©</h3>
          <div style="background: var(--light); padding: 12px; border-radius: 8px;">
            <p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;">Ton programme :</p>
            <p style="font-size: 14px; color: var(--blue); font-weight: bold;" id="planning-summary-days">5 jours / semaine</p>
            <p style="font-size: 14px; color: var(--blue); font-weight: bold;" id="planning-summary-time">30 min / jour</p>
            <p style="font-size: 12px; color: var(--gray); margin-top: 8px;" id="planning-summary-total">â‰ˆ 2h30 par semaine</p>
          </div>
        </div>
      </div>
      
      <!-- Calendrier mensuel complet (dÃ©placÃ© depuis accueil) -->
      <div class="card" style="margin-top: 16px;">
        <div class="flex-between" style="margin-bottom: 12px;">
          <h3 style="color: var(--blue); font-size: 14px;">ğŸ“† Calendrier du mois</h3>
          <span style="font-size: 12px; font-weight: bold; color: var(--blue);" id="calendar-month">Janvier 2026</span>
        </div>
        <div class="calendar" id="monthly-calendar">
          <div class="calendar-header">L</div><div class="calendar-header">M</div><div class="calendar-header">M</div><div class="calendar-header">J</div><div class="calendar-header">V</div><div class="calendar-header">S</div><div class="calendar-header">D</div>
        </div>
        <!-- DÃ©tail du jour -->
        <div id="day-detail" style="margin-top: 12px; padding: 12px; background: var(--light); border-radius: 8px; display: none;">
          <h4 style="color: var(--blue); font-size: 12px; margin-bottom: 8px;" id="day-detail-title">ğŸ“‹ DÃ©tail du 30 janvier</h4>
          <div id="day-detail-content">
            <div class="flex-between" style="padding: 6px 0; border-bottom: 1px solid #e5e5e5;">
              <span style="font-size: 11px;">ğŸ“ Vocab Ã©crit</span>
              <span style="font-size: 11px;"><span id="dd-vocab-written">8</span> mots <span class="badge badge-green" style="font-size: 8px;">âœ“</span></span>
            </div>
            <div class="flex-between" style="padding: 6px 0; border-bottom: 1px solid #e5e5e5;">
              <span style="font-size: 11px;">ğŸ¤ Vocab oral</span>
              <span style="font-size: 11px;"><span id="dd-vocab-oral">5</span> mots <span class="badge badge-red" style="font-size: 8px;">âœ—</span></span>
            </div>
            <div class="flex-between" style="padding: 6px 0;">
              <span style="font-size: 11px;">âœï¸ Grammaire</span>
              <span style="font-size: 11px;"><span id="dd-grammar">1</span> rÃ¨gle <span class="badge badge-green" style="font-size: 8px;">âœ“</span></span>
            </div>
          </div>
        </div>
        <p style="font-size: 10px; color: var(--gray); margin-top: 12px;">
          <span style="display: inline-block; width: 12px; height: 12px; background: rgba(34,197,94,0.2); border-radius: 3px; vertical-align: middle;"></span> Fait
          <span style="display: inline-block; width: 12px; height: 12px; background: rgba(239,68,68,0.1); border-radius: 3px; vertical-align: middle; margin-left: 12px;"></span> ManquÃ©
          <span style="display: inline-block; width: 12px; height: 12px; border: 2px solid var(--gold); border-radius: 3px; vertical-align: middle; margin-left: 12px;"></span> PlanifiÃ©
        </p>
      </div>
    </div>

    <!-- PAGE: PROFIL avec langue interface (Correction 12) -->
    <div id="page-profile" class="page">
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ‘¤ Mon profil</h1>
      <div class="grid-2">
        <div class="flex-col">
          <div class="card">
            <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">Informations</h3>
            <div style="margin-bottom: 12px;"><label style="font-size: 11px; color: var(--gray);">PrÃ©nom</label><input type="text" id="profile-firstname" value="Marie"></div>
            <!-- Langue interface (Correction 12) -->
            <div style="margin-bottom: 12px;">
              <label style="font-size: 11px; color: var(--gray);">Langue de l'interface</label>
              <select id="profile-interface-lang">
                <option value="fr" selected>ğŸ‡«ğŸ‡· FranÃ§ais</option>
                <option value="en">ğŸ‡¬ğŸ‡§ English</option>
              </select>
              <p style="font-size: 10px; color: var(--gray); margin-top: 4px;">Langue dans laquelle l'application s'affiche</p>
            </div>
            <div style="margin-bottom: 12px;">
              <label style="font-size: 11px; color: var(--gray);">Langue active (apprentissage)</label>
              <select id="profile-learning-lang">
                <option>ğŸ‡¬ğŸ‡§ Anglais</option>
                <option>ğŸ‡ªğŸ‡¸ Espagnol</option>
              </select>
              <p style="font-size: 10px; color: var(--gray); margin-top: 4px;">Langue que vous apprenez actuellement</p>
            </div>
            <button class="btn btn-primary btn-sm">ğŸ’¾ Enregistrer</button>
          </div>
          <div class="card">
            <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">Mes niveaux</h3>
            <div class="flex-between" style="margin-bottom: 8px;"><span style="font-size: 13px;">CECRL</span><span class="badge badge-blue">B1</span></div>
            <div class="flex-between"><span style="font-size: 13px;">GRC MÃ©tier</span><span class="badge badge-gold">IntermÃ©diaire</span></div>
          </div>
          <div class="card"><h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ğŸ† Ma mÃ©daille</h3><div style="text-align: center;"><span style="font-size: 48px;">ğŸ¥ˆ</span><p style="font-size: 18px; font-weight: bold; color: var(--gold);">Argent</p></div></div>
        </div>
        <div class="flex-col">
          <div class="card">
            <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">ParamÃ¨tres d'apprentissage</h3>
            <div style="margin-bottom: 12px;"><label style="font-size: 11px; color: var(--gray);">Programme</label><p style="font-size: 13px;" id="profile-program">5 jours / semaine Â· 30 min</p></div>
            <div style="margin-bottom: 12px;">
              <div class="flex-between"><label style="font-size: 11px; color: var(--gray);">Mes thÃ¨mes</label><button class="btn btn-outline btn-xs" onclick="openModal('add-theme')">+ Ajouter</button></div>
              <div class="flex-wrap" style="margin-top: 8px;"><span class="badge badge-gold">RÃ©unions</span><span class="badge badge-gold">ConformitÃ©</span><span class="badge badge-blue">Voyage</span><span class="badge badge-blue">Famille</span></div>
            </div>
            <div><label style="font-size: 11px; color: var(--gray);">Mes objectifs</label><div class="flex-wrap" style="margin-top: 8px;"><span class="badge badge-green">Vocabulaire</span><span class="badge badge-green">Grammaire</span><span class="badge badge-gray">Oral</span><span class="badge badge-gray">Ã‰crit</span><span class="badge badge-gray">Ã‰coute</span></div></div>
          </div>
          <div class="accordion" id="admin-accordion" style="display: none;">
            <div class="accordion-header" onclick="toggleAccordion('admin-content')"><span>âš™ï¸ Administration</span><span id="admin-content-icon">â–¼</span></div>
            <div class="accordion-content" id="admin-content"><button class="btn btn-primary btn-sm" style="width: 100%;" onclick="showPage('admin')">AccÃ©der Ã  l'administration</button></div>
          </div>
          <button class="btn btn-red" onclick="logout()">ğŸšª DÃ©connexion</button>
        </div>
      </div>
    </div>

    <!-- PAGE: ADMIN - Mots Ã  qualifier (M) -->
    <div id="page-admin" class="page">
      <div class="flex-between" style="margin-bottom: 16px;"><h1 style="color: var(--blue); font-size: 20px;">âš™ï¸ Administration</h1><button class="btn btn-ghost" onclick="showPage('profile')">â† Retour</button></div>
      <div class="flex-row" style="margin-bottom: 16px; gap: 8px;">
        <button class="btn btn-primary btn-sm" onclick="showAdminTab('users')">ğŸ‘¥ Utilisateurs</button>
        <button class="btn btn-secondary btn-sm" onclick="showAdminTab('imports')">ğŸ“¥ Importations</button>
        <button class="btn btn-secondary btn-sm" onclick="showAdminTab('qualify')">âœ… Mots Ã  qualifier</button>
      </div>
      
      <!-- Correction 8.2: Bouton Reset data tests -->
      <div class="card" style="margin-bottom: 16px; background: rgba(239,68,68,0.05); border: 1px solid rgba(239,68,68,0.2);">
        <div class="flex-between">
          <div>
            <h4 style="color: var(--red); font-size: 13px;">ğŸ§¹ Reset donnÃ©es de test</h4>
            <p style="font-size: 11px; color: var(--gray);">Supprime utilisateurs test, progressions fictives, imports test. PrÃ©serve les verbes irrÃ©guliers.</p>
          </div>
          <button class="btn btn-red btn-sm" onclick="resetDataTests()">Reset data tests</button>
        </div>
      </div>
      
      <!-- Tab Users - Correction 7.1 -->
      <div id="admin-tab-users" class="card">
        <div class="flex-between" style="margin-bottom: 12px;"><h3 style="color: var(--blue); font-size: 14px;">ğŸ‘¥ Gestion utilisateurs</h3><button class="btn btn-primary btn-sm" onclick="openModal('create-user')">+ CrÃ©er</button></div>
        <p style="font-size: 11px; color: var(--orange); margin-bottom: 12px; padding: 8px; background: rgba(245,158,11,0.1); border-radius: 6px;">âš ï¸ Mode preview : les actions Reset et Supprimer affichent une simulation. En production, ces actions modifieront rÃ©ellement la base de donnÃ©es.</p>
        <input type="text" placeholder="Rechercher..." style="margin-bottom: 12px;">
        <div style="max-height: 300px; overflow-y: auto;">
          <div class="flex-between" style="padding: 12px; background: var(--light); border-radius: 8px; margin-bottom: 8px;">
            <div><div style="font-weight: bold; color: var(--blue);">Jean Martin</div><div style="font-size: 11px; color: var(--gray);"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1b717e7a755b7e6335787476">[email&#160;protected]</a></div><div class="flex-row" style="margin-top: 4px;"><span class="badge badge-blue" style="font-size: 9px;">A2</span><span class="badge badge-green" style="font-size: 9px;">User</span></div></div>
            <div class="flex-col" style="gap: 4px;"><button class="btn btn-outline btn-xs" onclick="openModal('edit-user')">âœï¸ Modifier</button><button class="btn btn-secondary btn-xs" onclick="resetPassword('jean')">ğŸ”‘ Reset</button><button class="btn btn-red btn-xs" onclick="deleteUser('jean')">ğŸ—‘ï¸</button></div>
          </div>
        </div>
      </div>
      <!-- Tab Imports - Correction 7.2 -->
      <div id="admin-tab-imports" class="card" style="display: none;">
        <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 16px;">ğŸ“¥ Importation de contenus</h3>
        <div style="background: rgba(245,158,11,0.1); padding: 12px; border-radius: 8px; margin-bottom: 16px;">
          <p style="font-size: 12px; color: var(--orange); font-weight: bold; margin-bottom: 8px;">âš ï¸ Mode preview</p>
          <ul style="font-size: 11px; color: var(--gray); padding-left: 16px; line-height: 1.8;">
            <li><strong>TÃ©lÃ©chargement templates</strong> : simulÃ© (en prod : fichier Excel gÃ©nÃ©rÃ©)</li>
            <li><strong>Upload fichier</strong> : simulÃ© (en prod : fichier envoyÃ© au serveur)</li>
            <li><strong>Alimentation base</strong> : simulÃ©e (en prod : donnÃ©es insÃ©rÃ©es dans Supabase/PostgreSQL)</li>
            <li><strong>Validation</strong> : en prod, les imports non-admin nÃ©cessitent validation admin</li>
          </ul>
        </div>
        <div class="grid-3" style="gap: 12px; margin-bottom: 20px;">
          <div class="card card-clickable" onclick="showPage('import-vocab')" style="text-align: center;"><span style="font-size: 28px;">ğŸ“–</span><h4 style="color: var(--blue); font-size: 12px; margin-top: 8px;">Vocabulaire</h4></div>
          <div class="card card-clickable" onclick="showPage('import-grammar')" style="text-align: center;"><span style="font-size: 28px;">âœï¸</span><h4 style="color: var(--blue); font-size: 12px; margin-top: 8px;">Grammaire</h4></div>
          <div class="card card-clickable" onclick="showPage('import-reading')" style="text-align: center;"><span style="font-size: 28px;">ğŸ“„</span><h4 style="color: var(--blue); font-size: 12px; margin-top: 8px;">Lecture</h4></div>
          <div class="card card-clickable" onclick="showPage('import-exams')" style="text-align: center;"><span style="font-size: 28px;">ğŸ“</span><h4 style="color: var(--blue); font-size: 12px; margin-top: 8px;">Examens</h4></div>
          <div class="card card-clickable" onclick="showPage('import-verbs')" style="text-align: center;"><span style="font-size: 28px;">ğŸ“</span><h4 style="color: var(--blue); font-size: 12px; margin-top: 8px;">Verbes irr.</h4></div>
          <div class="card card-clickable" onclick="showPage('import-games')" style="text-align: center;"><span style="font-size: 28px;">ğŸ®</span><h4 style="color: var(--blue); font-size: 12px; margin-top: 8px;">Jeux</h4></div>
        </div>
        <h4 style="color: var(--blue); font-size: 13px; margin-bottom: 8px;">Historique</h4>
        <table><thead><tr><th>Date</th><th>Type</th><th>Fichier</th><th>Statut</th><th>Par</th></tr></thead><tbody><tr><td>28/01</td><td>Vocab</td><td>meetings.xlsx</td><td><span class="badge badge-green">âœ“</span></td><td>Marie</td></tr></tbody></table>
      </div>
      <!-- Tab Mots Ã  qualifier (M) -->
      <div id="admin-tab-qualify" class="card" style="display: none;">
        <h3 style="color: var(--blue); font-size: 14px; margin-bottom: 12px;">âœ… Mots Ã  qualifier</h3>
        <p style="font-size: 11px; color: var(--gray); margin-bottom: 12px;">Mots ajoutÃ©s par les utilisateurs Ã  valider et complÃ©ter</p>
        <div style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 12px; margin-bottom: 12px;">
          <div class="flex-between" style="margin-bottom: 8px;">
            <strong style="color: var(--blue);">Brainstorming</strong>
            <span class="badge badge-orange">Ã€ qualifier</span>
          </div>
          <div class="grid-2" style="gap: 8px; margin-bottom: 8px;">
            <div><label style="font-size: 10px; color: var(--gray);">Mot EN</label><input type="text" value="Brainstorming" style="font-size: 12px;"></div>
            <div><label style="font-size: 10px; color: var(--gray);">Traduction FR</label><input type="text" value="Remue-mÃ©ninges" style="font-size: 12px;"></div>
          </div>
          <div style="margin-bottom: 8px;"><label style="font-size: 10px; color: var(--gray);">DÃ©finition EN</label><input type="text" placeholder="A group discussion to produce ideas..." style="font-size: 12px;"></div>
          <div style="margin-bottom: 8px;"><label style="font-size: 10px; color: var(--gray);">Exemple EN</label><input type="text" placeholder="Let's have a brainstorming session." style="font-size: 12px;"></div>
          <div class="grid-2" style="gap: 8px; margin-bottom: 8px;">
            <div><label style="font-size: 10px; color: var(--gray);">Source</label><span style="font-size: 11px; color: var(--gray);">ğŸ“– Lecture â€¢ Jean</span></div>
            <div><label style="font-size: 10px; color: var(--gray);">Niveau suggÃ©rÃ©</label><select style="font-size: 12px;"><option>A1</option><option>A2</option><option selected>B1</option><option>B2</option></select></div>
          </div>
          <div class="flex-row" style="gap: 8px;">
            <button class="btn btn-green btn-xs">âœ“ Valider</button>
            <button class="btn btn-red btn-xs">âœ— Refuser</button>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGES IMPORT REFAITES -->
    <!-- Import Vocabulaire -->
    <div id="page-import-vocab" class="page">
      <button class="btn btn-ghost" onclick="showPage('admin'); showAdminTab('imports')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“– Import Vocabulaire</h1>
      <div class="card">
        <div class="flex-between" style="margin-bottom: 12px;">
          <h3 style="color: var(--blue); font-size: 14px;">Format attendu (Excel/CSV)</h3>
          <button class="btn btn-outline btn-sm" onclick="downloadTemplate('vocab')">ğŸ“¥ TÃ©lÃ©charger template</button>
        </div>
        <div style="margin-bottom: 12px;"><label style="font-size: 12px; color: var(--gray);">Type de vocabulaire</label><select id="import-vocab-type"><option value="perso">Personnel (gÃ©nÃ©ral)</option><option value="pro">Professionnel (GRC)</option></select></div>
        <table style="margin-bottom: 16px; font-size: 12px;">
          <thead><tr><th>Colonne</th><th>Description</th><th>Requis</th></tr></thead>
          <tbody>
            <tr><td><strong>language</strong></td><td>Code langue (EN, ES...)</td><td>âœ“</td></tr>
            <tr><td><strong>word_en</strong></td><td>Mot anglais</td><td>âœ“</td></tr>
            <tr><td><strong>word_fr</strong></td><td>Traduction franÃ§aise</td><td>âœ“</td></tr>
            <tr><td><strong>definition_en</strong></td><td>DÃ©finition en anglais</td><td>âœ“</td></tr>
            <tr><td><strong>example_en</strong></td><td>Exemple d'utilisation</td><td>âœ“</td></tr>
            <tr><td><strong>theme</strong></td><td>ID thÃ¨me (meetings, travel...)</td><td>âœ“</td></tr>
            <tr><td><strong>level</strong></td><td>Niveau CECRL (A1-C2)</td><td>âœ“</td></tr>
            <tr><td>type</td><td>Type (noun/verb/adj...)</td><td></td></tr>
            <tr><td>phonetic</td><td>PhonÃ©tique</td><td></td></tr>
          </tbody>
        </table>
        <div style="border: 2px dashed #ddd; border-radius: 10px; padding: 30px; text-align: center;"><span style="font-size: 40px;">ğŸ“¤</span><p style="color: var(--gray); margin: 12px 0;">Glisse ton fichier ici</p><input type="file" id="import-vocab-file" accept=".xlsx,.csv" style="display: none;"><button class="btn btn-primary" onclick="document.getElementById('import-vocab-file').click()">Parcourir</button></div>
        <button class="btn btn-accent" style="margin-top: 16px; width: 100%;" onclick="processImport('vocab')">ğŸ“¥ TÃ©lÃ©verser</button>
      </div>
    </div>

    <!-- Import Grammaire (2 imports sÃ©parÃ©s) -->
    <div id="page-import-grammar" class="page">
      <button class="btn btn-ghost" onclick="showPage('admin'); showAdminTab('imports')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">âœï¸ Import Grammaire</h1>
      <div class="grid-2">
        <div class="card">
          <div class="flex-between" style="margin-bottom: 12px;"><h3 style="color: var(--blue); font-size: 14px;">ğŸ“‹ Import RÃ¨gles</h3><button class="btn btn-outline btn-xs" onclick="downloadTemplate('grammar-rules')">ğŸ“¥ Template</button></div>
          <table style="font-size: 11px; margin-bottom: 12px;">
            <thead><tr><th>Colonne</th><th>Requis</th></tr></thead>
            <tbody>
              <tr><td>rule_id</td><td>âœ“</td></tr>
              <tr><td>title</td><td>âœ“</td></tr>
              <tr><td>level</td><td>âœ“</td></tr>
              <tr><td>language</td><td>âœ“</td></tr>
              <tr><td>definition_fr</td><td>âœ“</td></tr>
              <tr><td>definition_en</td><td>âœ“</td></tr>
              <tr><td>points_attention</td><td></td></tr>
              <tr><td>examples</td><td></td></tr>
            </tbody>
          </table>
          <input type="file" id="import-rules-file" accept=".xlsx,.csv" style="display: none;">
          <button class="btn btn-primary btn-sm" style="width: 100%;" onclick="document.getElementById('import-rules-file').click()">ğŸ“¤ Importer rÃ¨gles</button>
        </div>
        <div class="card">
          <div class="flex-between" style="margin-bottom: 12px;"><h3 style="color: var(--blue); font-size: 14px;">ğŸ“ Import Exercices</h3><button class="btn btn-outline btn-xs" onclick="downloadTemplate('grammar-exercises')">ğŸ“¥ Template</button></div>
          <table style="font-size: 11px; margin-bottom: 12px;">
            <thead><tr><th>Colonne</th><th>Requis</th></tr></thead>
            <tbody>
              <tr><td>exercise_id</td><td>âœ“</td></tr>
              <tr><td>rule_id</td><td>âœ“</td></tr>
              <tr><td>type</td><td>âœ“</td></tr>
              <tr><td>question</td><td>âœ“</td></tr>
              <tr><td>choices</td><td></td></tr>
              <tr><td>correct_answer</td><td>âœ“</td></tr>
              <tr><td>explanation</td><td></td></tr>
              <tr><td>level</td><td>âœ“</td></tr>
            </tbody>
          </table>
          <input type="file" id="import-exercises-file" accept=".xlsx,.csv" style="display: none;">
          <button class="btn btn-primary btn-sm" style="width: 100%;" onclick="document.getElementById('import-exercises-file').click()">ğŸ“¤ Importer exercices</button>
        </div>
      </div>
    </div>

    <!-- Import Lecture -->
    <div id="page-import-reading" class="page">
      <button class="btn btn-ghost" onclick="showPage('admin'); showAdminTab('imports')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“„ Import Lecture</h1>
      <div class="card">
        <div class="flex-between" style="margin-bottom: 12px;"><h3 style="color: var(--blue); font-size: 14px;">Format attendu</h3><button class="btn btn-outline btn-sm" onclick="downloadTemplate('reading')">ğŸ“¥ Template</button></div>
        <table style="font-size: 12px; margin-bottom: 16px;">
          <thead><tr><th>Colonne</th><th>Description</th><th>Requis</th></tr></thead>
          <tbody>
            <tr><td><strong>language</strong></td><td>Code langue</td><td>âœ“</td></tr>
            <tr><td><strong>level</strong></td><td>Niveau CECRL</td><td>âœ“</td></tr>
            <tr><td><strong>theme</strong></td><td>ID thÃ¨me</td><td>âœ“</td></tr>
            <tr><td><strong>title</strong></td><td>Titre du texte</td><td>âœ“</td></tr>
            <tr><td><strong>body_text</strong></td><td>Contenu du texte</td><td>âœ“</td></tr>
          </tbody>
        </table>
        <input type="file" id="import-reading-file" accept=".xlsx,.csv" style="display: none;">
        <button class="btn btn-primary" style="width: 100%;" onclick="document.getElementById('import-reading-file').click()">ğŸ“¤ Importer textes</button>
      </div>
    </div>

    <!-- Import Examens -->
    <div id="page-import-exams" class="page">
      <button class="btn btn-ghost" onclick="showPage('admin'); showAdminTab('imports')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“ Import Examens</h1>
      <div class="card">
        <p style="font-size: 13px; color: var(--gray); margin-bottom: 16px;">âš ï¸ Le format d'import des examens dÃ©pend de la structure du moteur d'Ã©valuation (6 thÃ¨mes, scoring...). Contactez l'Ã©quipe technique pour un template adaptÃ©.</p>
        <button class="btn btn-outline" onclick="downloadTemplate('exams')">ğŸ“¥ TÃ©lÃ©charger template examens</button>
      </div>
    </div>

    <!-- Import Verbes irrÃ©guliers -->
    <div id="page-import-verbs" class="page">
      <button class="btn btn-ghost" onclick="showPage('admin'); showAdminTab('imports')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ“ Import Verbes irrÃ©guliers</h1>
      <div class="card">
        <div class="flex-between" style="margin-bottom: 12px;"><h3 style="color: var(--blue); font-size: 14px;">Format attendu</h3><button class="btn btn-outline btn-sm" onclick="downloadTemplate('verbs')">ğŸ“¥ Template</button></div>
        <table style="font-size: 12px; margin-bottom: 16px;">
          <thead><tr><th>Colonne</th><th>Requis</th></tr></thead>
          <tbody>
            <tr><td>base</td><td>âœ“</td></tr>
            <tr><td>past</td><td>âœ“</td></tr>
            <tr><td>past_participle</td><td>âœ“</td></tr>
            <tr><td>french</td><td>âœ“</td></tr>
            <tr><td>group</td><td>âœ“ (AAA/ABB/ABC)</td></tr>
          </tbody>
        </table>
        <input type="file" id="import-verbs-file" accept=".xlsx,.csv" style="display: none;">
        <button class="btn btn-primary" style="width: 100%;" onclick="document.getElementById('import-verbs-file').click()">ğŸ“¤ Importer verbes</button>
      </div>
    </div>

    <!-- Import Jeux -->
    <div id="page-import-games" class="page">
      <button class="btn btn-ghost" onclick="showPage('admin'); showAdminTab('imports')" style="margin-bottom: 12px;">â† Retour</button>
      <h1 style="color: var(--blue); font-size: 20px; margin-bottom: 16px;">ğŸ® Import Jeux</h1>
      <div class="card">
        <p style="font-size: 13px; color: var(--gray); margin-bottom: 16px;">âš ï¸ Chaque jeu a son propre format (paires, contraintes...). SÃ©lectionnez le type de jeu puis tÃ©lÃ©chargez le template correspondant.</p>
        <select id="import-game-type" style="margin-bottom: 12px;"><option value="match">Word Match (paires)</option><option value="speed">Speed Challenge</option><option value="puzzle">Word Puzzle</option></select>
        <button class="btn btn-outline" onclick="downloadTemplate('games')">ğŸ“¥ TÃ©lÃ©charger template</button>
      </div>
    </div>

  </main>

  <!-- MODAL -->
  <div class="modal" id="modal"><div class="modal-content" id="modal-content"></div></div>

  <!-- JAVASCRIPT COMPLET V7 -->
  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let currentUser = null;
    let currentStep = 1;
    let selectedLangs = ['en'];
    let selectedDays = ['L','M','Me','J','V'];
    let selectedTime = 30;
    let isRecording = false;
    let currentSpeech = null;
    let flashcardContext = 'vocab'; // 'vocab', 'training', 'theme'
    let revisionExercisesDone = 0;
    let grammarFilters = ['A1', 'A2', 'B1'];
    
    // V12: Variables de session (pointeurs, pas donnÃ©es)
    let currentRevisionIndex = 0;
    let currentOralIndex = 0;
    let flashcardIndex = 0;
    let flashcardStats = {knew:0, hesitated:0, didnt:0};
    let matchSelected = {target:null, fr:null};

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ONBOARDING (VERROUILLÃ‰)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function nextStep(step) {
      if (step === 1) {
        const fn = document.getElementById('onb-firstname').value;
        const pw = document.getElementById('onb-password').value;
        if (!fn || pw.length < 6) { alert('Remplis tous les champs (MDP min 6 car.)'); return; }
      }
      document.getElementById('step-'+step).classList.remove('active');
      document.getElementById('step-'+(step+1)).classList.add('active');
      updateStepIndicator(step+1);
      currentStep = step+1;
    }
    function prevStep(step) {
      document.getElementById('step-'+step).classList.remove('active');
      document.getElementById('step-'+(step-1)).classList.add('active');
      updateStepIndicator(step-1);
      currentStep = step-1;
    }
    function updateStepIndicator(step) {
      document.querySelectorAll('.step-dot').forEach((d,i) => {
        d.classList.remove('active','completed');
        if (i+1 < step) d.classList.add('completed');
        if (i+1 === step) d.classList.add('active');
      });
    }
    function toggleLang(el) { 
      el.classList.toggle('selected');
      const lang = el.dataset.lang;
      if (el.classList.contains('selected')) {
        if (!selectedLangs.includes(lang)) selectedLangs.push(lang);
      } else {
        selectedLangs = selectedLangs.filter(l => l !== lang);
      }
    }
    function toggleOption(el) { el.classList.toggle('selected'); }
    function toggleAccordion(id) {
      const c = document.getElementById(id);
      const icon = document.getElementById(id+'-icon');
      c.classList.toggle('open');
      if (icon) icon.textContent = c.classList.contains('open') ? 'â–²' : 'â–¼';
    }
    function toggleDay(el) { el.classList.toggle('active'); updateDaysCount(); }
    function selectDaysPreset(preset) {
      const btns = document.querySelectorAll('#day-selector .day-btn');
      btns.forEach((b,i) => {
        if (preset==='all') b.classList.add('active');
        else if (preset==='weekdays') b.classList.toggle('active', i<5);
      });
      updateDaysCount();
    }
    function updateDaysCount() {
      const n = document.querySelectorAll('#day-selector .day-btn.active').length;
      document.getElementById('days-selected').textContent = n + ' jour' + (n>1?'s':'') + ' sÃ©lectionnÃ©' + (n>1?'s':'');
    }
    function selectTime(el) {
      document.querySelectorAll('#step-6 .chip').forEach(c => c.classList.remove('active'));
      el.classList.add('active');
      selectedTime = parseInt(el.dataset.time);
    }
    function finishOnboarding() {
      currentUser = {
        firstname: document.getElementById('onb-firstname').value,
        role: document.getElementById('onb-role').value,
        langs: selectedLangs,
        level: 'B1'
      };
      localStorage.setItem('lingualearnna_user', JSON.stringify(currentUser));
      document.getElementById('onboarding-container').style.display = 'none';
      document.getElementById('main-header').classList.remove('hidden');
      document.getElementById('main-content').classList.remove('hidden');
      updateUI();
      generateCalendar();
    }
    function showOnboarding() {
      document.getElementById('login-container').style.display = 'none';
      document.getElementById('onboarding-container').style.display = 'flex';
    }
    function login() {
      const fn = document.getElementById('login-firstname').value;
      if (!fn) { alert('Entre ton prÃ©nom'); return; }
      const saved = localStorage.getItem('lingualearnna_user');
      currentUser = saved ? JSON.parse(saved) : {firstname:fn, role:'user', level:'B1', langs:['en']};
      document.getElementById('login-container').style.display = 'none';
      document.getElementById('main-header').classList.remove('hidden');
      document.getElementById('main-content').classList.remove('hidden');
      updateUI();
      generateCalendar();
    }
    function updateUI() {
      if (!currentUser) return;
      document.getElementById('home-username').textContent = currentUser.firstname;
      document.getElementById('header-username').textContent = currentUser.firstname;
      const pf = document.getElementById('profile-firstname');
      if (pf) pf.value = currentUser.firstname;
      if (currentUser.role === 'admin') {
        const aa = document.getElementById('admin-accordion');
        if (aa) aa.style.display = 'block';
        const aev = document.getElementById('admin-edit-verbs');
        if (aev) aev.style.display = 'inline-flex';
        const vgeb = document.getElementById('verb-group-edit-btn');
        if (vgeb) vgeb.style.display = 'inline-flex';
      }
    }
    function logout() {
      if (confirm('DÃ©connexion ?')) {
        document.getElementById('main-header').classList.add('hidden');
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('login-container').style.display = 'flex';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NAVIGATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const page = document.getElementById('page-'+pageId);
      if (page) page.classList.add('active');
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      const nav = document.querySelector('.nav-btn[data-page="'+pageId+'"]');
      if (nav) nav.classList.add('active');
      closeDropdowns();
      
      // V12: Hooks d'initialisation par page
      if (pageId === 'revision-written') {
        initRevisionWritten();
      } else if (pageId === 'revision-oral') {
        initRevisionOral();
      } else if (pageId === 'evaluations') {
        checkSavedExam();
      } else if (pageId === 'game-match') {
        initMatchGame();
      } else if (pageId === 'game-sentence') {
        initSentenceGame();
      } else if (pageId === 'game-fillblank') {
        initFillBlankGame();
      } else if (pageId === 'planning') {
        renderPlanning(); // Synchroniser quand on arrive sur la page
      }
    }
    function toggleDropdown(id) {
      const m = document.getElementById(id);
      const wasOpen = m.classList.contains('open');
      closeDropdowns();
      if (!wasOpen) m.classList.add('open');
    }
    function closeDropdowns() { 
      document.querySelectorAll('.nav-dropdown-menu').forEach(m => m.classList.remove('open')); 
      document.querySelectorAll('.lang-switch-menu').forEach(m => m.classList.remove('open'));
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SWITCH LANGUE (A)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function toggleLangSwitch() {
      const menu = document.getElementById('lang-switch-menu');
      menu.classList.toggle('open');
    }
    // switchLang dÃ©fini plus bas avec langData

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CALENDRIER MENSUEL (B) - RETOUR V5
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function generateCalendar() {
      const container = document.getElementById('monthly-calendar');
      if (!container) return;
      
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = (firstDay.getDay() + 6) % 7; // Lundi = 0
      
      // Header dÃ©jÃ  en HTML, on gÃ©nÃ¨re les jours
      let html = '';
      
      // Jours vides avant le 1er
      for (let i = 0; i < startDay; i++) {
        html += '<div class="calendar-day inactive"></div>';
      }
      
      // DonnÃ©es simulÃ©es de rÃ©vision
      const donedays = [2, 5, 6, 7, 8, 9, 12, 13, 14, 15, 16, 19, 20, 21, 22, 23, 26, 27, 28, 29];
      const missedDays = [3, 10, 17, 24];
      const scheduledDays = [30, 31];
      
      // Jours du mois
      for (let d = 1; d <= lastDay.getDate(); d++) {
        let classes = 'calendar-day';
        if (d === today.getDate()) classes += ' today';
        if (donedays.includes(d)) classes += ' done scheduled';
        else if (missedDays.includes(d)) classes += ' missed scheduled';
        else if (scheduledDays.includes(d)) classes += ' scheduled';
        
        html += `<div class="${classes}" onclick="showDayDetail(${d})">${d}</div>`;
      }
      
      container.innerHTML += html;
      
      // Mettre Ã  jour le nom du mois
      const months = ['Janvier','FÃ©vrier','Mars','Avril','Mai','Juin','Juillet','AoÃ»t','Septembre','Octobre','Novembre','DÃ©cembre'];
      document.getElementById('calendar-month').textContent = months[month] + ' ' + year;
    }
    
    function showDayDetail(day) {
      const detail = document.getElementById('day-detail');
      detail.style.display = 'block';
      document.getElementById('day-detail-title').textContent = 'ğŸ“‹ DÃ©tail du ' + day + ' janvier';
      
      // DonnÃ©es simulÃ©es
      const done = day < 30;
      document.getElementById('dd-vocab-written').textContent = done ? '8' : '10';
      document.getElementById('dd-vocab-oral').textContent = done ? '5' : '5';
      document.getElementById('dd-grammar').textContent = done ? '2' : '2';
      
      // Mettre Ã  jour les badges
      const badges = detail.querySelectorAll('.badge');
      if (done) {
        badges[0].className = 'badge badge-green';
        badges[0].style.fontSize = '8px';
        badges[0].textContent = 'âœ“';
        badges[1].className = 'badge badge-green';
        badges[1].style.fontSize = '8px';
        badges[1].textContent = 'âœ“';
        badges[2].className = 'badge badge-green';
        badges[2].style.fontSize = '8px';
        badges[2].textContent = 'âœ“';
      } else {
        badges[0].className = 'badge badge-orange';
        badges[0].textContent = 'â†’';
        badges[1].className = 'badge badge-orange';
        badges[1].textContent = 'â†’';
        badges[2].className = 'badge badge-orange';
        badges[2].textContent = 'â†’';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUDIO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function playAudio(text) {
      if (currentSpeech) speechSynthesis.cancel();
      if ('speechSynthesis' in window) {
        currentSpeech = new SpeechSynthesisUtterance(text);
        currentSpeech.lang = 'en-US';
        currentSpeech.rate = 0.9;
        speechSynthesis.speak(currentSpeech);
      }
    }
    function pauseAudio() { if (speechSynthesis.speaking) speechSynthesis.pause(); else speechSynthesis.resume(); }
    function stopAudio() { speechSynthesis.cancel(); currentSpeech = null; }
    function startReadingAudio() { playAudio(document.getElementById('reading-content').innerText); }
    function pauseReadingAudio() { pauseAudio(); }
    function stopReadingAudio() { stopAudio(); }
    function playFullGrammarAudio() { playAudio('The Present Simple expresses habits and general truths. She works in London. Water boils at 100 degrees.'); }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RÃ‰VISION VOCAB Ã‰CRIT - V12: UTILISE langData PAR LANGUE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // V12: Initialiser la page rÃ©vision Ã©crit
    function initRevisionWritten() {
      const data = getLangData();
      currentRevisionIndex = 0;
      
      if (!data.revisionWords || data.revisionWords.length === 0) {
        document.getElementById('revision-written-empty').style.display = 'block';
        document.getElementById('revision-written-content').style.display = 'none';
      } else {
        document.getElementById('revision-written-empty').style.display = 'none';
        document.getElementById('revision-written-content').style.display = 'block';
        updateRevisionWrittenUI();
      }
    }
    
    function checkRevisionWritten() {
      const words = getLangData().revisionWords;
      if (!words || words.length === 0) return;
      
      const input = document.getElementById('revision-written-answer');
      const answer = input.value.trim().toLowerCase();
      const expected = words[currentRevisionIndex].target.toLowerCase();
      const fb = document.getElementById('revision-written-feedback');
      
      fb.style.display = 'block';
      
      // TolÃ©rance typo lÃ©gÃ¨re (1 caractÃ¨re de diffÃ©rence)
      const isClose = levenshtein(answer, expected) <= 1;
      const isCorrect = answer === expected;
      
      if (isCorrect) {
        fb.style.background = 'rgba(34,197,94,0.15)';
        fb.innerHTML = '<span style="color:var(--green);font-size:18px">âœ… Correct ! ğŸ‰</span><br><span style="font-size:13px">Bravo, tu gÃ¨res ! Ce mot reviendra dans 15 jours.</span>';
        decrementTodoCounter('vocabWritten', 'written_' + currentRevisionIndex);
      } else if (isClose) {
        fb.style.background = 'rgba(245,158,11,0.15)';
        fb.innerHTML = '<span style="color:var(--orange);font-size:18px">ğŸ‘ Presque !</span><br><span style="font-size:13px">La bonne rÃ©ponse est <strong>' + words[currentRevisionIndex].target + '</strong>. Ce mot reviendra dans 7 jours.</span>';
        decrementTodoCounter('vocabWritten', 'written_' + currentRevisionIndex);
      } else {
        fb.style.background = 'rgba(239,68,68,0.15)';
        fb.innerHTML = '<span style="color:var(--red);font-size:18px">âŒ Pas encore ğŸ˜•</span><br><span style="font-size:13px">La bonne rÃ©ponse est <strong>' + words[currentRevisionIndex].target + '</strong>. On le revoit dans 3 jours !</span>';
      }
      
      // Bouton suivant
      setTimeout(() => {
        fb.innerHTML += '<br><button class="btn btn-primary btn-sm" style="margin-top:12px" onclick="nextRevisionWord()">Mot suivant â†’</button>';
      }, 500);
    }
    
    function nextRevisionWord() {
      const words = getLangData().revisionWords;
      currentRevisionIndex++;
      if (currentRevisionIndex >= words.length) {
        alert('ğŸ‰ Session terminÃ©e ! Tu as rÃ©visÃ© ' + words.length + ' mots.');
        showPage('home');
        return;
      }
      updateRevisionWrittenUI();
    }
    
    function skipRevisionWord() {
      const words = getLangData().revisionWords;
      currentRevisionIndex++;
      if (currentRevisionIndex >= words.length) {
        showPage('home');
        return;
      }
      updateRevisionWrittenUI();
    }
    
    function updateRevisionWrittenUI() {
      const words = getLangData().revisionWords;
      if (!words || words.length === 0) return;
      document.getElementById('revision-written-counter').textContent = 'Mot ' + (currentRevisionIndex+1) + '/' + words.length;
      document.getElementById('revision-written-word').textContent = words[currentRevisionIndex].fr;
      document.getElementById('revision-written-theme').textContent = words[currentRevisionIndex].theme || 'â€”';
      document.getElementById('revision-written-answer').value = '';
      document.getElementById('revision-written-feedback').style.display = 'none';
    }
    
    // Levenshtein distance pour tolÃ©rance typo
    function levenshtein(a, b) {
      if (a.length === 0) return b.length;
      if (b.length === 0) return a.length;
      const matrix = [];
      for (let i = 0; i <= b.length; i++) matrix[i] = [i];
      for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          if (b.charAt(i-1) === a.charAt(j-1)) matrix[i][j] = matrix[i-1][j-1];
          else matrix[i][j] = Math.min(matrix[i-1][j-1]+1, matrix[i][j-1]+1, matrix[i-1][j]+1);
        }
      }
      return matrix[b.length][a.length];
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RÃ‰VISION VOCAB ORAL - V12: UTILISE langData PAR LANGUE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // V12: Initialiser la page rÃ©vision oral
    function initRevisionOral() {
      const data = getLangData();
      currentOralIndex = 0;
      
      if (!data.oralWords || data.oralWords.length === 0) {
        document.getElementById('revision-oral-empty').style.display = 'block';
        document.getElementById('revision-oral-content').style.display = 'none';
      } else {
        document.getElementById('revision-oral-empty').style.display = 'none';
        document.getElementById('revision-oral-content').style.display = 'block';
        updateRevisionOralUI();
      }
    }
    
    function startOralRecording() {
      const words = getLangData().oralWords;
      if (!words || words.length === 0) return;
      
      const btn = document.getElementById('oral-record-btn');
      const status = document.getElementById('oral-recording-status');
      
      if (!isRecording) {
        isRecording = true;
        btn.textContent = 'â¹ï¸ ArrÃªter';
        btn.classList.remove('btn-accent');
        btn.classList.add('btn-red');
        status.textContent = 'ğŸ”´ Enregistrement en cours...';
        
        // Simule l'analyse aprÃ¨s 3s
        setTimeout(() => {
          if (isRecording) stopOralRecording();
        }, 3000);
      } else {
        stopOralRecording();
      }
    }
    
    function stopOralRecording() {
      isRecording = false;
      const btn = document.getElementById('oral-record-btn');
      const status = document.getElementById('oral-recording-status');
      const fb = document.getElementById('revision-oral-feedback');
      
      btn.textContent = 'ğŸ¤ S\'enregistrer';
      btn.classList.remove('btn-red');
      btn.classList.add('btn-accent');
      status.textContent = 'â³ Analyse en cours...';
      
      // Simule l'analyse automatique
      setTimeout(() => {
        const random = Math.random();
        fb.style.display = 'block';
        
        if (random > 0.6) {
          fb.style.background = 'rgba(34,197,94,0.15)';
          fb.innerHTML = '<span style="color:var(--green);font-size:18px">âœ… Super prononciation ! ğŸ‰</span><br><span style="font-size:13px">Tu maÃ®trises ce mot. Prochaine rÃ©vision dans 15 jours.</span>';
          decrementTodoCounter('vocabOral', 'oral_' + currentOralIndex);
        } else if (random > 0.3) {
          fb.style.background = 'rgba(245,158,11,0.15)';
          fb.innerHTML = '<span style="color:var(--orange);font-size:18px">ğŸ‘ Pas mal !</span><br><span style="font-size:13px">Quelques ajustements Ã  faire. On le revoit dans 7 jours.</span>';
          decrementTodoCounter('vocabOral', 'oral_' + currentOralIndex);
        } else {
          fb.style.background = 'rgba(239,68,68,0.15)';
          fb.innerHTML = '<span style="color:var(--red);font-size:18px">ğŸ˜• Ã€ retravailler</span><br><span style="font-size:13px">RÃ©Ã©coute le modÃ¨le et rÃ©essaie ! Prochaine rÃ©vision dans 3 jours.</span>';
        }
        status.textContent = 'âœ“ Analyse terminÃ©e';
        // Ajouter bouton suivant
        setTimeout(() => {
          fb.innerHTML += '<br><button class="btn btn-primary btn-sm" style="margin-top:12px" onclick="skipOralWord()">Suivant â†’</button>';
        }, 500);
      }, 1000);
    }
    
    function skipOralWord() {
      const words = getLangData().oralWords;
      currentOralIndex++;
      if (currentOralIndex >= words.length) {
        alert('ğŸ‰ Session orale terminÃ©e !');
        showPage('home');
        return;
      }
      updateRevisionOralUI();
    }
    
    // V12: Mise Ã  jour UI rÃ©vision oral
    function updateRevisionOralUI() {
      const words = getLangData().oralWords;
      if (!words || words.length === 0) return;
      document.getElementById('revision-oral-counter').textContent = 'Mot ' + (currentOralIndex+1) + '/' + words.length;
      document.getElementById('revision-oral-word').textContent = words[currentOralIndex].word;
      document.getElementById('revision-oral-phonetic').textContent = words[currentOralIndex].phonetic || 'â€”';
      document.getElementById('revision-oral-theme').textContent = words[currentOralIndex].theme || 'â€”';
      document.getElementById('revision-oral-feedback').style.display = 'none';
      document.getElementById('oral-recording-status').textContent = '';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RÃ‰VISION GRAMMAIRE (E) - Structure complÃ¨te
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function checkGrammarExercise() {
      const ans = document.getElementById('revision-grammar-answer').value.toLowerCase().trim();
      const fb = document.getElementById('revision-grammar-feedback');
      
      fb.style.display = 'block';
      
      if (ans === 'works') {
        fb.style.background = 'rgba(34,197,94,0.15)';
        fb.innerHTML = '<span style="color:var(--green)">âœ… Correct ! ğŸ‰</span><br><span style="font-size:12px">3Ã¨me personne (she/he/it) â†’ on ajoute -s</span>';
        revisionExercisesDone++;
      } else {
        fb.style.background = 'rgba(239,68,68,0.15)';
        fb.innerHTML = '<span style="color:var(--red)">âŒ Incorrect</span><br><span style="font-size:12px">RÃ©ponse attendue : <strong>works</strong> (she = 3Ã¨me personne â†’ +s)</span>';
      }
      
      // Si 3 exercices faits â†’ afficher bouton rÃ¨gle suivante
      document.getElementById('revision-exercise-count').textContent = 'Exercice ' + (revisionExercisesDone+1) + '/5';
      if (revisionExercisesDone >= 3) {
        document.getElementById('next-rule-btn').style.display = 'inline-flex';
      }
    }
    
    function nextGrammarExercise() {
      document.getElementById('revision-grammar-answer').value = '';
      document.getElementById('revision-grammar-feedback').style.display = 'none';
      // Charger exercice suivant (simulÃ©)
      const questions = [
        'She ___ (work) every day.',
        'He ___ (play) football on Sundays.',
        'The sun ___ (rise) in the east.',
        'My cat ___ (sleep) all day.',
        'Water ___ (boil) at 100Â°C.'
      ];
      const current = Math.min(revisionExercisesDone, questions.length-1);
      document.getElementById('revision-exercise-question').textContent = 'ComplÃ¨te : ' + questions[current];
      document.getElementById('revision-exercise-count').textContent = 'Exercice ' + (current+1) + '/5';
    }
    
    function nextGrammarRule() {
      const ruleTitle = document.getElementById('revision-rule-title').textContent;
      decrementTodoCounter('grammar', 'grammar_' + ruleTitle); // Avec ID protection
      alert('âœ… RÃ¨gle 1 validÃ©e ! Passage Ã  la rÃ¨gle 2...');
      revisionExercisesDone = 0;
      document.getElementById('next-rule-btn').style.display = 'none';
      document.getElementById('revision-rule-title').textContent = 'Past Simple';
      document.getElementById('revision-grammar-counter').textContent = 'RÃ¨gle 2/2';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // APPRENDRE - Multi-thÃ¨mes (F)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function toggleThemeCheckbox(el) {
      el.classList.toggle('checked');
      el.querySelector('input').checked = el.classList.contains('checked');
      validateLearnCount();
    }
    
    function validateLearnCount() {
      const checkedThemes = document.querySelectorAll('.theme-checkbox.checked').length;
      const wordCount = parseInt(document.getElementById('learn-count').value);
      const warning = document.getElementById('learn-count-warning');
      const btn = document.getElementById('btn-start-learning');
      
      if (checkedThemes === 0) {
        warning.textContent = 'âŒ SÃ©lectionne au moins 1 thÃ¨me.';
        warning.style.display = 'block';
        btn.disabled = true;
      } else if (wordCount < checkedThemes) {
        warning.textContent = 'âŒ Impossible : ' + wordCount + ' mots < ' + checkedThemes + ' thÃ¨mes. Augmente le nombre de mots Ã  minimum ' + checkedThemes + '.';
        warning.style.display = 'block';
        btn.disabled = true;
      } else {
        warning.style.display = 'none';
        btn.disabled = false;
      }
    }
    
    let learnWords = [
      {en:'Meeting', fr:'RÃ©union', phonetic:'/ËˆmiËtÉªÅ‹/', emoji:'ğŸ“…', theme:'RÃ©unions', example:'We have a meeting at 10am.'},
      {en:'Deadline', fr:'Date limite', phonetic:'/ËˆdedlaÉªn/', emoji:'â°', theme:'RÃ©unions', example:'The deadline is next Friday.'},
      {en:'Airport', fr:'AÃ©roport', phonetic:'/ËˆeÉ™pÉ”Ët/', emoji:'âœˆï¸', theme:'Voyage', example:'I\'ll meet you at the airport.'}
    ];
    let learnIndex = 0;
    
    function startLearning() {
      const checkedThemes = document.querySelectorAll('.theme-checkbox.checked').length;
      const wordCount = parseInt(document.getElementById('learn-count').value);
      
      if (checkedThemes === 0) {
        alert('SÃ©lectionne au moins 1 thÃ¨me !');
        return;
      }
      if (wordCount < checkedThemes) {
        alert('âš ï¸ Tu dois sÃ©lectionner au moins ' + checkedThemes + ' mots (1 par thÃ¨me).');
        return;
      }
      
      learnIndex = 0;
      document.getElementById('learn-area').style.display = 'block';
      updateLearnUI();
    }
    
    function updateLearnUI() {
      const w = learnWords[learnIndex];
      document.getElementById('learn-progress').textContent = 'Mot ' + (learnIndex+1) + '/' + learnWords.length;
      document.getElementById('learn-current-theme').textContent = w.theme;
      document.getElementById('learn-emoji').textContent = w.emoji;
      document.getElementById('learn-word-en').textContent = w.en;
      document.getElementById('learn-word-fr').textContent = w.fr;
      document.getElementById('learn-phonetic').textContent = w.phonetic;
      document.getElementById('learn-example').innerHTML = '<em>"' + w.example.replace(w.en, '<strong>' + w.en + '</strong>') + '"</em>';
    }
    
    function prevLearnWord() {
      if (learnIndex > 0) { learnIndex--; updateLearnUI(); }
    }
    
    function nextLearnWord() {
      if (learnIndex < learnWords.length - 1) { learnIndex++; updateLearnUI(); }
      else { alert('ğŸ‰ Session terminÃ©e ! Tu as appris ' + learnWords.length + ' nouveaux mots.'); showPage('home'); }
    }
    
    function toggleRecording() {
      isRecording = !isRecording;
      // Feedback simple
      if (isRecording) {
        alert('ğŸ¤ Enregistrement... (simulation)');
        setTimeout(() => { isRecording = false; }, 2000);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ã‰VALUATIONS (G)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Correction 0.1: DonnÃ©es par langue + PERSISTANCE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DATASETS COMPLETS PAR LANGUE (preview = donnÃ©es statiques)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // V12: MODÃˆLE DE DONNÃ‰ES UNIFIÃ‰ - ISOLATION COMPLÃˆTE PAR LANGUE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RÃˆGLE FONDAMENTALE : Chaque langue a son propre namespace de donnÃ©es
    // Aucun fallback EN autorisÃ© - si vide, afficher "Aucune donnÃ©e"
    
    let langData = {
      en: { 
        // PLANNING par langue
        planning: { days: ['L', 'M', 'Me', 'J', 'V'], duration: 30 },
        // NIVEAUX
        level: 'B1', 
        grcLevel: 'IntermÃ©diaire', 
        // COMPTEURS RÃ‰VISION
        vocabWritten: 10, 
        vocabOral: 5, 
        grammar: 1,
        // PROGRESSION (%)
        progress: { vocab: 72, grammar: 65, reading: 58, writing: 45, oral: 40, listening: 52 },
        progressGrc: { vocabGrc: 68, comprehension: 55, expression: 48 },
        // HISTORIQUE Ã‰VALUATIONS
        history: [
          { date: '15/01/2026', type: 'cecrl', score: 78, total: 120, level: 'B1' },
          { date: '15/01/2026', type: 'grc', score: 38, total: 60, level: 'IntermÃ©diaire' },
          { date: '01/01/2026', type: 'cecrl', score: 65, total: 120, level: 'A2' }
        ],
        // Ã‰VOLUTION MENSUELLE
        evolution: { 
          cecrl: [{m:'Oct',l:'A1',h:30},{m:'Nov',l:'A2',h:45},{m:'DÃ©c',l:'A2',h:60},{m:'Jan',l:'B1',h:75}], 
          grc: [{m:'Oct',l:'Jr',h:25},{m:'Nov',l:'Jr',h:40},{m:'DÃ©c',l:'Int',h:55},{m:'Jan',l:'Int',h:65}] 
        },
        // THÃˆMES VOCABULAIRE
        vocabThemes: [
          { id: 'meetings', name: 'RÃ©unions', icon: 'ğŸ’¼', type: 'pro', count: 42, mastery: 75 },
          { id: 'travel', name: 'Voyage', icon: 'âœˆï¸', type: 'perso', count: 38, mastery: 60 },
          { id: 'compliance', name: 'ConformitÃ©', icon: 'ğŸ“‹', type: 'pro', count: 35, mastery: 45 }
        ],
        // TEXTES LECTURE
        readingTexts: [
          { id: 'meeting-etiquette', title: 'Business Meeting Etiquette', level: 'B1', theme: 'meetings' },
          { id: 'travel-tips', title: 'Travel Tips for Professionals', level: 'A2', theme: 'travel' }
        ],
        // V12: RÃ‰VISION Ã‰CRITE par langue
        revisionWords: [
          {fr:'RÃ©union', target:'meeting', theme:'RÃ©unions'},
          {fr:'Date limite', target:'deadline', theme:'RÃ©unions'},
          {fr:'Rapport', target:'report', theme:'RÃ©unions'},
          {fr:'AÃ©roport', target:'airport', theme:'Voyage'},
          {fr:'HÃ´tel', target:'hotel', theme:'Voyage'}
        ],
        // V12: RÃ‰VISION ORALE par langue
        oralWords: [
          {word:'Airport', phonetic:'/ËˆeÉ™pÉ”Ët/', theme:'Voyage'},
          {word:'Meeting', phonetic:'/ËˆmiËtÉªÅ‹/', theme:'RÃ©unions'},
          {word:'Schedule', phonetic:'/ËˆÊƒedjuËl/', theme:'RÃ©unions'}
        ],
        // V12: GRAMMAIRE par langue
        grammarRules: [
          { id: 'present-simple', name: 'Present Simple', level: 'A1', mastery: 85, exercises: [
            {q: 'She ___ (work) every day.', a: 'works'},
            {q: 'He ___ (play) football.', a: 'plays'},
            {q: 'It ___ (rain) a lot here.', a: 'rains'}
          ]},
          { id: 'past-simple', name: 'Past Simple', level: 'A2', mastery: 60, exercises: [
            {q: 'I ___ (go) to Paris last year.', a: 'went'},
            {q: 'She ___ (see) the movie yesterday.', a: 'saw'}
          ]}
        ],
        // V12: FLASHCARDS par langue
        flashcards: [
          {front:'Meeting', back:'RÃ©union'}, {front:'Deadline', back:'Date limite'}, {front:'Report', back:'Rapport'},
          {front:'Schedule', back:'Planning'}, {front:'Agenda', back:'Ordre du jour'}, {front:'Airport', back:'AÃ©roport'},
          {front:'Hotel', back:'HÃ´tel'}, {front:'Ticket', back:'Billet'}, {front:'Family', back:'Famille'}, {front:'Travel', back:'Voyage'}
        ],
        // V12: JEUX par langue avec donnÃ©es et scores
        games: {
          match: {
            pairs: [
              {target:'Meeting', fr:'RÃ©union'}, {target:'Deadline', fr:'Date limite'}, 
              {target:'Report', fr:'Rapport'}, {target:'Schedule', fr:'Planning'},
              {target:'Airport', fr:'AÃ©roport'}, {target:'Hotel', fr:'HÃ´tel'}
            ],
            score: 0
          },
          speed: {
            words: [
              {fr:'RÃ©union', target:'meeting'}, {fr:'Rapport', target:'report'},
              {fr:'Date limite', target:'deadline'}, {fr:'Planning', target:'schedule'},
              {fr:'ConformitÃ©', target:'compliance'}, {fr:'Audit', target:'audit'}
            ],
            score: 0
          },
          sentence: {
            sentences: [
              {fr:'La rÃ©union commence Ã  10 heures.', words:['The','meeting','starts','at','10','o\'clock'], correct:'The meeting starts at 10 o\'clock'},
              {fr:'Le rapport est sur la table.', words:['The','report','is','on','the','table'], correct:'The report is on the table'},
              {fr:'Elle travaille dans la conformitÃ©.', words:['She','works','in','compliance'], correct:'She works in compliance'}
            ],
            score: 0
          },
          fillblank: {
            questions: [
              {sentence:'The company must ensure ___ with regulations.', answer:'compliance', options:['compliance','compliant','comply'], theme:'GRC'},
              {sentence:'We need to assess the ___ of this project.', answer:'risk', options:['risk','risky','risking'], theme:'GRC'},
              {sentence:'The internal ___ revealed some issues.', answer:'audit', options:['audit','auditor','auditing'], theme:'GRC'}
            ],
            score: 0
          },
          puzzle: {
            words: [
              {hint:'Document rÃ©sumant une rÃ©union', answer:'MINUTES'},
              {hint:'Ã‰valuation des dangers potentiels', answer:'RISK'},
              {hint:'Respect des rÃ¨gles', answer:'COMPLIANCE'}
            ],
            score: 0
          }
        },
        // V12: Ã‰TAT Ã‰VALUATION sauvegardÃ© par langue
        examState: null,
        // V12: ITEMS VALIDÃ‰S par langue
        validatedItems: { vocabWritten: [], vocabOral: [], grammar: [] }
      },
      es: { 
        // ESPAGNOL - donnÃ©es fictives
        planning: { days: [], duration: 30 },
        level: null, grcLevel: null, vocabWritten: 0, vocabOral: 0, grammar: 0,
        progress: null, progressGrc: null, history: [], evolution: null, 
        vocabThemes: [], readingTexts: [],
        revisionWords: [],
        oralWords: [],
        grammarRules: [],
        flashcards: [],
        games: {
          match: { pairs: [], score: 0 },
          speed: { words: [], score: 0 },
          sentence: { sentences: [], score: 0 },
          fillblank: { questions: [], score: 0 },
          puzzle: { words: [], score: 0 }
        },
        examState: null,
        validatedItems: { vocabWritten: [], vocabOral: [], grammar: [] }
      },
      ko: { 
        // CORÃ‰EN - donnÃ©es fictives
        planning: { days: [], duration: 30 },
        level: null, grcLevel: null, vocabWritten: 0, vocabOral: 0, grammar: 0,
        progress: null, progressGrc: null, history: [], evolution: null, 
        vocabThemes: [], readingTexts: [],
        revisionWords: [],
        oralWords: [],
        grammarRules: [],
        flashcards: [],
        games: {
          match: { pairs: [], score: 0 },
          speed: { words: [], score: 0 },
          sentence: { sentences: [], score: 0 },
          fillblank: { questions: [], score: 0 },
          puzzle: { words: [], score: 0 }
        },
        examState: null,
        validatedItems: { vocabWritten: [], vocabOral: [], grammar: [] }
      }
    };
    let activeLang = 'en';
    
    // V12: Accesseur rapide pour la langue active
    function getLangData() { return langData[activeLang]; }
    
    // Charger donnÃ©es persistÃ©es
    function loadPersistedData() {
      const savedLang = localStorage.getItem('lingualearnna_activeLang');
      if (savedLang) activeLang = savedLang;
      const savedLangData = localStorage.getItem('lingualearnna_langData_v12');
      if (savedLangData) {
        const parsed = JSON.parse(savedLangData);
        // Merge pour prÃ©server la structure
        Object.keys(parsed).forEach(lang => {
          if (langData[lang]) langData[lang] = { ...langData[lang], ...parsed[lang] };
        });
      }
    }
    
    function persistData() {
      localStorage.setItem('lingualearnna_activeLang', activeLang);
      localStorage.setItem('lingualearnna_langData_v12', JSON.stringify(langData));
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SWITCH LANGUE â†’ applyLanguageContext (FONCTION CENTRALE)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function switchLang(code, flag) {
      activeLang = code;
      const langNames = {en:'Anglais', es:'Espagnol', ko:'CorÃ©en'};
      document.getElementById('header-lang-flag').textContent = flag;
      document.querySelectorAll('.lang-switch-item').forEach(i => i.classList.toggle('active', i.dataset.lang === code));
      document.getElementById('lang-switch-menu').classList.remove('open');
      const homeActiveLang = document.getElementById('home-active-lang');
      if (homeActiveLang) homeActiveLang.textContent = flag + ' ' + langNames[code];
      // APPEL CENTRAL
      applyLanguageContext();
      persistData();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // applyLanguageContext : re-render TOUT pour la langue active
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function applyLanguageContext() {
      const data = getLangData();
      const hasData = data.level !== null;
      
      // V12: Reset des index de session
      currentRevisionIndex = 0;
      currentOralIndex = 0;
      flashcardIndex = 0;
      flashcardStats = {knew:0, hesitated:0, didnt:0};
      matchSelected = {target:null, fr:null};
      revisionExercisesDone = 0;
      
      // 1. Header + Compteurs
      renderLevelAndCounters(data);
      
      // 2. Planning (V12: maintenant par langue)
      renderPlanning();
      
      // 3. Barres "Ma progression" (accueil + Ã©valuations)
      renderProgressBars(data, hasData);
      
      // 4. Graphiques Ã©volution
      renderEvolutionGraphs(data, hasData);
      
      // 5. Historique Ã©valuations
      renderHistory(data, hasData);
      
      // 6. Liste vocabulaire (thÃ¨mes)
      renderVocabThemes(data, hasData);
      
      // 7. Textes lecture
      renderReadingTexts(data, hasData);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function renderLevelAndCounters(data) {
      // Header
      document.getElementById('header-level').textContent = data.level || 'â€”';
      // Accueil
      const homeCecrl = document.getElementById('home-cecrl-level');
      if (homeCecrl) homeCecrl.textContent = data.level || 'â€”';
      const homeGrc = document.getElementById('home-grc-level');
      if (homeGrc) homeGrc.textContent = data.grcLevel || 'â€”';
      // Ã‰valuations
      const evalCecrl = document.getElementById('eval-cecrl-level');
      if (evalCecrl) evalCecrl.textContent = data.level || 'â€”';
      const evalGrc = document.getElementById('eval-grc-level');
      if (evalGrc) evalGrc.textContent = data.grcLevel || 'â€”';
      // Compteurs
      document.getElementById('todo-vocab-written').textContent = data.vocabWritten + ' mots';
      document.getElementById('todo-vocab-oral').textContent = data.vocabOral + ' mots';
      document.getElementById('todo-grammar').textContent = data.grammar + ' rÃ¨gle' + (data.grammar > 1 ? 's' : '');
    }
    
    function renderProgressBars(data, hasData) {
      // V11: Accueil - bloc progression (SANS CTA Ã©valuation - dÃ©placÃ© vers Mon niveau)
      const progressContainer = document.getElementById('home-progress-bars');
      if (progressContainer) {
        if (hasData && data.progress) {
          progressContainer.innerHTML = `
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Vocabulaire</span><span style="font-size:10px;">${data.progress.vocab}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.vocab}%;background:var(--blue);"></div></div></div>
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Grammaire</span><span style="font-size:10px;">${data.progress.grammar}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.grammar}%;background:var(--blue);"></div></div></div>
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Lecture</span><span style="font-size:10px;">${data.progress.reading}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.reading}%;background:var(--blue);"></div></div></div>
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Ã‰crit</span><span style="font-size:10px;">${data.progress.writing}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.writing}%;background:var(--blue);"></div></div></div>
            <div><div class="flex-between"><span style="font-size:10px;">Oral</span><span style="font-size:10px;">${data.progress.oral}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.oral}%;background:var(--blue);"></div></div></div>`;
        } else {
          // V11: Pas de CTA ici - le CTA est dans le bloc "Mon niveau"
          progressContainer.innerHTML = '<div style="text-align:center;padding:20px;color:var(--gray);"><p style="font-size:12px;">Aucune donnÃ©e pour cette langue</p><p style="font-size:10px;margin-top:8px;">Passe ta premiÃ¨re Ã©valuation pour voir ta progression.</p></div>';
        }
      }
      
      // V11: Bloc "Mon niveau" - afficher CTA si pas de donnÃ©es
      const levelBlock = document.getElementById('home-level-block');
      if (levelBlock) {
        if (hasData) {
          levelBlock.style.cursor = 'pointer';
          levelBlock.onclick = function() { showPage('evaluations'); };
        } else {
          levelBlock.style.cursor = 'default';
          levelBlock.onclick = null;
        }
      }
      const levelCTA = document.getElementById('home-level-cta');
      if (levelCTA) {
        levelCTA.style.display = hasData ? 'none' : 'block';
      }
      
      // Ã‰valuations - CECRL progress
      const evalCecrlProgress = document.getElementById('eval-cecrl-progress');
      if (evalCecrlProgress) {
        if (hasData && data.progress) {
          evalCecrlProgress.innerHTML = `
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Vocabulaire</span><span style="font-size:10px;">${data.progress.vocab}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.vocab}%;background:var(--blue);"></div></div></div>
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Grammaire</span><span style="font-size:10px;">${data.progress.grammar}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.grammar}%;background:var(--blue);"></div></div></div>
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Lecture</span><span style="font-size:10px;">${data.progress.reading}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.reading}%;background:var(--blue);"></div></div></div>
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Ã‰crit</span><span style="font-size:10px;">${data.progress.writing}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.writing}%;background:var(--blue);"></div></div></div>
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">Oral</span><span style="font-size:10px;">${data.progress.oral}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.oral}%;background:var(--blue);"></div></div></div>
            <div><div class="flex-between"><span style="font-size:10px;">Ã‰coute</span><span style="font-size:10px;">${data.progress.listening}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progress.listening}%;background:var(--blue);"></div></div></div>`;
        } else {
          evalCecrlProgress.innerHTML = '<div style="text-align:center;padding:16px;color:var(--gray);font-size:11px;">Aucune donnÃ©e</div>';
        }
      }
      
      // Ã‰valuations - GRC progress
      const evalGrcProgress = document.getElementById('eval-grc-progress');
      if (evalGrcProgress) {
        if (hasData && data.progressGrc) {
          evalGrcProgress.innerHTML = `
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">ğŸ“– Vocabulaire GRC</span><span style="font-size:10px;">${data.progressGrc.vocabGrc}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progressGrc.vocabGrc}%;background:var(--gold);"></div></div></div>
            <div style="margin-bottom:6px;"><div class="flex-between"><span style="font-size:10px;">ğŸ§  ComprÃ©hension</span><span style="font-size:10px;">${data.progressGrc.comprehension}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progressGrc.comprehension}%;background:var(--gold);"></div></div></div>
            <div><div class="flex-between"><span style="font-size:10px;">âœï¸ Expression</span><span style="font-size:10px;">${data.progressGrc.expression}%</span></div><div class="progress-bar" style="height:6px;"><div class="progress-fill" style="width:${data.progressGrc.expression}%;background:var(--gold);"></div></div></div>`;
        } else {
          evalGrcProgress.innerHTML = '<div style="text-align:center;padding:16px;color:var(--gray);font-size:11px;">Aucune donnÃ©e</div>';
        }
      }
    }
    
    function renderEvolutionGraphs(data, hasData) {
      // Accueil - graphique CECRL
      const homeCecrlGraph = document.getElementById('home-cecrl-graph');
      if (homeCecrlGraph) {
        if (hasData && data.evolution && data.evolution.cecrl) {
          homeCecrlGraph.innerHTML = data.evolution.cecrl.map(e => `<div style="flex:1;display:flex;flex-direction:column;align-items:center;"><div style="width:100%;height:${e.h}px;background:var(--blue);border-radius:2px;"></div><span style="font-size:8px;color:var(--gray);margin-top:2px;">${e.m}</span><span style="font-size:7px;color:var(--blue);">${e.l}</span></div>`).join('');
        } else {
          homeCecrlGraph.innerHTML = '<div style="text-align:center;padding:10px;color:var(--gray);font-size:10px;">â€”</div>';
        }
      }
      
      // Accueil - graphique GRC
      const homeGrcGraph = document.getElementById('home-grc-graph');
      if (homeGrcGraph) {
        if (hasData && data.evolution && data.evolution.grc) {
          homeGrcGraph.innerHTML = data.evolution.grc.map(e => `<div style="flex:1;display:flex;flex-direction:column;align-items:center;"><div style="width:100%;height:${e.h}px;background:var(--gold);border-radius:2px;"></div><span style="font-size:8px;color:var(--gray);margin-top:2px;">${e.m}</span><span style="font-size:7px;color:var(--gold);">${e.l}</span></div>`).join('');
        } else {
          homeGrcGraph.innerHTML = '<div style="text-align:center;padding:10px;color:var(--gray);font-size:10px;">â€”</div>';
        }
      }
      
      // Ã‰valuations - graphiques
      const evalCecrlGraph = document.getElementById('eval-cecrl-graph');
      if (evalCecrlGraph) {
        if (hasData && data.evolution && data.evolution.cecrl) {
          evalCecrlGraph.innerHTML = data.evolution.cecrl.map(e => `<div style="flex:1;text-align:center;"><div style="background:var(--blue);height:${e.h}px;border-radius:4px;"></div><span style="font-size:9px;color:var(--gray);">${e.m}</span><br><span style="font-size:8px;color:var(--blue);">${e.l}</span></div>`).join('');
        } else {
          evalCecrlGraph.innerHTML = '<div style="text-align:center;padding:20px;color:var(--gray);font-size:11px;">Aucune donnÃ©e</div>';
        }
      }
      
      const evalGrcGraph = document.getElementById('eval-grc-graph');
      if (evalGrcGraph) {
        if (hasData && data.evolution && data.evolution.grc) {
          evalGrcGraph.innerHTML = data.evolution.grc.map(e => `<div style="flex:1;text-align:center;"><div style="background:var(--gold);height:${e.h}px;border-radius:4px;"></div><span style="font-size:9px;color:var(--gray);">${e.m}</span><br><span style="font-size:8px;color:var(--gold);">${e.l}</span></div>`).join('');
        } else {
          evalGrcGraph.innerHTML = '<div style="text-align:center;padding:20px;color:var(--gray);font-size:11px;">Aucune donnÃ©e</div>';
        }
      }
    }
    
    function renderHistory(data, hasData) {
      const historyTable = document.getElementById('eval-history-tbody');
      if (historyTable) {
        if (hasData && data.history && data.history.length > 0) {
          historyTable.innerHTML = data.history.map(h => {
            const pct = Math.round(h.score / h.total * 100);
            const badgeClass = h.type === 'cecrl' ? 'badge-blue' : 'badge-gold';
            return `<tr class="history-row" onclick="showHistoryDetail('${h.date}','${h.type}',${h.score},${h.total},'${h.level}')"><td>${h.date}</td><td>${h.type.toUpperCase()}</td><td>${h.score}/${h.total} (${pct}%)</td><td><span class="badge ${badgeClass}">${h.level}</span></td></tr>`;
          }).join('');
        } else {
          historyTable.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:20px;color:var(--gray);"><p style="font-size:12px;">Aucune Ã©valuation pour cette langue</p><button class="btn btn-primary btn-sm" style="margin-top:8px;" onclick="showExamWelcome(\'cecrl\')">ğŸ“ Faire ma premiÃ¨re Ã©valuation</button></td></tr>';
        }
      }
    }
    
    function renderVocabThemes(data, hasData) {
      const vocabGrid = document.getElementById('vocab-themes-grid');
      if (vocabGrid) {
        if (hasData && data.vocabThemes && data.vocabThemes.length > 0) {
          vocabGrid.innerHTML = data.vocabThemes.map(t => {
            const badgeClass = t.type === 'pro' ? 'badge-gold' : 'badge-blue';
            const badgeText = t.type === 'pro' ? 'PRO' : 'PERSO';
            const progressColor = t.mastery >= 70 ? 'var(--green)' : t.mastery >= 40 ? 'var(--blue)' : 'var(--orange)';
            return `<div class="card card-clickable" onclick="showPage('vocab-theme')"><div class="flex-between" style="margin-bottom:8px;"><span style="font-size:24px;">${t.icon}</span><span class="badge ${badgeClass}">${badgeText}</span></div><h4 style="color:var(--blue);font-size:14px;">${t.name}</h4><p style="font-size:11px;color:var(--gray);">${t.count} mots</p><div class="progress-bar" style="margin-top:8px;"><div class="progress-fill" style="width:${t.mastery}%;background:${progressColor};"></div></div></div>`;
          }).join('');
        } else {
          vocabGrid.innerHTML = '<div class="card" style="grid-column:1/-1;text-align:center;padding:30px;"><p style="color:var(--gray);font-size:13px;">Aucun vocabulaire pour cette langue</p><p style="color:var(--gray);font-size:11px;margin-top:8px;">Commence par une Ã©valuation ou ajoute des thÃ¨mes.</p><button class="btn btn-primary btn-sm" style="margin-top:12px;" onclick="showExamWelcome(\'cecrl\')">ğŸ“ Commencer</button></div>';
        }
      }
    }
    
    function renderReadingTexts(data, hasData) {
      const readingList = document.getElementById('reading-texts-list');
      if (readingList) {
        if (hasData && data.readingTexts && data.readingTexts.length > 0) {
          readingList.innerHTML = data.readingTexts.map(t => `<div class="card card-clickable" onclick="showPage('reading-text')" style="margin-bottom:8px;"><div class="flex-between"><div><h4 style="color:var(--blue);font-size:14px;">${t.title}</h4><div class="flex-row" style="margin-top:4px;"><span class="badge badge-blue">${t.level}</span><span class="badge badge-gray">${t.theme}</span></div></div><span style="color:var(--gray);">â†’</span></div></div>`).join('');
        } else {
          readingList.innerHTML = '<div class="card" style="text-align:center;padding:30px;"><p style="color:var(--gray);font-size:13px;">Aucun texte disponible pour cette langue</p><p style="color:var(--gray);font-size:11px;margin-top:8px;">Les textes seront disponibles aprÃ¨s ta premiÃ¨re Ã©valuation.</p></div>';
        }
      }
    }
    
    function renderPlanning() {
      // V12: Utiliser le planning de la langue active
      const planning = getLangData().planning;
      const daysCount = planning.days.length;
      const duration = planning.duration;
      const durStr = duration < 60 ? duration + ' min' : Math.floor(duration/60) + 'h' + (duration%60 > 0 ? (duration%60 < 10 ? '0' : '') + duration%60 : '');
      
      // Bloc principal accueil
      const summary = document.getElementById('program-summary');
      if (summary) summary.textContent = daysCount + ' jours / semaine Â· ' + durStr;
      
      // AperÃ§u semaine (accueil)
      const allDays = ['L', 'M', 'Me', 'J', 'V', 'S', 'D'];
      const weekPreview = document.getElementById('week-preview');
      if (weekPreview) {
        weekPreview.innerHTML = allDays.map(d => {
          const isActive = planning.days.includes(d);
          const today = new Date().getDay();
          const dayIndex = allDays.indexOf(d);
          const isToday = (today === 0 && dayIndex === 6) || (today === dayIndex + 1);
          const cls = isToday ? 'active' : (isActive ? 'done' : 'inactive');
          return '<div style="text-align:center;flex:1;"><div class="day-dot '+cls+'">'+d+'</div></div>';
        }).join('');
      }
      
      // V12: SYNCHRONISER le bloc rÃ©sumÃ© Ã  droite (page planning)
      const summaryDays = document.getElementById('planning-summary-days');
      if (summaryDays) summaryDays.textContent = daysCount + ' jours / semaine';
      const summaryTime = document.getElementById('planning-summary-time');
      if (summaryTime) summaryTime.textContent = durStr + ' / jour';
      const summaryTotal = document.getElementById('planning-summary-total');
      if (summaryTotal) {
        const weeklyMinutes = daysCount * duration;
        const weeklyStr = weeklyMinutes < 60 ? weeklyMinutes + ' min' : Math.floor(weeklyMinutes/60) + 'h' + (weeklyMinutes%60 > 0 ? (weeklyMinutes%60 < 10 ? '0' : '') + weeklyMinutes%60 : '');
        summaryTotal.textContent = 'â‰ˆ ' + weeklyStr + ' par semaine';
      }
      
      // Profil
      const profileProg = document.getElementById('profile-program');
      if (profileProg) profileProg.textContent = daysCount + ' jours / semaine Â· ' + durStr;
      
      // Boutons jours (page planning)
      document.querySelectorAll('#planning-days .day-btn').forEach(btn => {
        btn.classList.toggle('active', planning.days.includes(btn.dataset.day));
      });
      
      // Select durÃ©e
      const durationSelect = document.getElementById('planning-duration');
      if (durationSelect) durationSelect.value = duration;
    }
    
    // V12: DÃ©crÃ©mentation compteurs AVEC PROTECTION (utilise langData par langue)
    function decrementTodoCounter(type, itemId) {
      const data = getLangData();
      if (itemId && data.validatedItems[type].includes(itemId)) {
        console.log('Item dÃ©jÃ  validÃ©:', itemId);
        return false;
      }
      if (data[type] > 0) { 
        data[type]--; 
        if (itemId) data.validatedItems[type].push(itemId);
        renderLevelAndCounters(data);
        persistData();
        return true;
      }
      return false;
    }
    
    // Alias pour compatibilitÃ©
    function updateLangDisplay() { renderLevelAndCounters(getLangData()); }
    function renderAllForLang() { applyLanguageContext(); }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ã‰VALUATIONS - V12 PROD READY
    // Configuration dynamique, pas de constantes codÃ©es en dur
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Configuration des Ã©valuations (source unique de vÃ©ritÃ©)
    const examConfig = {
      cecrl: {
        name: 'CECRL',
        icon: 'ğŸ“',
        sections: [
          { id: 'vocab', name: 'Vocabulaire', icon: 'ğŸ“–', questionsCount: 20 },
          { id: 'grammar', name: 'Grammaire', icon: 'âœï¸', questionsCount: 20 },
          { id: 'reading', name: 'Lecture', icon: 'ğŸ“„', questionsCount: 20 },
          { id: 'writing', name: 'Ã‰crit', icon: 'âœï¸', questionsCount: 20 },
          { id: 'oral', name: 'Oral', icon: 'ğŸ¤', questionsCount: 20 },
          { id: 'listening', name: 'Ã‰coute', icon: 'ğŸ‘‚', questionsCount: 20 }
        ],
        scoring: [
          { max: 40, level: 'A1' },
          { max: 55, level: 'A2' },
          { max: 70, level: 'B1' },
          { max: 100, level: 'B2' }
        ]
      },
      grc: {
        name: 'GRC MÃ©tier',
        icon: 'ğŸ’¼',
        sections: [
          { id: 'vocab-grc', name: 'Vocabulaire GRC', icon: 'ğŸ“–', questionsCount: 20 },
          { id: 'comprehension', name: 'ComprÃ©hension / Mini-cas', icon: 'ğŸ§ ', questionsCount: 20 },
          { id: 'expression', name: 'Expression professionnelle', icon: 'âœï¸', questionsCount: 20 }
        ],
        scoring: [
          { max: 40, level: 'Junior' },
          { max: 60, level: 'IntermÃ©diaire' },
          { max: 80, level: 'Senior' },
          { max: 100, level: 'Expert' }
        ]
      }
    };
    
    // Variables d'Ã©tat d'Ã©valuation (encapsulÃ©es)
    let examState = {
      type: null,           // 'cecrl' | 'grc'
      section: 0,           // Index section courante
      question: 0,          // Index question courante dans la section
      score: 0,             // Score total
      sectionScores: [],    // Scores par section
      isActive: false       // Ã‰valuation en cours
    };
    
    // Accesseurs sÃ©curisÃ©s avec garde-fous
    function getExamConfig(type) {
      const config = examConfig[type];
      if (!config) {
        console.error('[Exam] Invalid exam type:', type);
        return null;
      }
      return config;
    }
    
    function getTotalQuestions(type) {
      const config = getExamConfig(type);
      if (!config) return 0;
      return config.sections.reduce((total, s) => total + s.questionsCount, 0);
    }
    
    function getCurrentSectionConfig() {
      const config = getExamConfig(examState.type);
      if (!config || examState.section >= config.sections.length) return null;
      return config.sections[examState.section];
    }
    
    function getQuestionsInCurrentSection() {
      const section = getCurrentSectionConfig();
      return section ? section.questionsCount : 0;
    }
    
    // Legacy aliases pour compatibilitÃ© (Ã  supprimer progressivement)
    let examType = 'cecrl';
    let examSection = 0;
    let examQuestion = 0;
    let examScore = 0;
    let examSectionScores = [];
    const examSections = {
      cecrl: examConfig.cecrl.sections.map(s => s.name),
      grc: examConfig.grc.sections.map(s => s.name)
    };
    const examIcons = {
      cecrl: examConfig.cecrl.sections.map(s => s.icon),
      grc: examConfig.grc.sections.map(s => s.icon)
    };
    
    // Synchroniser Ã©tat legacy avec nouvel Ã©tat
    function syncExamState() {
      examType = examState.type || 'cecrl';
      examSection = examState.section;
      examQuestion = examState.question;
      examScore = examState.score;
      examSectionScores = [...examState.sectionScores];
    }
    
    function updateExamStateFromLegacy() {
      examState.type = examType;
      examState.section = examSection;
      examState.question = examQuestion;
      examState.score = examScore;
      examState.sectionScores = [...examSectionScores];
    }
    
    // V11: Page welcome avant examen
    function showExamWelcome(type) {
      examType = type;
      showPage('exam-welcome');
      if (type === 'cecrl') {
        document.getElementById('exam-welcome-icon').textContent = 'ğŸ“';
        document.getElementById('exam-welcome-title').textContent = 'Bienvenue dans l\'Ã©valuation CECRL';
        document.getElementById('exam-welcome-info').innerHTML = '<p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;"><strong>DurÃ©e estimÃ©e :</strong> 45-60 minutes</p><p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;"><strong>Nombre de questions :</strong> 120 (20 par section)</p><p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;"><strong>Sections :</strong> Vocabulaire, Grammaire, Lecture, Ã‰crit, Oral, Ã‰coute</p><p style="font-size: 13px; color: var(--gray);"><strong>Scoring :</strong> A1 < 40% â€¢ A2 40-55% â€¢ B1 55-70% â€¢ B2 > 70%</p>';
        document.getElementById('exam-grc-themes').style.display = 'none';
      } else {
        document.getElementById('exam-welcome-icon').textContent = 'ğŸ’¼';
        document.getElementById('exam-welcome-title').textContent = 'Bienvenue dans l\'Ã©valuation GRC MÃ©tier';
        document.getElementById('exam-welcome-info').innerHTML = '<p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;"><strong>DurÃ©e estimÃ©e :</strong> 30-40 minutes</p><p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;"><strong>Nombre de questions :</strong> 60 (20 par section)</p><p style="font-size: 13px; color: var(--gray); margin-bottom: 8px;"><strong>Sections :</strong></p><ul style="font-size: 12px; color: var(--gray); padding-left: 20px; margin-bottom: 8px;"><li>ğŸ“– Vocabulaire GRC</li><li>ğŸ§  ComprÃ©hension / Mini-cas</li><li>âœï¸ Expression professionnelle</li></ul><p style="font-size: 13px; color: var(--gray);"><strong>Niveaux :</strong> Junior < 40% â€¢ IntermÃ©diaire 40-60% â€¢ Senior 60-80% â€¢ Expert > 80%</p>';
        document.getElementById('exam-grc-themes').style.display = 'block';
      }
    }
    
    // V11: startExam va maintenant vers l'Ã©cran intro section
    function startExam() {
      examSection = 0;
      examQuestion = 0;
      examScore = 0;
      examSectionScores = [];
      showSectionIntro();
    }
    
    // V11: Afficher l'Ã©cran intro AVANT chaque section
    function showSectionIntro() {
      const sections = examSections[examType];
      const icons = examIcons[examType];
      const totalSections = sections.length;
      
      document.getElementById('section-intro-icon').textContent = icons[examSection];
      document.getElementById('section-intro-title').textContent = 'Section ' + (examSection+1) + '/' + totalSections + ' â€” ' + sections[examSection];
      
      showPage('exam-section-intro');
    }
    
    // V11: DÃ©marrer la section (aprÃ¨s l'Ã©cran intro)
    function startSection() {
      showPage('exam');
      updateExamUI();
    }
    
    // V11: Pause depuis l'Ã©cran intro
    function pauseExamFromIntro() {
      saveExamState();
      alert('âœ… Progression sauvegardÃ©e. Vous pouvez reprendre plus tard.');
      showPage('evaluations');
      checkSavedExam();
    }
    
    function updateExamUI() {
      const config = examConfig[examType];
      if (!config) return;
      
      const sections = config.sections;
      const totalSections = sections.length;
      const questionsInSection = getQuestionsInSection(examType, examSection);
      const totalQuestions = calculateTotalQuestions(examType);
      
      // Calculer questions faites jusqu'ici
      let questionsDone = 0;
      for (let i = 0; i < examSection; i++) {
        questionsDone += getQuestionsInSection(examType, i);
      }
      questionsDone += examQuestion + 1;
      
      const sectionIcon = sections[examSection] ? sections[examSection].icon : 'ğŸ“';
      const sectionName = sections[examSection] ? sections[examSection].name : '?';
      
      document.getElementById('exam-progress').textContent = 'Section ' + (examSection+1) + '/' + totalSections + ' â€¢ Q' + (examQuestion+1) + '/' + questionsInSection;
      document.getElementById('exam-progress-bar').style.width = (questionsDone / totalQuestions * 100) + '%';
      document.getElementById('exam-section-title').textContent = sectionIcon + ' Section : ' + sectionName;
    }
    
    function answerExam(btn, isCorrect) {
      if (btn.classList.contains('answered')) return;
      btn.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
        opt.classList.add('answered');
        if (opt === btn) opt.classList.add(isCorrect ? 'correct' : 'wrong');
        else if (opt.onclick && opt.onclick.toString().includes('true')) opt.classList.add('correct');
      });
      if (isCorrect) examScore++;
      
      const questionsInSection = getQuestionsInSection(examType, examSection);
      
      setTimeout(() => {
        examQuestion++;
        if (examQuestion >= questionsInSection) {
          // Calculer score de la section
          const previousTotal = examSectionScores.reduce((a,b) => a+b, 0);
          examSectionScores.push(examScore - previousTotal);
          examQuestion = 0;
          examSection++;
          
          const config = examConfig[examType];
          if (examSection >= config.sections.length) {
            // === FIN DE L'Ã‰VALUATION ===
            completeExam(); // Clear + showResult
            return;
          }
          showSectionEnd();
          return;
        }
        document.querySelectorAll('#exam-options .quiz-option').forEach(opt => opt.classList.remove('answered', 'correct', 'wrong'));
        updateExamUI();
      }, 1000);
    }
    
    // V11: Fin de section avec score
    function showSectionEnd() {
      showPage('exam-section-end');
      const sections = examSections[examType];
      const lastScore = examSectionScores[examSectionScores.length - 1];
      document.getElementById('section-end-title').textContent = 'Section "' + sections[examSection-1] + '" terminÃ©e !';
      document.getElementById('section-end-score').textContent = lastScore + '/20';
      if (examSection < sections.length) {
        document.getElementById('section-end-next').textContent = 'Section suivante : ' + sections[examSection] + ' (20 questions)';
        document.getElementById('section-end-next').style.display = 'block';
      } else {
        document.getElementById('section-end-next').style.display = 'none';
      }
    }
    
    // V12: Continuer vers Ã©cran intro de la section suivante
    function continueExam() {
      showSectionIntro();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // V12 PROD: PAUSE / REPRISE Ã‰VALUATION
    // ClÃ© localStorage: examProgress:{lang}:{type}
    // CORRECTIONS APPLIQUÃ‰ES:
    // 1. totalQuestions calculÃ© dynamiquement depuis examConfig
    // 2. Reprise directe Ã  la question (pas d'intro section)
    // 3. Deux blocs distincts pour CECRL et GRC
    // 4. Champ version supprimÃ© (pas de migration implÃ©mentÃ©e)
    // 5. Garde-fous sur variables globales
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    /**
     * GÃ©nÃ¨re la clÃ© localStorage pour une Ã©valuation
     */
    function getExamStorageKey(lang, type) {
      return `examProgress:${lang}:${type}`;
    }
    
    /**
     * Calcule le nombre total de questions depuis examConfig
     * CORRECTION 1: Pas de constante codÃ©e en dur
     */
    function calculateTotalQuestions(type) {
      const config = examConfig[type];
      if (!config || !config.sections) return 0;
      return config.sections.reduce((sum, section) => sum + (section.questionsCount || 0), 0);
    }
    
    /**
     * Calcule le nombre de questions dans une section spÃ©cifique
     */
    function getQuestionsInSection(type, sectionIndex) {
      const config = examConfig[type];
      if (!config || !config.sections || sectionIndex >= config.sections.length) return 0;
      return config.sections[sectionIndex].questionsCount || 0;
    }
    
    /**
     * CORRECTION 5: Valide l'Ã©tat des variables globales avant utilisation
     */
    function validateExamGlobals() {
      const errors = [];
      if (typeof examType !== 'string' || !examConfig[examType]) {
        errors.push('examType invalide: ' + examType);
      }
      if (typeof examSection !== 'number' || examSection < 0) {
        errors.push('examSection invalide: ' + examSection);
      }
      if (typeof examQuestion !== 'number' || examQuestion < 0) {
        errors.push('examQuestion invalide: ' + examQuestion);
      }
      if (typeof examScore !== 'number' || examScore < 0) {
        errors.push('examScore invalide: ' + examScore);
      }
      if (!Array.isArray(examSectionScores)) {
        errors.push('examSectionScores invalide');
      }
      if (errors.length > 0) {
        console.error('[ExamState] Validation failed:', errors);
        return false;
      }
      return true;
    }
    
    /**
     * Sauvegarde l'Ã©tat complet de l'Ã©valuation en cours
     * CORRECTION 1: totalQuestions dynamique
     * CORRECTION 4: Pas de champ version non exploitÃ©
     * CORRECTION 5: Validation avant sauvegarde
     */
    function saveExamState() {
      if (!validateExamGlobals()) {
        console.error('[ExamState] Cannot save invalid state');
        return false;
      }
      
      const totalQuestions = calculateTotalQuestions(examType);
      const questionsInSection = getQuestionsInSection(examType, examSection);
      
      const state = {
        type: examType,
        lang: activeLang,
        section: examSection,
        question: examQuestion,
        score: examScore,
        sectionScores: [...examSectionScores],
        totalQuestions: totalQuestions,
        questionsInSection: questionsInSection,
        savedAt: new Date().toISOString()
      };
      
      const key = getExamStorageKey(activeLang, examType);
      localStorage.setItem(key, JSON.stringify(state));
      console.log('[ExamState] Saved:', key, 'Section', state.section+1, 'Q', state.question+1);
      return true;
    }
    
    /**
     * Pause l'Ã©valuation en cours
     */
    function pauseExam() {
      if (saveExamState()) {
        alert('âœ… Progression sauvegardÃ©e. Tu peux reprendre plus tard.');
        showPage('evaluations');
        checkSavedExam();
      } else {
        alert('âŒ Erreur lors de la sauvegarde.');
      }
    }
    
    /**
     * VÃ©rifie si des Ã©valuations sont en pause pour la langue active
     * CORRECTION 3: Affiche les deux blocs distinctement (pas de prioritÃ© implicite)
     */
    function checkSavedExam() {
      // Bloc CECRL
      const zoneCecrl = document.getElementById('exam-resume-zone-cecrl');
      const cecrlState = localStorage.getItem(getExamStorageKey(activeLang, 'cecrl'));
      
      if (zoneCecrl) {
        if (cecrlState) {
          const state = JSON.parse(cecrlState);
          if (state.lang === activeLang) {
            zoneCecrl.style.display = 'block';
            renderResumeInfo('cecrl', state);
          } else {
            clearSavedExam('cecrl');
            zoneCecrl.style.display = 'none';
          }
        } else {
          zoneCecrl.style.display = 'none';
        }
      }
      
      // Bloc GRC
      const zoneGrc = document.getElementById('exam-resume-zone-grc');
      const grcState = localStorage.getItem(getExamStorageKey(activeLang, 'grc'));
      
      if (zoneGrc) {
        if (grcState) {
          const state = JSON.parse(grcState);
          if (state.lang === activeLang) {
            zoneGrc.style.display = 'block';
            renderResumeInfo('grc', state);
          } else {
            clearSavedExam('grc');
            zoneGrc.style.display = 'none';
          }
        } else {
          zoneGrc.style.display = 'none';
        }
      }
    }
    
    /**
     * Affiche les informations de reprise pour un type d'Ã©valuation
     */
    function renderResumeInfo(type, state) {
      const infoEl = document.getElementById('exam-resume-info-' + type);
      if (!infoEl) return;
      
      const config = examConfig[type];
      if (!config) return;
      
      const sections = config.sections;
      const sectionName = sections[state.section] ? sections[state.section].name : '?';
      const questionsInSection = state.questionsInSection || getQuestionsInSection(type, state.section);
      const totalQuestions = state.totalQuestions || calculateTotalQuestions(type);
      
      // Calculer progression exacte
      let questionsDone = 0;
      for (let i = 0; i < state.section; i++) {
        questionsDone += getQuestionsInSection(type, i);
      }
      questionsDone += state.question;
      const progress = totalQuestions > 0 ? Math.round((questionsDone / totalQuestions) * 100) : 0;
      
      infoEl.innerHTML = 
        '<strong>Section ' + (state.section+1) + '/' + sections.length + '</strong> â€” ' + sectionName + 
        '<br>Question ' + (state.question+1) + '/' + questionsInSection + ' â€¢ Score: ' + state.score + ' pts â€¢ ' + progress + '%';
    }
    
    /**
     * Reprend l'Ã©valuation sauvegardÃ©e
     * CORRECTION 2: Reprise directe Ã  la question (pas showSectionIntro)
     * CORRECTION 5: Validation aprÃ¨s restauration
     * @param {string} type - 'cecrl' ou 'grc'
     */
    function resumeSavedExam(type) {
      if (!type || !examConfig[type]) {
        alert('Type d\'Ã©valuation invalide.');
        return;
      }
      
      const savedState = localStorage.getItem(getExamStorageKey(activeLang, type));
      
      if (!savedState) {
        alert('Aucune Ã©valuation ' + type.toUpperCase() + ' en pause trouvÃ©e.');
        return;
      }
      
      const state = JSON.parse(savedState);
      
      // VÃ©rifier Ã©tanchÃ©itÃ© langue
      if (state.lang !== activeLang) {
        alert('Cette Ã©valuation appartient Ã  une autre langue.');
        clearSavedExam(type);
        checkSavedExam();
        return;
      }
      
      // Restaurer l'Ã©tat
      examType = state.type;
      examSection = state.section;
      examQuestion = state.question;
      examScore = state.score;
      examSectionScores = state.sectionScores || [];
      
      // CORRECTION 5: Valider aprÃ¨s restauration
      if (!validateExamGlobals()) {
        alert('Ã‰tat sauvegardÃ© corrompu. Veuillez recommencer.');
        clearSavedExam(type);
        checkSavedExam();
        return;
      }
      
      console.log('[ExamState] Resumed:', type, 'Section', examSection+1, 'Q', examQuestion+1);
      
      // CORRECTION 2: Aller DIRECTEMENT Ã  la question (pas d'intro)
      showPage('exam');
      updateExamUI();
    }
    
    /**
     * Recommence l'Ã©valuation depuis le dÃ©but
     * @param {string} type - 'cecrl' ou 'grc'
     */
    function restartExam(type) {
      if (!type || !examConfig[type]) {
        alert('Type d\'Ã©valuation invalide.');
        return;
      }
      
      if (!confirm('Recommencer effacera ta progression ' + type.toUpperCase() + '. Continuer ?')) {
        return;
      }
      
      clearSavedExam(type);
      examType = type;
      startExam();
    }
    
    /**
     * Abandonne dÃ©finitivement l'Ã©valuation en cours
     * @param {string} type - 'cecrl' ou 'grc'
     */
    function abandonExam(type) {
      if (!type) {
        alert('Type d\'Ã©valuation non spÃ©cifiÃ©.');
        return;
      }
      
      if (!confirm('Abandonner l\'Ã©valuation ' + type.toUpperCase() + ' ? Toute progression sera perdue.')) {
        return;
      }
      
      clearSavedExam(type);
      checkSavedExam();
    }
    
    // Alias pour compatibilitÃ©
    function cancelSavedExam() { 
      // Legacy: tente d'abandonner CECRL puis GRC
      if (localStorage.getItem(getExamStorageKey(activeLang, 'cecrl'))) {
        abandonExam('cecrl');
      } else if (localStorage.getItem(getExamStorageKey(activeLang, 'grc'))) {
        abandonExam('grc');
      }
    }
    
    /**
     * Efface l'Ã©tat sauvegardÃ© pour un type d'Ã©valuation
     * @param {string} type - 'cecrl' ou 'grc'
     */
    function clearSavedExam(type) {
      if (!type) {
        console.warn('[ExamState] clearSavedExam called without type');
        return;
      }
      const key = getExamStorageKey(activeLang, type);
      localStorage.removeItem(key);
      console.log('[ExamState] Cleared:', key);
    }
    
    /**
     * Quitter l'examen avec option de sauvegarde
     */
    function confirmQuitExam() {
      const choice = confirm('Sauvegarder ta progression avant de quitter ?');
      if (choice) {
        if (saveExamState()) {
          alert('âœ… Progression sauvegardÃ©e.');
        }
      }
      showPage('evaluations');
      checkSavedExam();
    }
    
    /**
     * AppelÃ© Ã  la fin d'une Ã©valuation complÃ©tÃ©e
     */
    function completeExam() {
      clearSavedExam(examType);
      showExamResult();
    }
    
    function showExamResult() {
      showPage('exam-result');
      const totalQuestions = calculateTotalQuestions(examType);
      const percent = totalQuestions > 0 ? Math.round(examScore / totalQuestions * 100) : 0;
      const config = examConfig[examType];
      
      let level;
      if (examType === 'cecrl') {
        if (percent < 40) level = 'A1'; else if (percent < 55) level = 'A2'; else if (percent < 70) level = 'B1'; else level = 'B2';
        getLangData().level = level;
      } else {
        if (percent < 40) level = 'Junior'; else if (percent < 60) level = 'IntermÃ©diaire'; else if (percent < 80) level = 'Senior'; else level = 'Expert';
        getLangData().grcLevel = level;
      }
      updateLangDisplay();
      persistData();
      document.getElementById('exam-result-level').textContent = level;
      document.getElementById('exam-result-score').textContent = 'Score : ' + examScore + '/' + totalQuestions + ' (' + percent + '%)';
      
      // Afficher rÃ©sultats par section avec questions dynamiques
      document.getElementById('exam-result-sections').innerHTML = config.sections.map((section, i) => {
        const questionsInSection = section.questionsCount || 0;
        const sc = examSectionScores[i] || 0;
        const pct = questionsInSection > 0 ? Math.round(sc / questionsInSection * 100) : 0;
        const col = pct >= 70 ? 'var(--green)' : pct >= 50 ? 'var(--orange)' : 'var(--red)';
        return '<div class="flex-between" style="padding: 10px; background: var(--light); border-radius: 6px; margin-bottom: 6px; border-left: 4px solid '+col+';"><span style="font-size: 13px;">'+section.icon+' '+section.name+'</span><span style="font-size: 13px; font-weight: bold; color: '+col+';">'+sc+'/'+questionsInSection+' ('+pct+'%)</span></div>';
      }).join('');
    }
    
    // V11: DÃ©tail historique
    function showHistoryDetail(date, type, score, total, level) {
      showPage('history-detail');
      document.getElementById('history-detail-date').textContent = date;
      document.getElementById('history-detail-type').textContent = 'Ã‰valuation ' + type.toUpperCase();
      document.getElementById('history-detail-level').textContent = level;
      document.getElementById('history-detail-level').className = 'badge ' + (type === 'cecrl' ? 'badge-blue' : 'badge-gold');
      document.getElementById('history-detail-score').textContent = score + '/' + total + ' (' + Math.round(score/total*100) + '%)';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Correction 5: AccordÃ©on vocabulaire
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function toggleWordDetail(wordId) {
      const detail = document.getElementById(wordId + '-detail');
      if (detail) detail.classList.toggle('open');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Correction 6: SÃ©lection texte lecture
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let selectedText = '';
    let selectionPosition = { x: 0, y: 0 };
    
    function handleTextSelection(event) {
      const selection = window.getSelection();
      const text = selection.toString().trim();
      if (text.length > 0) {
        selectedText = text;
        selectionPosition = { x: event.pageX, y: event.pageY };
        showSelectionToolbar();
      } else {
        hideSelectionToolbar();
      }
    }
    
    function showSelectionToolbar() {
      const toolbar = document.getElementById('selection-toolbar');
      toolbar.style.display = 'flex';
      toolbar.style.left = selectionPosition.x + 'px';
      toolbar.style.top = (selectionPosition.y - 50) + 'px';
    }
    
    function hideSelectionToolbar() {
      document.getElementById('selection-toolbar').style.display = 'none';
    }
    
    function playSelectedText() {
      if (selectedText) playAudio(selectedText);
      hideSelectionToolbar();
    }
    
    function showWordPopupFromSelection() {
      if (!selectedText) return;
      const popup = document.getElementById('text-selection-popup');
      document.getElementById('popup-word-title').textContent = selectedText;
      document.getElementById('popup-word-phonetic').textContent = 'â€”';
      document.getElementById('popup-word-def-fr').textContent = '(DÃ©finition Ã  complÃ©ter)';
      popup.style.left = selectionPosition.x + 'px';
      popup.style.top = selectionPosition.y + 'px';
      popup.classList.add('visible');
      hideSelectionToolbar();
    }
    
    function closeTextPopup() {
      document.getElementById('text-selection-popup').classList.remove('visible');
    }
    
    function playPopupAudio() {
      const word = document.getElementById('popup-word-title').textContent;
      playAudio(word);
    }
    
    function addPopupToVocab() {
      const word = document.getElementById('popup-word-title').textContent;
      alert('âœ… "' + word + '" ajoutÃ© Ã  ta liste !\nL\'admin le validera prochainement.');
      closeTextPopup();
    }
    
    function addWordFromReading(el) {
      const word = el.dataset.word;
      const def = el.dataset.def;
      const popup = document.getElementById('text-selection-popup');
      document.getElementById('popup-word-title').textContent = word;
      document.getElementById('popup-word-def-fr').textContent = def;
      const rect = el.getBoundingClientRect();
      popup.style.left = (rect.left + window.scrollX) + 'px';
      popup.style.top = (rect.bottom + window.scrollY + 10) + 'px';
      popup.classList.add('visible');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FLASHCARDS (H) - Retour contextuel
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function setFlashcardContext(ctx) {
      flashcardContext = ctx;
    }
    
    function goBackFromFlashcards() {
      if (flashcardContext === 'training') showPage('training');
      else if (flashcardContext === 'theme') showPage('vocab-theme');
      else showPage('vocab');
    }
    
    // V12: Variable locale pour les flashcards de session
    let sessionFlashcards = [];
    
    function startFlashcards() {
      const data = getLangData();
      if (!data.flashcards || data.flashcards.length === 0) {
        alert('Aucune flashcard disponible pour cette langue.');
        return;
      }
      
      const count = parseInt(document.getElementById('flashcard-count').value);
      sessionFlashcards = data.flashcards.slice(0, count);
      flashcardIndex = 0;
      flashcardStats = {knew:0, hesitated:0, didnt:0};
      document.getElementById('flashcard-start').style.display = 'none';
      document.getElementById('flashcard-playing').style.display = 'block';
      document.getElementById('flashcard-result').style.display = 'none';
      updateFlashcard();
    }
    function updateFlashcard() {
      if (sessionFlashcards.length === 0) return;
      const card = sessionFlashcards[flashcardIndex];
      document.getElementById('flashcard-front').textContent = card.front;
      document.getElementById('flashcard-back').textContent = card.back;
      document.getElementById('flashcard-back').style.display = 'none';
      document.getElementById('flashcard-counter').textContent = (flashcardIndex+1)+'/'+sessionFlashcards.length;
      document.getElementById('flashcard-eval').style.display = 'none';
    }
    function flipFlashcard() {
      document.getElementById('flashcard-back').style.display = 'block';
      document.getElementById('flashcard-eval').style.display = 'block';
    }
    function flashcardAnswer(ans) {
      flashcardStats[ans]++;
      flashcardIndex++;
      if (flashcardIndex >= sessionFlashcards.length) showFlashcardResult();
      else updateFlashcard();
    }
    function showFlashcardResult() {
      document.getElementById('flashcard-playing').style.display = 'none';
      document.getElementById('flashcard-result').style.display = 'block';
      document.getElementById('flashcard-knew').textContent = flashcardStats.knew;
      document.getElementById('flashcard-hesitated').textContent = flashcardStats.hesitated;
      document.getElementById('flashcard-didnt').textContent = flashcardStats.didnt;
    }
    function restartFlashcards() {
      document.getElementById('flashcard-result').style.display = 'none';
      document.getElementById('flashcard-start').style.display = 'block';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GRAMMAIRE - FILTRES DÃ‰COCHABLES (I)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function toggleGrammarFilter(el, level) {
      if (level === 'B2') return; // VerrouillÃ©
      
      el.classList.toggle('active');
      if (el.classList.contains('active')) {
        if (!grammarFilters.includes(level)) grammarFilters.push(level);
      } else {
        grammarFilters = grammarFilters.filter(l => l !== level);
      }
      
      // Filtrer les rÃ¨gles visibles
      document.querySelectorAll('#grammar-rules-list .card').forEach(card => {
        const cardLevel = card.dataset.level;
        card.style.display = grammarFilters.includes(cardLevel) ? 'block' : 'none';
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VERBES IRRÃ‰GULIERS (J) - Structure V5
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const verbGroups = {
      AAA: {
        title: 'Groupe AAA - Les 3 formes identiques',
        rule: 'Les trois formes sont identiques.',
        verbs: [
          {base:'cut', past:'cut', pp:'cut', fr:'couper'},
          {base:'put', past:'put', pp:'put', fr:'mettre'},
          {base:'let', past:'let', pp:'let', fr:'laisser'},
          {base:'set', past:'set', pp:'set', fr:'placer'},
          {base:'shut', past:'shut', pp:'shut', fr:'fermer'},
          {base:'hit', past:'hit', pp:'hit', fr:'frapper'},
          {base:'hurt', past:'hurt', pp:'hurt', fr:'blesser'},
          {base:'cost', past:'cost', pp:'cost', fr:'coÃ»ter'}
        ]
      },
      ABB: {
        title: 'Groupe ABB - Past = Past Participle',
        rule: 'Le Past Simple et le Past Participle sont identiques.',
        verbs: [
          {base:'bring', past:'brought', pp:'brought', fr:'apporter'},
          {base:'buy', past:'bought', pp:'bought', fr:'acheter'},
          {base:'think', past:'thought', pp:'thought', fr:'penser'},
          {base:'catch', past:'caught', pp:'caught', fr:'attraper'},
          {base:'teach', past:'taught', pp:'taught', fr:'enseigner'}
        ]
      },
      ABC: {
        title: 'Groupe ABC - Les 3 formes diffÃ©rentes',
        rule: 'Les trois formes sont toutes diffÃ©rentes.',
        verbs: [
          {base:'go', past:'went', pp:'gone', fr:'aller'},
          {base:'see', past:'saw', pp:'seen', fr:'voir'},
          {base:'take', past:'took', pp:'taken', fr:'prendre'},
          {base:'write', past:'wrote', pp:'written', fr:'Ã©crire'},
          {base:'begin', past:'began', pp:'begun', fr:'commencer'}
        ]
      }
    };
    
    function showVerbGroup(group) {
      const data = verbGroups[group];
      document.getElementById('verb-group-title').textContent = data.title;
      document.getElementById('verb-group-rule').textContent = data.rule;
      
      let html = '';
      data.verbs.forEach(v => {
        html += `<tr>
          <td><strong>${v.base}</strong></td>
          <td>${v.past}</td>
          <td>${v.pp}</td>
          <td>${v.fr}</td>
          <td><button class="audio-btn" onclick="playAudio('${v.base}, ${v.past}, ${v.pp}')">ğŸ”Š</button></td>
        </tr>`;
      });
      document.getElementById('verb-table-body').innerHTML = html;
      
      showPage('verb-group');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LECTURE (K) - Pop-up ajout vocabulaire
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function openReading(id) {
      showPage('reading-text');
    }
    
    function openWordPopup(word) {
      const add = confirm('Ajouter "' + word + '" Ã  ton vocabulaire ?');
      if (add) {
        alert('âœ… "' + word + '" ajoutÃ© Ã  ta liste de mots Ã  apprendre !\nL\'admin le validera prochainement.');
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DICTIONNAIRE (L) - Fonctionnel
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const dictData = {
      'meeting': {word:'Meeting', phonetic:'/ËˆmiËtÉªÅ‹/', translation:'RÃ©union', definition:'A gathering of people for a purpose.', example:'We have a meeting at 10am.'},
      'deadline': {word:'Deadline', phonetic:'/ËˆdedlaÉªn/', translation:'Date limite', definition:'The latest time by which something must be completed.', example:'The deadline is next Friday.'},
      'airport': {word:'Airport', phonetic:'/ËˆeÉ™pÉ”Ët/', translation:'AÃ©roport', definition:'A place where aircraft take off and land.', example:'I\'ll meet you at the airport.'},
      'report': {word:'Report', phonetic:'/rÉªËˆpÉ”Ët/', translation:'Rapport', definition:'A detailed account of something.', example:'Please submit your report by Monday.'},
      'why': {word:'Why', phonetic:'/waÉª/', translation:'Pourquoi', definition:'For what reason or purpose.', example:'Why are you late?'}
    };
    
    function searchDictionary() {
      const query = document.getElementById('dict-search').value.toLowerCase().trim();
      const result = document.getElementById('dict-result');
      const feedback = document.getElementById('dict-add-feedback');
      
      if (!query) return;
      
      const data = dictData[query];
      if (data) {
        result.style.display = 'block';
        document.getElementById('dict-word').textContent = data.word;
        document.getElementById('dict-phonetic').textContent = data.phonetic;
        document.getElementById('dict-translation').textContent = data.translation;
        document.getElementById('dict-definition').textContent = data.definition;
        document.getElementById('dict-example').textContent = '"' + data.example + '"';
        feedback.style.display = 'none';
      } else {
        result.style.display = 'block';
        document.getElementById('dict-word').textContent = query.charAt(0).toUpperCase() + query.slice(1);
        document.getElementById('dict-phonetic').textContent = 'â€”';
        document.getElementById('dict-translation').textContent = '(non trouvÃ©)';
        document.getElementById('dict-definition').textContent = 'Ce mot n\'est pas encore dans notre dictionnaire.';
        document.getElementById('dict-example').textContent = 'â€”';
      }
    }
    
    function addToDictVocab() {
      const word = document.getElementById('dict-word').textContent;
      const feedback = document.getElementById('dict-add-feedback');
      feedback.style.display = 'block';
      feedback.style.color = 'var(--green)';
      feedback.textContent = 'âœ… "' + word + '" ajoutÃ© Ã  ta liste ! L\'admin le validera bientÃ´t.';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // QUIZ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function startQuizVocab() {
      document.getElementById('quiz-vocab-start').style.display = 'none';
      document.getElementById('quiz-vocab-playing').style.display = 'block';
      document.getElementById('quiz-vocab-result').style.display = 'none';
      document.querySelectorAll('#quiz-vocab-playing .quiz-option').forEach(o => o.classList.remove('answered','correct','wrong'));
    }
    function startQuizGrammar() {
      document.getElementById('quiz-grammar-start').style.display = 'none';
      document.getElementById('quiz-grammar-playing').style.display = 'block';
      document.getElementById('quiz-grammar-result').style.display = 'none';
      document.querySelectorAll('#quiz-grammar-playing .quiz-option').forEach(o => o.classList.remove('answered','correct','wrong'));
    }
    function answerQuiz(btn, isCorrect) {
      if (btn.classList.contains('answered')) return;
      btn.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
        opt.classList.add('answered');
        if (opt === btn) opt.classList.add(isCorrect ? 'correct' : 'wrong');
        else if (opt.onclick && opt.onclick.toString().includes('true')) opt.classList.add('correct');
      });
      setTimeout(() => {
        const page = document.querySelector('.page.active');
        if (page.id === 'page-quiz-vocab') {
          document.getElementById('quiz-vocab-playing').style.display = 'none';
          document.getElementById('quiz-vocab-result').style.display = 'block';
        } else if (page.id === 'page-quiz-grammar') {
          document.getElementById('quiz-grammar-playing').style.display = 'none';
          document.getElementById('quiz-grammar-result').style.display = 'block';
        }
      }, 1500);
    }
    function exitQuiz() { if (confirm('Quitter ?')) showPage('training'); }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GAME MATCH
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function selectMatchWord(btn, lang, word) {
      if (btn.disabled) return;
      const col = document.getElementById(lang==='target' ? 'match-english' : 'match-french');
      col.querySelectorAll('.btn').forEach(b => { b.classList.remove('btn-primary'); b.classList.add('btn-outline'); });
      btn.classList.remove('btn-outline');
      btn.classList.add('btn-primary');
      matchSelected[lang] = {btn, word};
      if (matchSelected.target && matchSelected.fr) {
        if (matchSelected.target.word === matchSelected.fr.word) {
          // V12: +5 points par bonne rÃ©ponse
          getLangData().games.match.score += 5;
          matchSelected.target.btn.classList.add('btn-green');
          matchSelected.fr.btn.classList.add('btn-green');
          matchSelected.target.btn.disabled = true;
          matchSelected.fr.btn.disabled = true;
          document.getElementById('match-feedback').innerHTML = '<span style="color:var(--green)">âœ“ Correct ! +5 pts</span>';
          document.getElementById('match-score').textContent = 'Score: ' + getLangData().games.match.score;
          persistData();
        } else {
          document.getElementById('match-feedback').innerHTML = '<span style="color:var(--red)">âœ— Essaie encore</span>';
        }
        matchSelected = {target:null, fr:null};
      }
    }
    
    // V12: Initialiser le jeu match avec les donnÃ©es de la langue
    function initMatchGame() {
      const data = getLangData();
      const pairs = data.games.match.pairs;
      
      if (!pairs || pairs.length === 0) {
        document.getElementById('match-english').innerHTML = '<p style="color:var(--gray);padding:20px;text-align:center;">Aucune donnÃ©e pour cette langue</p>';
        document.getElementById('match-french').innerHTML = '<p style="color:var(--gray);padding:20px;text-align:center;">Ajoutez du contenu via Admin</p>';
        return;
      }
      
      // MÃ©langer les paires
      const shuffledTarget = [...pairs].sort(() => Math.random() - 0.5);
      const shuffledFr = [...pairs].sort(() => Math.random() - 0.5);
      
      document.getElementById('match-english').innerHTML = '<h4 style="color: var(--blue); margin-bottom: 12px;">ğŸ¯ Langue cible</h4>' +
        shuffledTarget.slice(0,4).map(p => `<button class="btn btn-outline" style="width:100%;margin-bottom:8px;" onclick="selectMatchWord(this,'target','${p.target}')">${p.target}</button>`).join('');
      
      document.getElementById('match-french').innerHTML = '<h4 style="color: var(--blue); margin-bottom: 12px;">ğŸ‡«ğŸ‡· FranÃ§ais</h4>' +
        shuffledFr.slice(0,4).map(p => `<button class="btn btn-outline" style="width:100%;margin-bottom:8px;" onclick="selectMatchWord(this,'fr','${p.target}')">${p.fr}</button>`).join('');
      
      document.getElementById('match-score').textContent = 'Score: ' + data.games.match.score;
      document.getElementById('match-feedback').innerHTML = '';
      matchSelected = {target:null, fr:null};
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // JEUX: SENTENCE BUILDER - V12 avec donnÃ©es par langue
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let sentenceWords = [];
    let currentSentenceIndex = 0;
    
    function initSentenceGame() {
      const data = getLangData();
      const sentences = data.games.sentence.sentences;
      
      if (!sentences || sentences.length === 0) {
        document.getElementById('sentence-words').innerHTML = '<p style="color:var(--gray);padding:20px;">Aucune donnÃ©e pour cette langue</p>';
        return;
      }
      
      currentSentenceIndex = 0;
      loadSentence();
      document.getElementById('sentence-score').textContent = 'Score: ' + data.games.sentence.score;
    }
    
    function loadSentence() {
      const sentences = getLangData().games.sentence.sentences;
      if (currentSentenceIndex >= sentences.length) {
        alert('ğŸ‰ Bravo ! Tu as complÃ©tÃ© tous les exercices.');
        showPage('games');
        return;
      }
      
      const s = sentences[currentSentenceIndex];
      document.querySelector('#page-game-sentence .card p[style*="font-weight: bold"]').textContent = '"' + s.fr + '"';
      
      // MÃ©langer les mots
      const shuffled = [...s.words].sort(() => Math.random() - 0.5);
      document.getElementById('sentence-words').innerHTML = shuffled.map(w => 
        `<button class="btn btn-outline btn-sm" onclick="addSentenceWord(this)">${w}</button>`
      ).join('');
      
      sentenceWords = [];
      document.getElementById('sentence-answer').textContent = '';
      document.getElementById('sentence-feedback').style.display = 'none';
    }
    
    function addSentenceWord(btn) {
      btn.disabled = true;
      btn.style.opacity = '0.5';
      sentenceWords.push(btn.textContent);
      document.getElementById('sentence-answer').textContent = sentenceWords.join(' ');
    }
    
    function resetSentence() {
      sentenceWords = [];
      document.getElementById('sentence-answer').textContent = '';
      document.querySelectorAll('#sentence-words .btn').forEach(b => {
        b.disabled = false;
        b.style.opacity = '1';
      });
      document.getElementById('sentence-feedback').style.display = 'none';
    }
    
    function checkSentence() {
      const data = getLangData();
      const sentences = data.games.sentence.sentences;
      const answer = sentenceWords.join(' ').toLowerCase();
      const correct = sentences[currentSentenceIndex].correct.toLowerCase();
      const fb = document.getElementById('sentence-feedback');
      fb.style.display = 'block';
      
      if (answer === correct) {
        fb.style.background = 'rgba(34,197,94,0.15)';
        fb.innerHTML = '<span style="color:var(--green);font-size:16px">âœ… Excellent ! +5 pts</span><br><span style="font-size:12px">Structure correcte</span><br><button class="btn btn-primary btn-sm" style="margin-top:8px" onclick="nextSentence()">Phrase suivante â†’</button>';
        data.games.sentence.score += 5;
        document.getElementById('sentence-score').textContent = 'Score: ' + data.games.sentence.score;
        persistData();
      } else {
        fb.style.background = 'rgba(239,68,68,0.15)';
        fb.innerHTML = '<span style="color:var(--red);font-size:16px">âŒ Pas tout Ã  fait</span><br><span style="font-size:12px">RÃ©ponse : "' + sentences[currentSentenceIndex].correct + '"</span><br><button class="btn btn-secondary btn-sm" style="margin-top:8px" onclick="resetSentence()">RÃ©essayer</button>';
      }
    }
    
    function nextSentence() {
      currentSentenceIndex++;
      loadSentence();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // JEUX: FILL IN THE BLANK (GRC) - V12 avec donnÃ©es par langue
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let currentFillBlankIndex = 0;
    
    function initFillBlankGame() {
      const data = getLangData();
      const questions = data.games.fillblank.questions;
      
      if (!questions || questions.length === 0) {
        document.querySelector('#page-game-fillblank .card').innerHTML = '<p style="color:var(--gray);padding:20px;text-align:center;">Aucune donnÃ©e GRC pour cette langue</p>';
        return;
      }
      
      currentFillBlankIndex = 0;
      loadFillBlank();
    }
    
    function loadFillBlank() {
      const data = getLangData();
      const questions = data.games.fillblank.questions;
      
      if (currentFillBlankIndex >= questions.length) {
        alert('ğŸ‰ Quiz GRC terminÃ© ! Score: ' + data.games.fillblank.score);
        showPage('games');
        return;
      }
      
      const q = questions[currentFillBlankIndex];
      document.getElementById('fillblank-progress').textContent = (currentFillBlankIndex+1) + '/' + questions.length;
      document.getElementById('fillblank-sentence').textContent = q.sentence;
      document.getElementById('fillblank-options').innerHTML = q.options.map(o => 
        `<button class="btn btn-outline btn-sm" onclick="selectFillBlankOption(this, '${o}')">${o}</button>`
      ).join('');
      document.getElementById('fillblank-feedback').style.display = 'none';
    }
    
    function selectFillBlankOption(btn, option) {
      const data = getLangData();
      const q = data.games.fillblank.questions[currentFillBlankIndex];
      const fb = document.getElementById('fillblank-feedback');
      
      // DÃ©sactiver tous les boutons
      document.querySelectorAll('#fillblank-options .btn').forEach(b => b.disabled = true);
      
      fb.style.display = 'block';
      
      if (option.toLowerCase() === q.answer.toLowerCase()) {
        btn.classList.add('btn-green');
        fb.style.background = 'rgba(34,197,94,0.15)';
        fb.innerHTML = '<span style="color:var(--green)">âœ… Correct ! +5 pts</span>';
        data.games.fillblank.score += 5;
        persistData();
      } else {
        btn.classList.add('btn-red');
        fb.style.background = 'rgba(239,68,68,0.15)';
        fb.innerHTML = '<span style="color:var(--red)">âŒ RÃ©ponse : ' + q.answer + '</span>';
      }
      
      setTimeout(() => {
        currentFillBlankIndex++;
        loadFillBlank();
      }, 1500);
    }
    
    // Legacy function pour compatibilitÃ©
    function checkFillBlank() {
      const answer = document.getElementById('fillblank-answer').value.toLowerCase().trim();
      const fb = document.getElementById('fillblank-feedback');
      fb.style.display = 'block';
      
      if (answer === 'compliance') {
        fb.style.background = 'rgba(34,197,94,0.15)';
        fb.innerHTML = '<span style="color:var(--green);font-size:16px">âœ… Correct !</span><br><span style="font-size:12px"><strong>Compliance</strong> = ConformitÃ© aux rÃ¨gles et rÃ©gulations</span>';
      } else {
        fb.style.background = 'rgba(239,68,68,0.15)';
        fb.innerHTML = '<span style="color:var(--red);font-size:16px">âŒ Incorrect</span><br><span style="font-size:12px">RÃ©ponse : <strong>compliance</strong> (conformitÃ©)</span>';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EXERCICES GRAMMAIRE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function checkExercise() {
      const ans = document.getElementById('exercise-answer').value.toLowerCase().trim();
      const fb = document.getElementById('exercise-feedback');
      fb.style.display = 'block';
      if (ans === 'works') {
        fb.style.background = 'rgba(34,197,94,0.15)';
        fb.innerHTML = '<span style="color:var(--green);font-weight:bold">âœ… Correct !</span><br><span style="font-size:12px">3Ã¨me personne = +s</span>';
        document.getElementById('exercise-score').textContent = parseInt(document.getElementById('exercise-score').textContent)+1;
      } else {
        fb.style.background = 'rgba(239,68,68,0.15)';
        fb.innerHTML = '<span style="color:var(--red);font-weight:bold">âŒ Incorrect</span><br><span style="font-size:12px">RÃ©ponse: works</span>';
      }
    }
    function skipExercise() {
      document.getElementById('exercise-answer').value = '';
      document.getElementById('exercise-feedback').style.display = 'none';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ADMIN (M)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showAdminTab(tab) {
      document.querySelectorAll('[id^="admin-tab-"]').forEach(t => t.style.display = 'none');
      document.getElementById('admin-tab-'+tab).style.display = 'block';
      const btns = document.querySelectorAll('#page-admin > .flex-row .btn');
      const tabs = ['users','imports','qualify'];
      btns.forEach((b,i) => b.className = tabs[i]===tab ? 'btn btn-primary btn-sm' : 'btn btn-secondary btn-sm');
    }
    // Correction 11 : Reset et Supprimer fonctionnels
    function resetPassword(user) { 
      const newPwd = Math.random().toString(36).slice(-8);
      alert('ğŸ”‘ Mot de passe rÃ©initialisÃ© pour ' + user + '\n\nNouveau mot de passe : ' + newPwd + '\n\nâš ï¸ Mode preview : action simulÃ©e.\nEn production : le nouveau mot de passe serait sauvegardÃ© en base.');
    }
    function deleteUser(user) { 
      if (confirm('âš ï¸ Supprimer dÃ©finitivement l\'utilisateur "' + user + '" ?\n\nCette action est irrÃ©versible.')) {
        alert('âœ… Mode preview : utilisateur "' + user + '" supprimÃ© (simulÃ©).\n\nEn production : suppression rÃ©elle en base de donnÃ©es.');
      }
    }
    // Correction 8.2 : Reset data tests
    function resetDataTests() {
      if (confirm('âš ï¸ ATTENTION !\n\nCette action va supprimer :\nâ€¢ Tous les utilisateurs de test\nâ€¢ Toutes les donnÃ©es de progression fictives\nâ€¢ Tous les contenus importÃ©s en test\n\nâŒ Les verbes irrÃ©guliers seront PRÃ‰SERVÃ‰S.\n\nContinuer ?')) {
        alert('ğŸ§¹ Mode preview : donnÃ©es de test effacÃ©es (simulÃ©).\n\nEn production : suppression rÃ©elle des tables :\nâ€¢ users (sauf admin)\nâ€¢ user_progress\nâ€¢ user_vocabulary\nâ€¢ imported_content (flag test)\n\nâœ… Verbes irrÃ©guliers prÃ©servÃ©s.');
      }
    }
    function downloadTemplate(type) { alert('ğŸ“¥ Mode preview : tÃ©lÃ©chargement simulÃ©.\n\nEn production : le fichier Excel "template_' + type + '.xlsx" serait gÃ©nÃ©rÃ© et tÃ©lÃ©chargÃ©.'); }
    function processImport(type) { alert('ğŸ“¤ Mode preview : import simulÃ©.\n\nEn production : le fichier serait parsÃ© et les donnÃ©es insÃ©rÃ©es dans la table correspondante.'); }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PLANNING - V12: Sauvegarde par langue
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function togglePlanningDay(el) { el.classList.toggle('active'); }
    function savePlanning() { 
      // RÃ©cupÃ©rer les jours sÃ©lectionnÃ©s
      const activeDays = document.querySelectorAll('#planning-days .day-btn.active');
      const duration = parseInt(document.getElementById('planning-duration').value);
      const dayLetters = Array.from(activeDays).map(b => b.dataset.day);
      
      // V12: Sauvegarder dans langData pour la langue active
      getLangData().planning = { days: dayLetters, duration: duration };
      
      // Render centralisÃ© + persistance
      renderPlanning();
      persistData();
      
      alert('âœ… Planning enregistrÃ© pour cette langue !'); 
      showPage('home'); 
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUTRES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showWordDetail(word) { alert('DÃ©tail: ' + word); }
    function setCoachMode(mode) {
      document.querySelectorAll('#page-coach .chip').forEach(c => c.classList.remove('active'));
      event.target.classList.add('active');
    }
    function sendChat() {
      const input = document.getElementById('chat-input');
      const msg = input.value.trim();
      if (!msg) return;
      const container = document.getElementById('chat-messages');
      container.innerHTML += '<div class="chat-bubble chat-user">'+msg+'</div>';
      input.value = '';
      setTimeout(() => {
        container.innerHTML += '<div class="chat-bubble chat-coach">Great question! Let me help you with that...</div>';
        container.scrollTop = container.scrollHeight;
      }, 1000);
    }
    function filterVocabByType() { console.log('Filter type'); }
    function filterVocabByMastery() { console.log('Filter mastery'); }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MODAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function openModal(type) {
      const modal = document.getElementById('modal');
      const content = document.getElementById('modal-content');
      
      if (type === 'create-user') {
        content.innerHTML = '<h3 style="color:var(--blue);margin-bottom:16px">â• CrÃ©er utilisateur</h3><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">PrÃ©nom *</label><input type="text" placeholder="PrÃ©nom"></div><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">Email *</label><input type="email" placeholder="email@ex.com"></div><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">RÃ´le</label><select><option>Utilisateur</option><option>Admin</option></select></div><div style="display:flex;gap:8px"><button class="btn btn-secondary" style="flex:1" onclick="closeModal()">Annuler</button><button class="btn btn-primary" style="flex:1" onclick="closeModal();alert(\'Utilisateur crÃ©Ã© !\')">CrÃ©er</button></div>';
      } else if (type === 'edit-user') {
        content.innerHTML = '<h3 style="color:var(--blue);margin-bottom:16px">âœï¸ Modifier utilisateur</h3><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">Niveau CECRL</label><select><option>A1</option><option selected>A2</option><option>B1</option><option>B2</option></select></div><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">Niveau GRC</label><select><option selected>Junior</option><option>IntermÃ©diaire</option><option>Senior</option><option>Expert</option></select></div><div style="display:flex;gap:8px"><button class="btn btn-secondary" style="flex:1" onclick="closeModal()">Annuler</button><button class="btn btn-primary" style="flex:1" onclick="closeModal();alert(\'EnregistrÃ© !\')">Enregistrer</button></div>';
      } else if (type === 'add-word') {
        content.innerHTML = '<h3 style="color:var(--blue);margin-bottom:16px">â• Proposer un mot</h3><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">Mot (EN)</label><input type="text" placeholder="Meeting"></div><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">Traduction (FR)</label><input type="text" placeholder="RÃ©union"></div><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">ThÃ¨me</label><select><option>RÃ©unions</option><option>ConformitÃ©</option><option>Voyage</option></select></div><div style="display:flex;gap:8px"><button class="btn btn-secondary" style="flex:1" onclick="closeModal()">Annuler</button><button class="btn btn-primary" style="flex:1" onclick="closeModal();alert(\'Mot soumis pour validation !\')">Soumettre</button></div>';
      } else if (type === 'add-theme') {
        content.innerHTML = '<h3 style="color:var(--blue);margin-bottom:16px">â• Ajouter thÃ¨me</h3><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">Type</label><select><option>Professionnel</option><option>Personnel</option></select></div><div style="margin-bottom:16px"><label style="font-size:11px;color:var(--gray)">ThÃ¨mes disponibles</label><div class="flex-wrap" style="margin-top:8px"><span class="chip" onclick="this.classList.toggle(\'active\')">Audit</span><span class="chip" onclick="this.classList.toggle(\'active\')">Risque</span><span class="chip" onclick="this.classList.toggle(\'active\')">Sport</span></div></div><div style="display:flex;gap:8px"><button class="btn btn-secondary" style="flex:1" onclick="closeModal()">Annuler</button><button class="btn btn-primary" style="flex:1" onclick="closeModal();alert(\'ThÃ¨mes ajoutÃ©s !\')">Ajouter</button></div>';
      } else if (type === 'edit-verbs') {
        content.innerHTML = '<h3 style="color:var(--blue);margin-bottom:16px">âœï¸ Modifier rÃ¨gles verbes irrÃ©guliers</h3><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">RÃ¨gle gÃ©nÃ©rale</label><textarea style="height:80px">Les verbes irrÃ©guliers anglais ne suivent pas la rÃ¨gle standard en -ed au passÃ©.</textarea></div><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">RÃ¨gle groupe AAA</label><input type="text" value="Les trois formes sont identiques."></div><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">RÃ¨gle groupe ABB</label><input type="text" value="Le Past Simple et le Past Participle sont identiques."></div><div style="margin-bottom:12px"><label style="font-size:11px;color:var(--gray)">RÃ¨gle groupe ABC</label><input type="text" value="Les trois formes sont toutes diffÃ©rentes."></div><div style="display:flex;gap:8px"><button class="btn btn-secondary" style="flex:1" onclick="closeModal()">Annuler</button><button class="btn btn-primary" style="flex:1" onclick="closeModal();alert(\'RÃ¨gles mises Ã  jour !\')">Enregistrer</button></div>';
      }
      
      modal.classList.add('open');
    }
    function closeModal() { document.getElementById('modal').classList.remove('open'); }
    document.getElementById('modal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('DOMContentLoaded', function() {
      // Charger donnÃ©es persistÃ©es AVANT tout
      loadPersistedData();
      
      const saved = localStorage.getItem('lingualearnna_user');
      if (saved) {
        currentUser = JSON.parse(saved);
        document.getElementById('onboarding-container').style.display = 'none';
        document.getElementById('login-container').style.display = 'flex';
      }
      
      // Render initial aprÃ¨s chargement donnÃ©es
      const langFlags = {en:'ğŸ‡¬ğŸ‡§', es:'ğŸ‡ªğŸ‡¸', ko:'ğŸ‡°ğŸ‡·'};
      const langNames = {en:'Anglais', es:'Espagnol', ko:'CorÃ©en'};
      document.getElementById('header-lang-flag').textContent = langFlags[activeLang];
      document.querySelectorAll('.lang-switch-item').forEach(i => i.classList.toggle('active', i.dataset.lang === activeLang));
      const homeActiveLang = document.getElementById('home-active-lang');
      if (homeActiveLang) homeActiveLang.textContent = langFlags[activeLang] + ' ' + langNames[activeLang];
      
      // Render centralisÃ©
      renderAllForLang();
      
      // Planning duration change listener
      const planningDuration = document.getElementById('planning-duration');
      if (planningDuration) {
        planningDuration.addEventListener('change', function() {
          const activeDays = document.querySelectorAll('#planning-days .day-btn.active');
          const duration = parseInt(this.value);
          const daysCount = activeDays.length;
          const total = daysCount * duration;
          const timeEl = document.getElementById('planning-summary-time');
          const totalEl = document.getElementById('planning-summary-total');
          if (timeEl) timeEl.textContent = (duration < 60 ? duration + ' min' : Math.floor(duration/60) + 'h') + ' / jour';
          if (totalEl) totalEl.textContent = 'â‰ˆ ' + (total < 60 ? total + ' min' : Math.floor(total/60) + 'h' + (total%60 > 0 ? (total%60 < 10 ? '0' : '') + total%60 : '')) + ' par semaine';
        });
      }
    });
  </script>
</body>
</html>
